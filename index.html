<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmonia do Altar</title>
    <!-- Favicon with fallback -->
    <link rel="icon" href="H.png" type="image/png">
    <!-- Tailwind CSS CDN for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for custom typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Smooth scrolling for anchor links */
        html {
            scroll-behavior: smooth;
        }
        /* Base font for the body */
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #1a202c; /* Fundo mais escuro para uma sensação mais cinematográfica */
            color: #e2e8f0; /* Texto mais claro para contraste em fundo escuro */
        }
        /* Heading font for a more elegant look */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            color: #ffffff; /* Títulos brancos para forte contraste */
        }
        /* Custom gold color for branding consistency */
        .text-gold {
            color: #b69260;
        }
        .bg-gold {
            background-color: #b69260;
        }
        .border-gold {
            border-color: #b69260;
        }
        /* Hero section background with gradient overlay */
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.65), rgba(0, 0, 0, 0.65)), url('https://images.pexels.com/photos/169198/pexels-photo-169198.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }
        
        /* Media Cropper for Instagram videos to ensure square aspect ratio */
        .media-cropper {
            position: relative;
            overflow: hidden;
            padding-top: 100%; /* Cria um container quadrado */
            border-radius: 12px;
            background-color: #2d3748; /* Fundo mais escuro para o cropper */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        .media-cropper .instagram-media {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            /* Ajusta os valores de transformação se o conteúdo estiver cortado ou não centralizado */
            transform: scale(1.25) translateY(-4.5%); /* Escala e ajusta ligeiramente a posição para cortar */
            border: none !important;
            box-shadow: none !important;
            margin: 0 !important;
        }
        
        /* Animações para elementos entrando na viewport - Aprimorado para sensação cinematográfica */
        .animated-item {
            opacity: 0;
            transform: translateY(40px) scale(0.98);
            transition: opacity 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform, opacity; /* Dica de desempenho para animações */
        }
        .animated-item.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Estilo de checkbox personalizado para melhor estética */
        .custom-checkbox:checked {
            background-color: #b69260;
            border-color: #b69260;
        }
        .custom-checkbox:checked + span {
            color: #b69260;
        }
        
        /* Efeito hover do link de navegação */
        .nav-link {
            position: relative;
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #b69260;
            transition: width 0.3s;
        }
        .nav-link:hover {
            color: #b69260;
        }
        .nav-link:hover::after {
            width: 100%;
        }

        /* Ajusta a margem de rolagem para seções para considerar a barra de navegação fixa */
        section[id] {
            scroll-margin-top: 80px;
        }

        /* Estilos de modal - Garante display: none por padrão para evitar FOUC */
        .modal {
            display: none; /* Oculto por padrão */
            position: fixed; /* Permanece no lugar */
            z-index: 1000; /* Fica no topo */
            left: 0;
            top: 0;
            width: 100%; /* Largura total */
            height: 100%; /* Altura total */
            overflow: auto; /* Habilita rolagem se necessário */
            background-color: rgba(0,0,0,0.8); /* Overlay mais escuro e opaco para modais */
            justify-content: center;
            align-items: center;
            opacity: 0; /* Começa invisível */
            transform: translateY(-20px); /* Começa ligeiramente acima */
            transition: opacity 0.4s ease-out, transform 0.4s ease-out; /* Transição suave */
        }

        .modal.show {
            display: flex; /* Mostra o modal */
            opacity: 1;
            transform: translateY(0);
        }

        .modal-content {
            background-color: #1a202c; /* Fundo escuro para o conteúdo do modal */
            color: #e2e8f0; /* Texto mais claro para o conteúdo do modal */
            margin: auto;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.15); /* Sombras mais escuras */
            width: 90%;
            max-width: 550px; /* Largura aumentada para novos campos */
            position: relative;
            /* Animação para o próprio conteúdo do modal */
            opacity: 0; /* Começa invisível */
            transform: translateY(-20px); /* Começa ligeiramente acima */
            transition: opacity 0.4s ease-out, transform 0.4s ease-out; /* Transição suave */
        }
        /* Quando o modal pai é mostrado, aplica o estado ativo ao conteúdo */
        .modal.show .modal-content {
            opacity: 1;
            transform: translateY(0);
        }

        .close-button {
            color: #a0aec0; /* Cor mais clara do botão de fechar */
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: #ffffff; /* Branco no hover */
            text-decoration: none;
            cursor: pointer;
        }

        /* Barras de rolagem personalizadas para navegadores Webkit (Chrome, Safari) */
        ::-webkit-scrollbar {
            width: 8px; /* Torna-o ligeiramente mais fino */
        }

        ::-webkit-scrollbar-track {
            background: transparent; /* Alterado para transparente para remover a trilha visível */
        }

        ::-webkit-scrollbar-thumb {
            background: #b69260; /* Cor dourada atualizada para o polegar da barra de rolagem */
            border-radius: 10px; /* Mantém cantos arredondados para o polegar */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a08154; /* Dourado mais escuro no hover */
        }

        /* Estilos de aba para navegação modal */
        .tab-header {
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #4a5568; /* Borda mais escura para abas */
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif; /* Garante fonte consistente para abas */
        }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-weight: 600;
            color: #a0aec0; /* Cor mais clara para abas inativas */
            transition: color 0.3s, border-bottom 0.3s;
            font-size: 0.875rem; /* Fonte menor para mais abas */
        }
        .tab-button.active {
            color: #b69260;
            border-bottom: 2px solid #b69260;
        }
        /* Transição do conteúdo da aba */
        .tab-content {
            display: none; /* Oculto por padrão */
            opacity: 0;
            transform: translateY(10px); /* Começa ligeiramente abaixo */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out; /* Transição suave */
        }

        .tab-content.active {
            display: block; /* Mostra o conteúdo da aba ativa */
            opacity: 1;
            transform: translateY(0);
        }

        /* Estilos personalizados para design aprimorado */
        .navbar-scrolled {
            background-color: rgba(26, 32, 44, 0.9); /* Fundo mais escuro, ligeiramente transparente */
            backdrop-filter: blur(8px); /* Efeito de vidro fosco */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .plan-card {
            border: 1px solid #2d3748; /* Borda sutil para todos os cartões, mais escura */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* Sombra inicial mais suave */
        }

        .plan-card:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); /* Sombra mais pronunciada no hover */
            transform: translateY(-5px) scale(1.01); /* Levemente mais levantado e escalado */
            border-color: #b69260; /* Borda dourada no hover */
        }

        .plan-card.popular {
            border: 2px solid #b69260; /* Borda dourada para cartão popular */
            box-shadow: 0 10px 20px rgba(182, 146, 96, 0.25); /* Sombra com tonalidade dourada para popular */
        }

        .plan-card.popular:hover {
            box-shadow: 0 15px 30px rgba(182, 146, 96, 0.4); /* Sombra dourada mais forte no hover */
        }

        .btn-primary {
            background-image: linear-gradient(to right, #b69260 0%, #a08154 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(182, 146, 96, 0.3);
        }

        .btn-primary:hover {
            background-position: right center; /* Altera a direção do gradiente no hover */
            box-shadow: 0 6px 15px rgba(182, 146, 96, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #4a5568; /* Cinza-800 */
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background-color: #2d3748; /* Cinza-900 */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .btn-whatsapp {
            background-image: linear-gradient(to right, #25D366 0%, #1DA851 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
        }

        .btn-whatsapp:hover {
            background-position: right center;
            box-shadow: 0 6px 15px rgba(37, 211, 102, 0.5);
            transform: translateY(-2px);
        }

        /* Estilos específicos do modal */
        .modal-content {
            background-color: #1a202c; /* Fundo escuro para o conteúdo do modal */
            border-radius: 16px; /* Cantos mais arredondados */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4); /* Sombra mais forte e moderna */
            padding: 30px; /* Mais preenchimento */
        }

        .modal-header {
            border-bottom: 2px solid #2d3748; /* Separador sutil, mais escuro */
            padding-bottom: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            color: #ffffff; /* Título branco para contraste */
        }

        .modal-close-button {
            color: #a0aec0; /* Cor mais clara do botão de fechar */
            font-size: 2.25rem; /* text-4xl */
            line-height: 1;
            transition: color 0.2s ease-in-out;
        }

        .modal-close-button:hover {
            color: #ffffff; /* Branco no hover */
        }

        .modal-tab-header {
            border-bottom: none; /* Remove a borda padrão */
            margin-bottom: 25px;
            background-color: #2d3748; /* Fundo escuro para abas */
            border-radius: 10px;
            padding: 5px;
        }

        .modal-tab-button {
            flex: 1;
            padding: 12px 15px;
            border-radius: 8px; /* Botões de aba arredondados */
            font-size: 1rem; /* Tamanho base da fonte */
            font-weight: 600;
            color: #a0aec0; /* Cor mais clara para abas inativas */
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .modal-tab-button.active {
            color: #ffffff; /* Texto branco para aba ativa */
            background-color: #b69260; /* Fundo dourado para aba ativa */
            box-shadow: 0 4px 10px rgba(182, 146, 96, 0.2);
            transform: translateY(-2px);
        }

        .modal-input-group label {
            font-size: 0.95rem;
            color: #e2e8f0; /* Texto mais claro para rótulos */
            margin-bottom: 8px;
        }

        .modal-input-group input[type="text"],
        .modal-input-group input[type="date"],
        .modal-input-group input[type="time"],
        .modal-input-group select {
            border: 1px solid #4a5568; /* Borda mais escura */
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 1rem;
            background-color: #2d3748; /* Fundo de entrada mais escuro */
            color: #e2e8f0; /* Texto de entrada mais claro */
            transition: all 0.2s ease-in-out;
        }

        .modal-input-group input:focus,
        .modal-input-group select:focus {
            border-color: #b69260;
            box-shadow: 0 0 0 3px rgba(182, 146, 96, 0.3); /* Sombra dourada mais forte */
            outline: none;
        }

        .modal-radio-label {
            padding: 12px 15px;
            border: 1px solid #4a5568; /* Borda mais escura */
            border-radius: 8px;
            background-color: #2d3748; /* Fundo mais escuro */
            transition: all 0.2s ease-in-out;
            color: #e2e8f0; /* Texto mais claro para rótulos de rádio */
        }

        .modal-radio-label:hover {
            background-color: #4a5568; /* Escuro ligeiramente mais claro no hover */
            border-color: #b69260;
        }

        .modal-radio-label input[type="radio"]:checked + span {
            color: #b69260;
            font-weight: 600;
        }

        .modal-summary-box {
            background-color: #2d3748; /* Cinza-azulado mais escuro para o resumo */
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #4a5568; /* Borda mais escura */
        }

        .modal-summary-item {
            color: #e2e8f0; /* Texto mais claro para o resumo */
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .modal-summary-item strong {
            color: #ffffff; /* Branco para texto em negrito */
        }

        .modal-footer-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .modal-footer-buttons .btn-primary,
        .modal-footer-buttons .btn-secondary {
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 10px;
        }

        /* Modais de Notificação */
        .notification-modal-content {
            background-color: #1a202c; /* Fundo escuro para o conteúdo da notificação */
            border-radius: 16px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4); /* Sombras mais escuras */
            padding: 30px;
            max-width: 450px; /* Ligeiramente menor para notificações */
            text-align: center;
            color: #e2e8f0; /* Texto mais claro para notificações */
            /* Animação para o próprio conteúdo da notificação */
            opacity: 0; /* Começa invisível */
            transform: translateY(-20px); /* Começa ligeiramente acima */
            transition: opacity 0.4s ease-out, transform 0.4s ease-out; /* Transição suave */
        }
        /* O modal pai .show aplicará também ao .notification-modal-content */
        .modal.show .notification-modal-content {
            opacity: 1;
            transform: translateY(0);
        }

        .notification-modal-title {
            font-size: 1.75rem; /* text-2xl */
            font-weight: 700;
            color: #ffffff; /* Título branco para notificações */
            margin-bottom: 15px;
            display: flex; /* Torna-o um contêiner flex para alinhar ícone e texto */
            align-items: center; /* Centraliza itens verticalmente */
            justify-content: center; /* Centraliza itens horizontalmente */
            gap: 10px; /* Espaço entre ícone e texto */
        }

        .notification-modal-title .icon {
            font-size: 2rem; /* Ajusta o tamanho do ícone */
        }

        .notification-modal-title.info .icon {
            color: #b69260; /* Cor dourada para o ícone de informação */
        }

        .notification-modal-title.warning .icon {
            color: #dc2626; /* Cor vermelha para o ícone de aviso */
        }

        .notification-modal-text {
            color: #a0aec0; /* Cinza mais claro para o texto da notificação */
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .notification-modal-button {
            padding: 12px 30px;
            font-size: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(182, 146, 96, 0.3);
            transition: all 0.3s ease;
        }
        .notification-modal-button.red {
            background-image: linear-gradient(to right, #ef4444 0%, #dc2626 100%); /* Gradiente vermelho */
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }
        .notification-modal-button.red:hover {
            background-position: right center;
            box-shadow: 0 6px 15px rgba(239, 68, 68, 0.5);
            transform: translateY(-2px);
        }

        /* Estilo de checkbox personalizado para o construtor de planos */
        .custom-plan-checkbox-label {
            display: flex;
            align-items: center;
            gap: 16px; /* Espaço aumentado para melhor espaçamento */
            cursor: pointer;
            padding: 16px; /* Preenchimento aumentado */
            background-color: #2d3748; /* Fundo mais escuro para checkboxes */
            border: 1px solid #4a5568; /* Borda mais escura */
            border-radius: 12px; /* Mais arredondado */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* Sombra sutil */
            transition: all 0.2s ease-in-out;
        }

        .custom-plan-checkbox-label:hover {
            background-color: #4a5568; /* Escuro ligeiramente mais claro no hover */
            border-color: #b69260; /* Borda dourada no hover */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Sombra ligeiramente mais pronunciada */
            transform: translateY(-2px); /* Leve levantamento */
        }

        .custom-plan-checkbox-label input[type="checkbox"] {
            -webkit-appearance: none; /* Oculta o checkbox padrão */
            -moz-appearance: none;
            appearance: none;
            width: 24px; /* Checkbox maior */
            height: 24px;
            border: 2px solid #a0aec0; /* Borda cinza claro para checkbox */
            border-radius: 6px; /* Cantos arredondados para checkbox */
            background-color: #ffffff;
            transition: all 0.2s ease-in-out;
            position: relative;
            flex-shrink: 0; /* Evita encolhimento */
        }

        .custom-plan-checkbox-label input[type="checkbox"]:checked {
            background-color: #b69260; /* Fundo dourado quando marcado */
            border-color: #b69260;
        }

        .custom-plan-checkbox-label input[type="checkbox"]:checked::after {
            content: '\2713'; /* Caractere de marca de verificação */
            color: white;
            font-size: 16px; /* Tamanho da marca de verificação */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
        }

        .custom-plan-checkbox-label span {
            font-size: 1.05rem; /* Texto ligeiramente maior */
            color: #e2e8f0; /* Texto mais claro para fundo escuro */
            transition: color 0.2s ease-in-out;
        }

        .custom-plan-checkbox-label input[type="checkbox"]:checked + span {
            color: #b69260; /* Texto dourado quando marcado */
            font-weight: 700; /* Texto mais em negrito quando marcado */
        }

        /* Estilo da lista de instrumentos do cartão de plano */
        .plan-instrument-item {
            display: flex;
            align-items: center;
            gap: 8px; /* Espaço entre ícone e texto */
            color: #cbd5e0; /* Texto mais claro para legibilidade em cartões escuros */
            font-size: 1rem; /* Tamanho base da fonte */
        }
        .plan-instrument-item i {
            color: #b69260; /* Cor dourada para ícones */
            font-size: 1.1rem; /* Ícone ligeiramente maior */
        }
    </style>
</head>
<body class="text-gray-200">
    <!-- Script para ocultar modais imediatamente no carregamento da página para evitar FOUC -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Seleciona todos os elementos com a classe 'modal'
            const modals = document.querySelectorAll('.modal');
            // Itera sobre cada modal e define seu estilo de exibição como 'none'
            modals.forEach(modal => {
                modal.style.display = 'none';
                // Também garante que eles não tenham a classe 'show' inicialmente
                modal.classList.remove('show');
            });
        });
    </script>

    <!-- Barra de Navegação -->
    <nav id="navbar" class="fixed top-0 left-0 w-full z-50 transition-all duration-300 py-4">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <!-- Logo e Título do Site -->
            <a href="#" class="text-white text-2xl md:text-3xl font-bold font-playfair flex items-center">
                <img src="H.png" alt="Logo Harmonia do Altar" class="h-10 md:h-12 mr-3 inline-block" onerror="this.onerror=null; this.src='https://placehold.co/48x48/ffffff/b69260?text=H'">armonia do Altar
            </a>
            
            <!-- Links de Navegação Desktop -->
            <div class="hidden md:flex space-x-10">
                <a href="#sobre" class="nav-link text-lg">Sobre</a>
                <a href="#galeria" class="nav-link text-lg">Galeria</a>
                <a href="#planos" class="nav-link text-lg">Planos</a>
                <a href="#contato" class="nav-link text-lg">Contato</a>
            </div>

            <!-- Botão do Menu Mobile -->
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-white focus:outline-none" aria-label="Toggle mobile menu">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <!-- Menu de Navegação Mobile -->
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800 bg-opacity-95">
            <a href="#sobre" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Sobre</a>
            <a href="#galeria" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Galeria</a>
            <a href="#planos" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Planos</a>
            <a href="#contato" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Contato</a>
        </div>
    </nav>

    <!-- Seção Hero -->
    <header class="hero-bg text-white shadow-lg h-screen flex items-center justify-center">
        <div class="text-center px-4">
            <h1 class="text-5xl md:text-7xl font-bold mb-4 animated-item">
                <img src="H.png" alt="Logo Harmonia do Altar" class="h-24 md:h-36 inline-block align-middle mr-4" onerror="this.onerror=null; this.src='https://placehold.co/144x144/ffffff/b69260?text=H'">armonia do Altar
            </h1>
            <p class="text-xl md:text-3xl font-light animated-item delay-1 leading-snug">A Trilha Sonora Perfeita para o Seu Grande Dia</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-16 md:py-24">
        
        <!-- Seção Sobre -->
        <section id="sobre" class="text-center max-w-4xl mx-auto mb-20 md:mb-32 animated-item">
            <h2 class="text-4xl md:text-5xl font-bold mb-4">Música que Conta a Sua História</h2>
            <div class="w-24 h-1.5 bg-gold mx-auto mb-8 rounded-full"></div>
            <p class="text-gray-300 leading-relaxed text-lg md:text-xl">
                Para nós, cada casamento é a celebração de uma história de amor única. E toda grande história merece uma trilha sonora inesquecível. Somos o Harmonia do Altar, um grupo de músicos apaixonados por transformar cerimônias em eventos memoráveis. Nosso propósito é ir além da música: queremos tocar o coração de cada convidado e, principalmente, o de vocês, com arranjos que capturam a essência do seu amor e a solenidade do seu grande dia.
            </p>
        </section>
        
        <!-- Seção Galeria -->
        <section id="galeria" class="mb-20 md:mb-32">
            <div class="animated-item">
                <h2 class="text-4xl md:text-5xl font-bold text-center mb-4">Sinta a Nossa Harmonia</h2>
                <div class="w-24 h-1.5 bg-gold mx-auto mb-16 rounded-full"></div>
            </div>
            
            <div class="text-center max-w-3xl mx-auto animated-item">
                <h3 class="text-3xl font-bold text-gold mb-4">A Emoção em Cada Nota</h3>
                <p class="text-gray-300 mb-10 text-lg">A música tem o poder de evocar sentimentos profundos. Imagine a entrada da noiva ao som de um violino emocionante, ou a troca de alianças embalada por um piano suave e vozes que se entrelaçam. É essa atmosfera que criamos.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-16">
                <!-- Instagram Embed 1 -->
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8YQSOEsv0-/" data-instgrm-version="14"></blockquote>
                </div>
                <!-- Instagram Embed 2 -->
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8V3pPAsYSj/" data-instgrm-version="14"></blockquote>
                </div>
            </div>

            <div class="text-center max-w-3xl mx-auto mt-24 animated-item">
                <h3 class="text-3xl font-bold text-gold mb-4">Elegância e Profissionalismo</h3>
                <p class="text-gray-300 mb-10 text-lg">Acreditamos que a beleza está na harmonia, não só musical, mas também visual. Nossos músicos se apresentam com a sofisticação que a sua cerimônia merece, e nossas performances são um reflexo do nosso compromisso com a excelência.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-16">
                <!-- Instagram Embed 3 -->
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/C8VlkbksuVZ/" data-instgrm-version="14"></blockquote>
                </div>
                <!-- Instagram Embed 4 -->
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/CpBIkGaOdrZ/" data-instgrm-version="14"></blockquote>
                </div>
            </div>

            <div class="text-center max-w-3xl mx-auto mt-24 animated-item">
                <h3 class="text-3xl font-bold text-gold mb-4">Alegria e Versatilidade</h3>
                <p class="text-gray-300 mb-10 text-lg">Seu casamento deve refletir sua personalidade. Do clássico ao popular, do sacro ao contemporâneo, nosso repertório é vasto e adaptável. Celebramos o amor em todos os ritmos, garantindo momentos de pura alegria e emoção.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <!-- Instagram Embed 5 -->
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8VkPNDsAit/" data-instgrm-version="14"></blockquote>
                </div>
                <!-- Instagram Embed 6 -->
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8YEx9mse1O/" data-instgrm-version="14"></blockquote>
                </div>
            </div>
        </section>

        <!-- Seção de Planos -->
        <section id="planos" class="py-20 md:py-32 bg-gray-800 rounded-3xl shadow-xl">
            <div class="text-center max-w-4xl mx-auto mb-16 md:mb-20 animated-item">
                <h2 class="text-4xl md:text-5xl font-bold mb-4">Nossas Configurações Sugeridas</h2>
                <div class="w-24 h-1.5 bg-gold mx-auto mb-8 rounded-full"></div>
                <p class="text-gray-300 leading-relaxed text-lg md:text-xl mb-8">
                    Nossa formação padrão inclui <strong>3 vozes e teclado</strong>, com a flexibilidade de adicionar outros instrumentos para personalizar sua sonoridade. O deslocamento tem tarifa fixa para <strong>Angélica/Ivinhema (MS) e valor por km para outras localidades (com um valor base).</strong> Taxas de processamento bancário aplicam-se a pagamentos via boleto e cartão (incluindo deslocamentos especiais), não sendo retidas pela Harmonia do Altar. <strong>Pix e dinheiro são isentos de taxas bancárias.</strong>
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 justify-center px-4">
                
                <!-- Cartão de Plano 1: Essência Clássica e Sublime -->
                <div class="bg-gray-900 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-music text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-white mb-3">Essência Clássica e Sublime</h3>
                        <p class="text-gray-400 mb-8 text-base">A nossa formação padrão, com as <strong>3 vozes e o teclado</strong>. Perfeita para quem busca a elegância atemporal e a emoção pura.</p>
                        <h4 class="font-bold mb-3 text-gray-300 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Ícone alterado -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-700 bg-gray-800 flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.400</div>
                        <button onclick="handleSimular('Essência Clássica e Sublime', ['3 Vozes + Teclado/Piano'], 1400)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>

                <!-- Cartão de Plano 2: Harmonia Delicada e Acústica (Mais Popular) -->
                <div class="bg-gray-900 rounded-2xl plan-card popular overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item delay-1 relative">
                    <div class="absolute top-0 right-0 bg-gold text-white text-sm font-bold px-4 py-1.5 rounded-bl-xl">MAIS POPULAR</div>
                    <div class="p-8 flex-grow">
                        <i class="fas fa-guitar text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-white mb-3">Harmonia Delicada e Acústica</h3>
                        <p class="text-gray-400 mb-8 text-base">A formação padrão com o acréscimo do <strong>violão</strong>. O som quente e dedilhado cria uma atmosfera romântica e acolhedora.</p>
                        <h4 class="font-bold mb-3 text-gray-300 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Ícone alterado -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-guitar"></i> <!-- Ícone alterado -->
                                <span>Violão</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-700 bg-gray-800 flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.600</div>
                        <button onclick="handleSimular('Harmonia Delicada e Acústica', ['3 Vozes + Teclado/Piano', 'Violão'], 1600)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>
                
                <!-- Cartão de Plano 3: Sofisticação e Envolvimento -->
                <div class="bg-gray-900 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item delay-2">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-layer-group text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-white mb-3">Sofisticação e Envolvimento</h3>
                        <p class="text-gray-400 mb-8 text-base">Além da base, o <strong>contrabaixo</strong> adiciona uma sonoridade mais encorpada e um groove sutil, trazendo profundidade e elegância.</p>
                        <h4 class="font-bold mb-3 text-gray-300 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Ícone alterado -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-volume-down"></i> <!-- Ícone alterado -->
                                <span>Contrabaixo</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-700 bg-gray-800 flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.600</div>
                        <button onclick="handleSimular('Sofisticação e Envolvimento', ['3 Vozes + Teclado/Piano', 'Contrabaixo'], 1600)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>

                <!-- Cartão de Plano 4: Sonoridade Completa e Marcante -->
                <div class="bg-gray-900 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-sliders-h text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-white mb-3">Sonoridade Completa e Marcante</h3>
                        <p class="text-gray-400 mb-8 text-base">Com <strong>contrabaixo e violão</strong> somados à base, esta opção traz uma sonoridade grandiosa, preenchida e com uma textura rica.</p>
                        <h4 class="font-bold mb-3 text-gray-300 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Ícone alterado -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-volume-down"></i> <!-- Ícone alterado -->
                                <span>Contrabaixo</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-guitar"></i> <!-- Ícone alterado -->
                                <span>Violão</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-700 bg-gray-800 flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.800</div>
                        <button onclick="handleSimular('Sonoridade Completa e Marcante', ['3 Vozes + Teclado/Piano', 'Violão', 'Contrabaixo'], 1800)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>

                <!-- Cartão de Plano 5: Versatilidade e Brilho Acústico -->
                <div class="bg-gray-900 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item delay-1">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-star text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-white mb-3">Versatilidade e Brilho Acústico</h3>
                        <p class="text-gray-400 mb-8 text-base">A formação mais completa, com <strong>violão, guitarra e contrabaixo</strong>. Permite explorar diferentes estilos com arranjos modernos.</p>
                        <h4 class="font-bold mb-3 text-gray-300 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Ícone alterado -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-guitar"></i> <!-- Ícone alterado -->
                                <span>Violão</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-bolt"></i> <!-- Ícone alterado -->
                                <span>Guitarra</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-volume-down"></i> <!-- Ícone alterado -->
                                <span>Contrabaixo</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-700 bg-gray-800 flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 2.000</div>
                        <button onclick="handleSimular('Versatilidade e Brilho Acústica', ['3 Vozes + Teclado/Piano', 'Violão', 'Guitarra', 'Contrabaixo'], 2000)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção de Construtor de Planos Personalizados -->
        <section id="custom-plan-builder" class="bg-gray-800 rounded-3xl shadow-xl p-8 md:p-12 text-center mt-20 md:mt-32 animated-item">
            <h2 class="text-4xl md:text-5xl font-bold mb-4">Crie o Seu Plano Personalizado</h2>
            <div class="w-24 h-1.5 bg-gold mx-auto mb-8 rounded-full"></div>
            <p class="max-w-3xl mx-auto text-gray-300 text-lg mb-10">
                Adicione instrumentos à nossa formação padrão para criar a sonoridade perfeita para o seu dia.
            </p>
            <div class="max-w-2xl mx-auto text-left">
                <div class="p-5 bg-gray-700 rounded-xl mb-6 flex justify-between items-center border border-gray-600">
                    <span class="font-bold text-gray-200 text-lg">Formação Padrão (3 Vozes + Teclado)</span>
                    <span class="font-bold text-gray-200 text-lg">R$ 1.400,00</span>
                </div>
                <h4 class="text-xl font-bold text-white mt-8 mb-4">Instrumentos da Banda:</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" id="band-instrument-options"></div>
                
                <h4 class="text-xl font-bold text-white mt-10 mb-4">Músicos Convidados: <span class="text-base font-normal text-gray-400">(Um toque de brilho)</span></h4>
                <p class="text-base text-gray-300 mb-6">Para uma sonoridade ainda mais especial, adicione o romantismo do violino ou a sofisticação do saxofone.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" id="guest-instrument-options"></div>
            </div>

            <div class="mt-10 max-w-2xl mx-auto border-t border-gray-700 pt-8">
                <button id="simulate-btn-custom" class="w-full btn-primary text-white font-bold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-lg">Simular Plano Personalizado</button>
            </div>
        </section>

    </main>

    <!-- Seção Rodapé -->
    <footer id="contato" class="bg-gray-900 text-white mt-20 md:mt-32 py-16">
        <div class="container mx-auto px-6 py-12 text-center animated-item">
            <h2 class="text-4xl font-bold mb-6">Vamos Conversar?</h2>
            <p class="max-w-3xl mx-auto mb-8 text-gray-300 text-lg">
                Estamos aqui para tirar todas as dúvidas e garantir que cada nota no seu grande dia seja exatamente como vocês sonham.
            </p>
            <!-- Botão de Contato WhatsApp -->
            <a href="https://wa.me/5567996884226?text=Olá!%20Vi%20o%20site%20do%20Harmonia%20do%20Altar%20e%20gostaria%20de%20um%20orçamento." target="_blank" rel="noopener noreferrer" class="btn-whatsapp text-white font-bold py-4 px-10 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 inline-block text-lg">
                <i class="fab fa-whatsapp mr-3"></i> Chamar no WhatsApp
            </a>
            <!-- Links de Mídias Sociais -->
            <div class="flex justify-center space-x-8 mt-10">
                <a href="https://www.instagram.com/harmoniadoaltar?utm_source=qr&igsh=cXF5dGJ6cTFobmVr" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="text-gray-400 hover:text-white transition-colors duration-300 transform hover:scale-110">
                    <i class="fab fa-instagram text-3xl"></i>
                </a>
                <a href="https://www.facebook.com/share/1CBb9XQqiD/" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="text-gray-400 hover:text-white transition-colors duration-300 transform hover:scale-110">
                    <i class="fab fa-facebook text-3xl"></i>
                </a>
            </div>
        </div>
    </footer>

    <!-- Modal Principal de Simulação (Unificado com Abas) -->
    <div id="main-simulation-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="modal-content w-full max-w-2xl">
            <div class="modal-header">
                <h3 class="modal-title">Simulação de Orçamento</h3>
                <span class="close-button modal-close-button" id="close-main-modal-button" aria-label="Close modal">&times;</span>
            </div>

            <!-- Navegação por Abas para o Modal -->
            <div class="tab-header modal-tab-header" role="tablist">
                <button class="tab-button modal-tab-button active" data-tab="deslocamento-tab" role="tab" aria-controls="deslocamento-tab-content">Deslocamento</button>
                <button class="tab-button modal-tab-button" data-tab="event-details-tab" role="tab" aria-controls="event-details-tab-content">Detalhes do Evento</button>
                <button class="tab-button modal-tab-button" data-tab="payment-method-tab" role="tab" aria-controls="payment-method-tab-content">Pagamento</button>
                <button class="tab-button modal-tab-button" data-tab="summary-tab" role="tab" aria-controls="summary-tab-content">Resumo</button>
            </div>

            <!-- ABA 1: DESLOCAMENTO -->
            <div id="deslocamento-tab" class="tab-content active" role="tabpanel" aria-labelledby="deslocamento-tab">
                <h4 class="text-xl font-bold text-white mb-4">Cálculo de Deslocamento</h4>
                <p class="text-gray-300 mb-6">Informe o endereço do local da cerimônia para calcular o custo do deslocamento. <strong>Condições especiais se aplicam para Angélica, MS e Ivinhema, MS.</strong></p>
                <div class="modal-input-group mb-4">
                    <label for="modal-destination-address" class="block text-gray-300 text-sm font-bold mb-2">Endereço Completo (Rua, Número, Cidade, Estado):</label>
                    <div class="flex space-x-2">
                        <input type="text" id="modal-destination-address" placeholder="Ex: Av. Brasil, 123, Ivinhema, MS" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-200 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                        <button type="button" id="open-map-selection-btn" class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 text-sm flex-shrink-0">
                            <i class="fas fa-map-marker-alt mr-1"></i> Abrir Mapa
                        </button>
                    </div>
                    <p id="modal-deslocamento-error" class="text-red-500 mt-2 hidden text-sm">Por favor, digite um endereço válido.</p>
                </div>
                <div id="modal-deslocamento-results" class="mt-6 p-4 bg-gray-700 rounded-lg hidden">
                    <p class="text-gray-200">Distância: <span id="modal-distance-display" class="font-bold"></span></p>
                    <p class="text-gray-200">Valor do Deslocamento: <span id="modal-calculated-deslocamento-display" class="font-bold text-gold"></span></p>
                </div>
                <div class="modal-footer-buttons">
                    <button id="next-to-event-details-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Próximo</button>
                </div>
            </div>

            <!-- ABA 2: DETALHES DO EVENTO -->
            <div id="event-details-tab" class="tab-content" role="tabpanel" aria-labelledby="event-details-tab">
                <h4 class="text-xl font-bold text-white mb-4">Detalhes da Cerimônia</h4>
                <p class="text-gray-300 mb-6">Por favor, preencha a data e o horário da sua cerimônia.</p>
                
                <div class="modal-input-group mb-4">
                    <label for="ceremony-date" class="block text-gray-300 text-sm font-bold mb-2">Data da Cerimônia:</label>
                    <input type="date" id="ceremony-date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-200 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                </div>
                
                <div class="modal-input-group mb-4">
                    <label for="ceremony-time" class="block text-gray-300 text-sm font-bold mb-2">Horário da Cerimônia:</label>
                    <input type="time" id="ceremony-time" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-200 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                </div>

                <!-- Novo campo para Local de Referência -->
                <div class="modal-input-group mb-4">
                    <label for="reference-location" class="block text-gray-300 text-sm font-bold mb-2">Local de Referência (Opcional):</label>
                    <input type="text" id="reference-location" placeholder="Ex: Próximo à praça central" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-200 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                </div>

                <div class="mt-4 p-3 bg-gray-700 rounded-lg">
                    <p class="text-gray-200"><strong>Endereço Confirmado:</strong> <span id="confirmed-address-display"></span></p>
                </div>
                <p id="modal-event-details-error" class="text-red-500 mt-2 hidden text-sm">Por favor, preencha a data e o horário.</p>

                <div class="modal-footer-buttons">
                    <button class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300" data-navigate-tab="deslocamento-tab">Voltar</button>
                    <button id="next-to-payment-method-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Próximo</button>
                </div>
            </div>

            <!-- ABA 3: FORMA DE PAGAMENTO -->
            <div id="payment-method-tab" class="tab-content" role="tabpanel" aria-labelledby="payment-method-tab">
                <h4 class="text-xl font-bold text-white mb-4">Forma de Pagamento</h4>
                <div class="mb-4 text-gray-200">
                    <p>Valor do Plano: <span id="modal-plan-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p>Valor do Deslocamento: <span id="modal-freight-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p>Valor Total (Plano + Deslocamento): <span id="modal-total-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="mt-2 text-lg font-bold">Valor Total a Pagar<span id="fees-suffix" class="text-sm font-normal text-gray-400"> (com taxas)</span>: <span id="modal-total-price-with-fees" class="font-bold text-gold">R$ 0,00</span></p>
                </div>
                <div class="mb-6 space-y-3">
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="pix" class="form-radio h-5 w-5 text-gold" checked>
                        <span>Pix</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="dinheiro" class="form-radio h-5 w-5 text-gold">
                        <span>Dinheiro (a verificar com o contratado)</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="boleto" class="form-radio h-5 w-5 text-gold">
                        <span>Boleto (parcelamento em até 5x)</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="cartao" class="form-radio h-5 w-5 text-gold">
                        <span>Cartão de Crédito (parcelamento em até 12x)</span>
                    </label>
                </div>

                <div id="installment-options" class="mb-6 hidden modal-input-group">
                    <label for="installments" class="block text-gray-300 text-sm font-bold mb-2">Número de Parcelas:</label>
                    <select id="installments" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-200 leading-tight focus:outline-none focus:shadow-outline focus:border-gold"></select>
                    <p class="mt-2 text-gray-200">Valor por parcela: <span id="installment-value" class="font-bold text-gold">R$ 0,00</span></p>
                </div>

                <div id="boleto-due-date-options" class="mb-6 hidden modal-input-group">
                    <label for="boleto-due-date" class="block text-gray-300 text-sm font-bold mb-2">Melhor dia para vencimento do boleto:</label>
                    <select id="boleto-due-date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-200 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                        <option value="5">Dia 5</option>
                        <option value="10">Dia 10</option>
                        <option value="15">Dia 15</option>
                        <option value="20">Dia 20</option>
                        <option value="25">Dia 25</option>
                    </select>
                    <!-- Esta mensagem de erro inline agora será ocultada e substituída por um modal -->
                    <p id="modal-boleto-date-error" class="text-red-500 mt-2 hidden text-sm">A data da última parcela não pode ser posterior à data da cerimônia. Por favor, ajuste as parcelas ou a data de vencimento.</p>
                </div>

                <div class="modal-footer-buttons">
                    <button class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300" data-navigate-tab="event-details-tab">Voltar</button>
                    <button id="next-to-summary-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Próximo</button>
                </div>
            </div>

            <!-- ABA 4: RESUMO E SIMULAR -->
            <div id="summary-tab" class="tab-content" role="tabpanel" aria-labelledby="summary-tab">
                <h4 class="text-xl font-bold text-white mb-4">Resumo do Orçamento</h4>
                <div class="modal-summary-box space-y-3">
                    <p class="modal-summary-item"><strong>Plano:</strong> <span id="summary-plan-name" class="font-bold text-white"></span></p>
                    <p class="modal-summary-item"><strong>Data do Evento:</strong> <span id="summary-event-date" class="font-bold text-white"></span></p>
                    <p class="modal-summary-item"><strong>Endereço:</strong> <span id="summary-event-address" class="font-bold text-white"></span></p>
                    <p class="modal-summary-item" id="summary-reference-location-display"><strong>Local de Referência:</strong> <span id="summary-reference-location" class="font-bold text-white"></span></p>
                    <hr class="my-3 border-gray-600">
                    <p class="modal-summary-item">Valor do Plano: <span id="summary-plan-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item">Valor do Deslocamento: <span id="summary-deslocamento-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item">Valor Total (Plano + Deslocamento): <span id="summary-total-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item" id="summary-total-with-fees-label-container">Valor Total a Pagar<span id="summary-fees-suffix"> (com taxas)</span>: <span id="summary-total-price-with-fees" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item">Forma de Pagamento: <span id="summary-payment-method" class="font-bold text-gold"></span></p>
                    <p class="modal-summary-item" id="summary-installment-details">Parcelamento: <span id="summary-installments" class="font-bold text-gold"></span></p>
                    <p class="modal-summary-item hidden" id="summary-boleto-due-date-details">Vencimento do Boleto: <span id="summary-boleto-due-date" class="font-bold text-gold"></span></p>
                </div>
                
                <div id="fees-explanation" class="bg-yellow-900 border-l-4 border-yellow-500 text-yellow-200 p-4 rounded-lg text-sm mt-6 hidden">
                    <p class="font-semibold mb-2">Informações sobre Taxas:</p>
                    <p>As taxas aplicadas em pagamentos via Boleto e Cartão de Crédito são referentes aos custos de processamento das operadoras financeiras e bancos. A Harmonia do Altar não retém qualquer valor sobre estas taxas, que são integralmente destinadas à viabilização do parcelamento e segurança da transação. Para pagamentos via Pix ou Dinheiro, não há incidência de taxas adicionais.</p>
                </div>

                <div class="modal-footer-buttons">
                    <button class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300" data-navigate-tab="payment-method-tab">Voltar</button>
                    <button id="confirm-simulation-btn" class="btn-primary text-white font-bold py-3 px-8 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Confirmar Simulação</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Seleção de Mapa -->
    <div id="map-selection-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="notification-modal-content w-full h-3/4 flex flex-col">
            <span class="close-button modal-close-button" id="close-map-modal-button" aria-label="Close map modal">&times;</span>
            <h3 class="notification-modal-title">Selecione a Localização no Mapa</h3>
            <div id="map-canvas" class="flex-grow rounded-lg mb-4" style="height: 400px; width: 100%;"></div>
            <button id="confirm-map-location-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 mt-4 notification-modal-button">Confirmar Localização</button>
        </div>
    </div>

    <!-- Modal de Notificação de Boleto -->
    <div id="boleto-notification-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="notification-modal-content w-full">
            <span class="close-button modal-close-button" id="close-boleto-modal-button" aria-label="Close notification">&times;</span>
            <h3 class="notification-modal-title info">
                <i class="fas fa-info-circle icon"></i> Atenção Importante: Pagamento via Boleto!
            </h3>
            <p class="notification-modal-text">
                Para sua comodidade, o boleto da sua simulação pode ser gerado e quitado a qualquer momento antes da data da cerimônia. Lembre-se: o pagamento pontual é essencial! Boletos não pagos após o vencimento podem estar sujeitos a protesto em cartório, o que pode gerar restrições de crédito. Para garantir a tranquilidade do seu grande dia, recomendamos a quitação dentro do prazo estabelecido. Contamos com você para essa harmonia financeira!
            </p>
            <div class="flex justify-end mt-6">
                <button id="ok-boleto-modal-button" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 notification-modal-button">Entendi</button>
            </div>
        </div>
    </div>

    <!-- Novo: Modal de Notificação de Validação de Data de Boleto -->
    <div id="boleto-date-warning-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="notification-modal-content w-full">
            <span class="close-button modal-close-button" id="close-boleto-date-warning-modal-button" aria-label="Close warning">&times;</span>
            <h3 class="notification-modal-title warning">
                <i class="fas fa-exclamation-triangle icon"></i> Alerta Importante: Ajuste a Data do Boleto!
            </h3>
            <p class="notification-modal-text">
                Identificamos que a data da última parcela do boleto que você selecionou (dia <span id="warning-due-date"></span>) ultrapassa a data da sua cerimônia (<span id="warning-ceremony-date"></span>). Para que tudo corra perfeitamente e sem imprevistos, é fundamental que todas as parcelas sejam quitadas antes do seu grande dia. Por favor, ajuste o número de parcelas ou o dia de vencimento do boleto. Estamos aqui para ajudar a encontrar a melhor solução!
            </p>
            <div class="flex justify-end mt-6">
                <button id="ok-boleto-date-warning-modal-button" class="btn-primary red text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 notification-modal-button">Entendi</button>
            </div>
        </div>
    </div>

    <!-- Script de Incorporação do Instagram -->
    <script async src="//www.instagram.com/embed.js"></script>
    
    <!-- Google Maps API com biblioteca Places para preenchimento automático e matriz de distância -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDoL-Za52C0cbwOen71nbKqDpLKgBufd0Y&libraries=geometry,places&callback=initMap"></script>

    <script>
        // --- VARIÁVEIS GLOBAIS E CONSTANTES ---
        let mapsInitialized = false; // Flag para verificar se a API do Google Maps foi carregada
        let autocomplete; // Instância do Google Places Autocomplete
        let currentPlanDetails = null; // Armazena detalhes do plano selecionado
        let currentFinalTotalPrice = 0; // Preço total incluindo plano e deslocamento
        let currentPlanOnlyPrice = 0; // Preço apenas do plano selecionado
        let currentDeslocamentoCost = 0; // Custo do deslocamento
        let selectedPaymentMethod = 'pix'; // Método de pagamento padrão
        let selectedInstallments = 1; // Número de parcelas padrão
        let ceremonyDate = null; // Data da cerimônia
        let ceremonyTime = null; // Hora da cerimônia
        let selectedBoletoDueDate = 5; // Dia padrão para vencimento do boleto
        let debounceTimer; // Timer para debounce de entrada
        const whatsappNumber = '5567996884226'; // Número do WhatsApp para contato

        // Variáveis relacionadas ao Google Maps
        let selectedPlaceDetails = {
            address: '',
            lat: null,
            lng: null,
            googleMapsUrl: ''
        };
        let map = null; // Instância do Google Map
        let marker = null; // Instância do marcador do Google Map
        let geocoder = null; // Instância do Google Maps Geocoder

        // Variáveis de Elementos DOM declaradas globalmente (atribuídas em DOMContentLoaded)
        let modalDestinationAddressInput;
        let modalDeslocamentoError;
        let modalDeslocamentoResultsDiv;
        let modalDistanceDisplay;
        let modalCalculatedDeslocamentoDisplay;
        let referenceLocationInput;
        let nextToSummaryBtn;
        let boletoDateWarningModal;
        let warningDueDateSpan;
        let warningCeremonyDateSpan;

        // Getters de Elementos para o modal principal
        let ceremonyDateInput;
        let ceremonyTimeInput;
        let confirmedAddressDisplay;
        let modalEventDetailsError;
        let paymentMethodRadios;
        let installmentOptionsDiv;
        let installmentsSelect;
        let installmentValueEl;
        let boletoDueDateOptionsDiv;
        let boletoDueDateSelect;
        let modalBoletoDateError;
        let feesSuffixSpan;
        let modalPlanPriceEl;
        let modalFreightPriceEl;
        let modalTotalPriceEl;
        let modalTotalPriceWithFeesEl;

        // Getters de Elementos para a aba de resumo
        let summaryPlanNameEl;
        let summaryEventDateEl;
        let summaryEventAddressEl;
        let summaryReferenceLocationDisplay;
        let summaryReferenceLocationEl;
        let summaryPlanPriceEl;
        let summaryDeslocamentoPriceEl;
        let summaryTotalPriceEl;
        let summaryTotalWithFeesEl;
        let summaryPaymentMethodEl;
        let summaryInstallmentDetailsDiv;
        let summaryInstallmentsEl;
        let summaryBoletoDueDateDetailsDiv;
        let summaryBoletoDueDateEl;
        let feesExplanationDiv;
        let summaryFeesSuffixSpan;

        // Constantes de Preços
        const BASE_PLAN_PRICE = 1400;
        const BOLETO_PER_INSTALLMENT_FEE = 18;
        const FIXED_DESLOCAMENTO_AMOUNT = 70;
        const PER_KM_DESLOCAMENTO_RATE = 1.80 * 2; // R$1.80 por km, multiplicado por 2 para ida e volta
        const originAddress = "Angélica, MS, Brazil"; // Origem para cálculo de distância

        // Preços dos instrumentos para o construtor de planos personalizados
        const INSTRUMENT_PRICES = {
            'Violão': 200, 'Contrabaixo': 200, 'Guitarra': 200,
            'Saxofone': 500, 'Violino': 500, '3 Vozes + Teclado/Piano': BASE_PLAN_PRICE
        };
        // Percentagens de taxa de cartão de crédito com base no número de parcelas
        const CREDIT_CARD_TOTAL_PERCENTAGES = {
            1: 0.04980, 2: 0.04590 + 0.0531, 3: 0.05970 + 0.0531, 4: 0.07330 + 0.0531,
            5: 0.08660 + 0.0531, 6: 0.09960 + 0.0531, 7: 0.11240 + 0.0531, 8: 0.12500 + 0.0531,
            9: 0.13730 + 0.1531, 10: 0.14930 + 0.0531, 11: 0.16120 + 0.0531, 12: 0.17280 + 0.0531
        };

        // --- FUNÇÕES GLOBAIS ---

        /**
         * Formata um número como moeda brasileira (R$).
         * @param {number} value - O número a ser formatado.
         * @returns {string} A string de moeda formatada.
         */
        function formatCurrency(value) {
            if (typeof value !== 'number' || isNaN(value)) return 'R$ 0,00';
            return `R$ ${value.toFixed(2).replace('.', ',')}`;
        }

        /**
         * Calcula o custo de deslocamento com base no destino.
         * Pode aceitar uma string de endereço formatada ou coordenadas de latitude/longitude.
         * @param {string|number} destinationOrLat - A string do endereço de destino ou latitude.
         * @param {number|null} [destinationLng=null] - A longitude, se a latitude for fornecida.
         * @param {function} [callback] - Função de callback opcional para executar após o cálculo.
         */
        function calculateDeslocamentoInModal(destinationOrLat, destinationLng = null, callback) {
            if (!mapsInitialized) {
                console.error("Google Maps API ainda não carregada.");
                if(modalDeslocamentoError) {
                    modalDeslocamentoError.textContent = "Erro ao carregar o serviço de mapas. Tente novamente.";
                    modalDeslocamentoError.classList.remove('hidden');
                }
                currentDeslocamentoCost = 0;
                currentFinalTotalPrice = currentPlanOnlyPrice;
                if (callback) callback();
                return;
            }

            const service = new google.maps.DistanceMatrixService();
            let destinationsArray;

            if (destinationLng !== null) { // Se lat/lng forem fornecidos
                destinationsArray = [new google.maps.LatLng(destinationOrLat, destinationLng)];
            } else { // Se a string do endereço for fornecida
                destinationsArray = [destinationOrLat];
            }

            service.getDistanceMatrix({
                origins: [originAddress],
                destinations: destinationsArray,
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
            }, (response, status) => {
                if (status === 'OK' && response.rows[0].elements[0].status === 'OK') {
                    const element = response.rows[0].elements[0];
                    const distanceInMeters = element.distance.value;
                    const destinationFormattedAddress = response.destinationAddresses[0];
                    const normalizedDestination = destinationFormattedAddress.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                    
                    let isFixedCity = (normalizedDestination.includes('angelica') && normalizedDestination.includes('ms')) || (normalizedDestination.includes('ivinhema') && normalizedDestination.includes('ms'));

                    if (isFixedCity) {
                        currentDeslocamentoCost = FIXED_DESLOCAMENTO_AMOUNT;
                        modalDistanceDisplay.textContent = `Taxa Fixa`;
                    } else {
                        const distanceInKm = distanceInMeters / 1000;
                        currentDeslocamentoCost = FIXED_DESLOCAMENTO_AMOUNT + (distanceInKm * PER_KM_DESLOCAMENTO_RATE);
                        modalDistanceDisplay.textContent = `${distanceInKm.toFixed(2)} km`;
                    }
                    currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost;
                    modalCalculatedDeslocamentoDisplay.textContent = formatCurrency(currentDeslocamentoCost);
                    modalDeslocamentoResultsDiv.classList.remove('hidden');
                    modalDeslocamentoError.classList.add('hidden');
                } else {
                    modalDeslocamentoError.textContent = "Não foi possível calcular o deslocamento para o endereço fornecido.";
                    modalDeslocamentoError.classList.remove('hidden');
                    modalDeslocamentoResultsDiv.classList.add('hidden');
                    currentDeslocamentoCost = 0;
                    currentFinalTotalPrice = currentPlanOnlyPrice;
                }
                if (callback) callback();
            });
        }

        /**
         * Inicializa a API do Google Maps e o Places Autocomplete.
         * Esta função é chamada como um callback pelo script do Google Maps.
         */
        function initMap() {
            mapsInitialized = true;
            console.log("Google Maps API carregada.");
            geocoder = new google.maps.Geocoder(); // Inicializa o geocoder para geocodificação reversa
            const input = document.getElementById('modal-destination-address');
            if (input) {
                autocomplete = new google.maps.places.Autocomplete(input, { types: ['address'], componentRestrictions: { country: 'br' } });
                autocomplete.addListener('place_changed', () => {
                    const place = autocomplete.getPlace();
                    if (place.formatted_address && place.geometry && place.geometry.location) {
                        selectedPlaceDetails.address = place.formatted_address;
                        selectedPlaceDetails.lat = place.geometry.location.lat();
                        selectedPlaceDetails.lng = place.geometry.location.lng();
                        selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${selectedPlaceDetails.lng}`;
                        calculateDeslocamentoInModal(selectedPlaceDetails.lat, selectedPlaceDetails.lng); // Passa lat/lng para cálculo preciso
                    } else {
                        // Se o preenchimento automático não fornecer detalhes completos, limpa selectedPlaceDetails e usa a entrada bruta
                        selectedPlaceDetails.address = input.value;
                        selectedPlaceDetails.lat = null;
                        selectedPlaceDetails.lng = null;
                        selectedPlaceDetails.googleMapsUrl = '';
                        calculateDeslocamentoInModal(input.value); // Retorna para a string do endereço
                    }
                });
            }
        }

        /**
         * Abre o modal de seleção de mapa e inicializa/atualiza o mapa.
         */
        function openMapSelectionModal() {
            const mapSelectionModal = document.getElementById('map-selection-modal');
            showAnimatedModal(mapSelectionModal); // Usa show animado

            if (!map) {
                // Inicializa o mapa apenas uma vez quando o modal é aberto pela primeira vez
                const mapCanvas = document.getElementById('map-canvas');
                map = new google.maps.Map(mapCanvas, {
                    center: { lat: -14.235, lng: -51.925 }, // Centro do Brasil
                    zoom: 4,
                    fullscreenControl: false,  
                    mapTypeControl: true, // Habilita o controle de tipo de mapa
                    mapTypeControlOptions: {
                        style: google.maps.MapTypeControlStyle.DROPDOWN_MENU, // Ou HORIZONTAL_BAR
                        position: google.maps.ControlPosition.TOP_RIGHT, // Posiciona o controle
                    },
                    streetViewControl: false,  
                    zoomControl: true,  
                });

                marker = new google.maps.Marker({
                    map: map,
                    draggable: true,
                    animation: google.maps.Animation.DROP,
                });

                // Ouve cliques no mapa para colocar o marcador
                map.addListener('click', (e) => {
                    placeMarkerAndMapanTo(e.latLng, map);
                });

                // Ouve o fim do arrasto do marcador para atualizar a localização
                marker.addListener('dragend', () => {
                    placeMarkerAndMapanTo(marker.getPosition(), map);
                });
            }

            // Tenta definir o centro inicial do mapa com base na entrada de endereço atual ou seleção anterior
            const currentAddress = modalDestinationAddressInput.value.trim();
            if (currentAddress && geocoder) {
                geocoder.geocode({ 'address': currentAddress }, (results, status) => {
                    if (status === 'OK' && results[0] && results[0].geometry && results[0].geometry.location) {
                        map.setCenter(results[0].geometry.location);
                        map.setZoom(15); // Zoom na endereço específico
                        placeMarkerAndMapanTo(results[0].geometry.location, map);
                    } else {
                        // Retorna para o centro padrão se a geocodificação falhar ou não houver endereço
                        map.setCenter({ lat: -14.235, lng: -51.925 });
                        map.setZoom(4);
                        marker.setMap(null); // Oculta o marcador se não houver endereço específico para centralizar
                    }
                });
            } else if (selectedPlaceDetails.lat && selectedPlaceDetails.lng) {
                // Se uma localização foi previamente selecionada no mapa, centraliza nela
                map.setCenter({ lat: selectedPlaceDetails.lat, lng: selectedPlaceDetails.lng });
                map.setZoom(15);
                placeMarkerAndMapanTo(new google.maps.LatLng(selectedPlaceDetails.lat, selectedPlaceDetails.lng), map);
            } else {
                // Centro padrão se não houver endereço ou seleção anterior
                map.setCenter({ lat: -14.235, lng: -51.925 });
                map.setZoom(4);
                marker.setMap(null); // Oculta o marcador inicialmente
            }

            // Isso garante que o mapa seja redimensionado corretamente se o modal estiver oculto
            google.maps.event.trigger(map, 'resize');
        }

        /**
         * Coloca um marcador no mapa e move a visualização para sua localização, então geocodifica o endereço.
         * @param {google.maps.LatLng} latLng - A latitude e longitude para colocar o marcador.
         * @param {google.maps.Map} mapInstance - A instância do mapa.
         */
        function placeMarkerAndMapanTo(latLng, mapInstance) {
            marker.setPosition(latLng);
            marker.setMap(mapInstance); // Garante que o marcador esteja visível
            mapInstance.panTo(latLng);

            // Geocodificação reversa para obter o endereço legível
            geocoder.geocode({ 'location': latLng }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    selectedPlaceDetails.address = results[0].formatted_address;
                    selectedPlaceDetails.lat = latLng.lat();
                    selectedPlaceDetails.lng = latLng.lng();
                    selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${selectedPlaceDetails.lng}`;
                } else {
                    selectedPlaceDetails.address = `Coordenadas: ${latLng.lat().toFixed(4)}, ${latLng.lng().toFixed(4)}`;
                    selectedPlaceDetails.lat = latLng.lat();
                    selectedPlaceDetails.lng = latLng.lng();
                    selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${latLng.lng()}`;
                    console.warn('Nenhum endereço encontrado para as coordenadas selecionadas, usando lat/lng.');
                }
            });
        }

        /**
         * Confirma a localização selecionada no mapa e atualiza o campo de endereço do modal principal.
         */
        function confirmMapLocation() {
            if (selectedPlaceDetails.lat !== null && selectedPlaceDetails.lng !== null) {
                modalDestinationAddressInput.value = selectedPlaceDetails.address;
                // Aciona o cálculo de distância com base na lat/lng precisa do mapa
                calculateDeslocamentoInModal(selectedPlaceDetails.lat, selectedPlaceDetails.lng);
            }
            hideAnimatedModal(document.getElementById('map-selection-modal')); // Usa hide animado
        }

        /**
         * Envia a mensagem formatada do WhatsApp com detalhes do plano e localização.
         * @param {object} plan - Detalhes do plano selecionado.
         * @param {string} paymentMethod - Método de pagamento selecionado.
         * @param {number} installments - Número de parcelas.
         * @param {number} totalAmountWithFees - Valor total incluindo taxas.
         * @param {number} installmentValue - Valor por parcela.
         */
        function sendWhatsAppMessage(plan, paymentMethod, installments, totalAmountWithFees, installmentValue) {
            // Prefere o endereço e URL da seleção do mapa, caso contrário, retorna para o campo de entrada
            const destinationAddress = selectedPlaceDetails.address || modalDestinationAddressInput.value;
            const googleMapsLink = selectedPlaceDetails.googleMapsUrl;
            const distanceText = modalDistanceDisplay.textContent;
            const referenceLocationText = referenceLocationInput.value.trim(); // Obtém o texto do local de referência
            
            let message = `*Solicitação de Orçamento - ${plan.type}*\n\n`;
            message += `Olá! Tenho interesse no plano *${plan.name}*.\n\n`;
            message += `*Detalhes do Evento:*\n`;
            const [year, month, day] = ceremonyDate.split('-');
            message += `• *Data:* ${day}/${month}/${year}\n`;
            message += `• *Horário:* ${ceremonyTime}\n`;
            message += `• *Endereço:* ${destinationAddress}\n`;
            if (referenceLocationText) { // Adiciona o local de referência se disponível
                message += `• *Local de Referência:* ${referenceLocationText}\n`;
            }
            if (googleMapsLink) {
                message += `• *Localização no Mapa:* ${googleMapsLink}\n\n`; // Adiciona o link do mapa
            } else {
                message += `\n`; // Adiciona uma nova linha mesmo que não haja link do mapa
            }
            
            message += '*Detalhes do Plano:*\n';
            plan.instruments.forEach(instName => {
                const price = INSTRUMENT_PRICES[instName];
                message += `• ${instName}: ${formatCurrency(price)}\n`;
            });

            message += `\n*Resumo do Orçamento:*\n`;
            message += `• *Valor do Contrato (Plano):* ${formatCurrency(plan.price)}\n`;
            if (currentDeslocamentoCost > 0) {
                message += `• *Valor do Deslocamento:* ${formatCurrency(currentDeslocamentoCost)} (Distância: ${distanceText})\n`;
            }
            if (paymentMethod === 'pix' || paymentMethod === 'dinheiro') {
                message += `• *Valor Total a Pagar:* ${formatCurrency(totalAmountWithFees)}\n`;
                message += `• *Pagamento:* À vista\n`; // Alterado para Pix/Dinheiro
            } else {
                message += `• *Valor Total a Pagar (com taxas):* ${formatCurrency(totalAmountWithFees)}\n`;
                message += `• *Parcelamento:* ${installments}x de ${formatCurrency(installmentValue)}\n`; // Mantido para Boleto/Cartão
            }
            
            message += `• *Forma de Pagamento:* ${paymentMethod.charAt(0).toUpperCase() + paymentMethod.slice(1)}\n`;
            if (paymentMethod === 'boleto') {
                message += `• *Vencimento do Boleto:* Todo dia ${selectedBoletoDueDate}\n`;
            }
            if (paymentMethod === 'dinheiro') {
                message += `*(Pagamento a ser verificado com o contratado)*\n`;
            }

            message += '\nGostaria de verificar a disponibilidade e mais detalhes. Obrigado!';
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, '_blank');
        }

        // --- EXECUÇÃO DO SCRIPT ---
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // Atribui elementos DOM globais
                modalDestinationAddressInput = document.getElementById('modal-destination-address');
                modalDeslocamentoError = document.getElementById('modal-deslocamento-error');
                modalDeslocamentoResultsDiv = document.getElementById('modal-deslocamento-results');
                modalDistanceDisplay = document.getElementById('modal-distance-display');
                modalCalculatedDeslocamentoDisplay = document.getElementById('modal-calculated-deslocamento-display');
                referenceLocationInput = document.getElementById('reference-location');
                nextToSummaryBtn = document.getElementById('next-to-summary-btn');
                boletoDateWarningModal = document.getElementById('boleto-date-warning-modal');
                warningDueDateSpan = document.getElementById('warning-due-date');
                warningCeremonyDateSpan = document.getElementById('warning-ceremony-date');

                // Getters de Elementos para o modal principal
                ceremonyDateInput = document.getElementById('ceremony-date');
                ceremonyTimeInput = document.getElementById('ceremony-time');
                confirmedAddressDisplay = document.getElementById('confirmed-address-display');
                modalEventDetailsError = document.getElementById('modal-event-details-error');
                paymentMethodRadios = document.querySelectorAll('input[name="payment-method"]');
                installmentOptionsDiv = document.getElementById('installment-options');
                installmentsSelect = document.getElementById('installments');
                installmentValueEl = document.getElementById('installment-value');
                boletoDueDateOptionsDiv = document.getElementById('boleto-due-date-options');
                boletoDueDateSelect = document.getElementById('boleto-due-date');
                modalBoletoDateError = document.getElementById('modal-boleto-date-error');
                feesSuffixSpan = document.getElementById('fees-suffix');
                modalPlanPriceEl = document.getElementById('modal-plan-price');
                modalFreightPriceEl = document.getElementById('modal-freight-price');
                modalTotalPriceEl = document.getElementById('modal-total-price');
                modalTotalPriceWithFeesEl = document.getElementById('modal-total-price-with-fees');

                // Getters de Elementos para a aba de resumo
                summaryPlanNameEl = document.getElementById('summary-plan-name');
                summaryEventDateEl = document.getElementById('summary-event-date');
                summaryEventAddressEl = document.getElementById('summary-event-address');
                summaryReferenceLocationDisplay = document.getElementById('summary-reference-location-display');
                summaryReferenceLocationEl = document.getElementById('summary-reference-location');
                summaryPlanPriceEl = document.getElementById('summary-plan-price');
                summaryDeslocamentoPriceEl = document.getElementById('summary-deslocamento-price');
                summaryTotalPriceEl = document.getElementById('summary-total-price');
                summaryTotalWithFeesEl = document.getElementById('summary-total-price-with-fees');
                summaryPaymentMethodEl = document.getElementById('summary-payment-method');
                summaryInstallmentDetailsDiv = document.getElementById('summary-installment-details');
                summaryInstallmentsEl = document.getElementById('summary-installments');
                summaryBoletoDueDateDetailsDiv = document.getElementById('summary-boleto-due-date-details');
                summaryBoletoDueDateEl = document.getElementById('summary-boleto-due-date');
                feesExplanationDiv = document.getElementById('fees-explanation');
                summaryFeesSuffixSpan = document.getElementById('summary-fees-suffix');


                // --- CONFIGURAÇÃO DE MODAL E ANIMAÇÃO ---
                // O atributo 'hidden' agora é tratado por CSS display: none.
                // O JavaScript agora apenas alternará style.display.

                const animatedItems = document.querySelectorAll('.animated-item');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible'); // Mantém para animação inicial
                            // Adiciona uma flag para que o efeito de rolagem possa direcioná-lo
                            entry.target.dataset.hasBeenVisible = 'true';
                        } else {
                            // Opcional: se você quiser que eles animem de volta ao rolar para fora
                            // entry.target.classList.remove('visible');
                            // entry.target.dataset.hasBeenVisible = 'false'; // Redefine a flag se necessário
                        }
                    });
                }, { threshold: 0.1 });
                animatedItems.forEach(item => observer.observe(item));

                // Nova função de animação de rolagem dinâmica
                function applyDynamicScrollEffects() {
                    animatedItems.forEach(element => {
                        // Aplica efeitos dinâmicos apenas a elementos que já estão visíveis (após a animação inicial)
                        if (element.classList.contains('visible')) {
                            const rect = element.getBoundingClientRect();
                            const viewportHeight = window.innerHeight;

                            // Calcula o centro do elemento em relação à viewport
                            const elementCenter = rect.top + rect.height / 2;
                            const viewportCenter = viewportHeight / 2;

                            // Define a "zona ativa" (onde a escala/opacidade é 1)
                            // Por exemplo, quando o elemento está dentro de 20% das bordas superior/inferior da viewport.
                            const activeZoneStart = viewportHeight * 0.2; // 20% do topo
                            const activeZoneEnd = viewportHeight * 0.8;   // 80% do topo

                            let scale = 1;
                            let opacity = 1;
                            let translateY = 0; // Este translateY é relativo à posição natural do elemento (após a entrada inicial)

                            if (elementCenter < activeZoneStart) { // Elemento está subindo, passando da zona ativa superior
                                // Calcula o progresso à medida que ele se move de activeZoneStart para o topo da viewport
                                let progressOutOfView = 1 - (elementCenter / activeZoneStart); // 0 em activeZoneStart, 1 na borda superior (aprox)
                                progressOutOfView = Math.min(1, Math.max(0, progressOutOfView));

                                scale = 1 - (progressOutOfView * 0.2); // Diminui em até 20%
                                opacity = 1 - (progressOutOfView * 0.7); // Desaparece em até 70%
                                translateY = -50 * progressOutOfView; // Move ligeiramente para cima
                            } else if (elementCenter > activeZoneEnd) { // Elemento está descendo, passando da zona ativa inferior
                                // Calcula o progresso à medida que ele se move de activeZoneEnd para o fundo da viewport
                                let progressOutOfView = (elementCenter - activeZoneEnd) / (viewportHeight - activeZoneEnd); // 0 em activeZoneEnd, 1 na borda inferior (aprox)
                                progressOutOfView = Math.min(1, Math.max(0, progressOutOfView));

                                scale = 1 - (progressOutOfView * 0.2); // Diminui em até 20%
                                opacity = 1 - (progressOutOfView * 0.7); // Desaparece em até 70%
                                translateY = 50 * progressOutOfView; // Move ligeiramente para baixo
                            }

                            // Aplica os estilos dinâmicos diretamente. Isso substituirá o transform/opacity da classe .visible.
                            // A propriedade de transição em .animated-item tornará essas mudanças suaves.
                            element.style.transform = `translateY(${translateY}px) scale(${scale})`;
                            element.style.opacity = opacity;
                        }
                    });
                }

                window.addEventListener('scroll', applyDynamicScrollEffects);
                // Chamada inicial para definir estados no carregamento para elementos já visíveis
                applyDynamicScrollEffects();


                // --- BARRA DE NAVEGAÇÃO E MENU MOBILE ---
                const navbar = document.getElementById('navbar');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                if (navbar && mobileMenuButton && mobileMenu) {
                    // Adiciona/remove a classe 'navbar-scrolled' com base na posição de rolagem
                    window.onscroll = () => {
                        if (window.scrollY > 50) {
                            navbar.classList.add('navbar-scrolled');
                        } else {
                            navbar.classList.remove('navbar-scrolled');
                        }
                    };
                    mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
                    document.querySelectorAll('.nav-link-mobile').forEach(link => {
                        link.addEventListener('click', () => mobileMenu.classList.add('hidden'));
                    });
                }
                
                // --- CONSTRUTOR DE PLANOS PERSONALIZADOS ---
                const bandInstruments = [
                    { name: 'Violão', price: 200 }, { name: 'Contrabaixo', price: 200 }, { name: 'Guitarra', price: 200 },
                ];
                const guestInstruments = [
                    { name: 'Saxofone', price: 500 }, { name: 'Violino', price: 500 }
                ];
                const bandOptionsContainer = document.getElementById('band-instrument-options');
                const guestOptionsContainer = document.getElementById('guest-instrument-options');
                const simulateBtnCustom = document.getElementById('simulate-btn-custom');
                const selectedInstruments = new Set();

                /**
                 * Calcula o preço total para o plano personalizado com base nos instrumentos selecionados.
                 * @returns {number} O preço calculado.
                 */
                function calculateCustomPlanPrice() {
                    let price = BASE_PLAN_PRICE;
                    selectedInstruments.forEach(name => {
                        const instrument = [...bandInstruments, ...guestInstruments].find(i => i.name === name);
                        if (instrument) price += instrument.price;
                    });
                    return price;
                }

                /**
                 * Cria um elemento de checkbox para um instrumento e o anexa ao contêiner.
                 * @param {object} instrument - O objeto do instrumento com nome e preço.
                 * @param {HTMLElement} container - O elemento DOM ao qual anexar o checkbox.
                 */
                function createCheckbox(instrument, container) {
                    const label = document.createElement('label');
                    label.className = 'custom-plan-checkbox-label'; /* Aplica a nova classe personalizada */
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.dataset.name = instrument.name;
                    checkbox.className = 'form-checkbox h-5 w-5 rounded custom-checkbox focus:ring-gold';
                    const span = document.createElement('span');
                    span.className = 'text-gray-200 transition-colors duration-200'; /* Cor do texto ajustada para tema escuro */
                    span.textContent = `${instrument.name} (+ ${formatCurrency(instrument.price)})`;
                    label.appendChild(checkbox);
                    label.appendChild(span);
                    container.appendChild(label);
                    checkbox.addEventListener('change', (e) => {
                        e.target.checked ? selectedInstruments.add(e.target.dataset.name) : selectedInstruments.delete(e.target.dataset.name);
                    });
                }

                if(bandOptionsContainer && guestOptionsContainer){
                    bandInstruments.forEach(inst => createCheckbox(inst, bandOptionsContainer));
                    guestInstruments.forEach(inst => createCheckbox(inst, guestOptionsContainer));
                }

                // --- LÓGICA DO MODAL PRINCIPAL ---
                const mainSimulationModal = document.getElementById('main-simulation-modal');
                const closeMainModalButton = document.getElementById('close-main-modal-button');
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');
                let unlockedTabs = ['deslocamento-tab']; // Inicialmente, apenas a primeira aba é desbloqueada

                /**
                 * Mostra uma aba específica dentro do modal de simulação principal.
                 * @param {string} tabId - O ID da aba a ser mostrada.
                 */
                function showTab(tabId) {
                    tabContents.forEach(content => {
                        if (content.id === tabId) {
                            content.style.display = 'block'; // Torna-o visível para transição
                            content.offsetWidth; // Força o reflow
                            content.classList.add('active');
                        } else {
                            content.classList.remove('active');
                            setTimeout(() => {
                                content.style.display = 'none';
                            }, 300); // Corresponde à duração da transição CSS
                        }
                    });

                    tabButtons.forEach(button => {
                        if (button.dataset.tab === tabId) {
                            button.classList.add('active');
                        } else {
                            button.classList.remove('active');
                        }
                    });
                    
                    if (tabId === 'event-details-tab') {
                        confirmedAddressDisplay.textContent = modalDestinationAddressInput.value || 'Endereço não informado.';
                    } else if (tabId === 'payment-method-tab') {
                        updatePaymentDetailsDisplay();
                    } else if (tabId === 'summary-tab') {
                        updateSummaryDisplay();
                    }
                }

                /**
                 * Navega para uma aba específica, desbloqueando-a se necessário.
                 * @param {string} targetTab - O ID da aba para a qual navegar.
                 */
                function navigateToTab(targetTab) {
                    if (!unlockedTabs.includes(targetTab)) {
                        unlockedTabs.push(targetTab);
                    }
                    showTab(targetTab);
                }

                // Listeners de eventos para botões de aba
                tabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const targetTab = e.target.dataset.tab;
                        if (unlockedTabs.includes(targetTab)) {
                            showTab(targetTab);
                        }
                    });
                });
                
                // Listeners de eventos para botões "Voltar"
                document.querySelectorAll('[data-navigate-tab]').forEach(button => {
                    button.addEventListener('click', (e) => showTab(e.target.dataset.navigateTab));
                });

                // Navegação para a aba Detalhes do Evento
                document.getElementById('next-to-event-details-btn').addEventListener('click', () => {
                    const address = modalDestinationAddressInput.value.trim();
                    if (!address || modalDeslocamentoResultsDiv.classList.contains('hidden')) {
                        modalDeslocamentoError.textContent = "Por favor, digite um endereço válido e aguarde o cálculo, ou selecione no mapa.";
                        modalDeslocamentoError.classList.remove('hidden');
                        return;
                    }
                    navigateToTab('event-details-tab');
                });

                // Navegação para a aba Método de Pagamento
                document.getElementById('next-to-payment-method-btn').addEventListener('click', () => {
                    ceremonyDate = ceremonyDateInput.value;
                    ceremonyTime = ceremonyTimeInput.value;
                    if (!ceremonyDate || !ceremonyTime) {
                        modalEventDetailsError.textContent = "Por favor, preencha a data e o horário da cerimônia.";
                        modalEventDetailsError.classList.remove('hidden');
                        return;
                    }
                    modalEventDetailsError.classList.add('hidden');
                    navigateToTab('payment-method-tab');
                });

                // Navegação para a aba Resumo
                document.getElementById('next-to-summary-btn').addEventListener('click', () => {
                    if (validateBoletoDueDate()) { // Valida a data do boleto antes de prosseguir
                        navigateToTab('summary-tab');
                    }
                });

                // --- ABRIR/FECHAR MODAL ---
                /**
                 * Função para mostrar qualquer modal com animação
                 * @param {HTMLElement} modalElement - O elemento DOM do modal.
                 */
                function showAnimatedModal(modalElement) {
                    if (!modalElement) return;
                    modalElement.style.display = 'flex'; // Torna-o visível para transição
                    // Força o reflow para garantir que a transição seja reproduzida
                    modalElement.offsetWidth;
                    modalElement.classList.add('show');
                }

                /**
                 * Função para ocultar qualquer modal com animação
                 * @param {HTMLElement} modalElement - O elemento DOM do modal.
                 */
                function hideAnimatedModal(modalElement) {
                    if (!modalElement) return;
                    modalElement.classList.remove('show');
                    // Após a transição, define o display como none
                    setTimeout(() => {
                        modalElement.style.display = 'none';
                    }, 400); // Corresponde à duração da transição CSS
                }

                /**
                 * Exibe o modal de simulação principal com os detalhes do plano inicial.
                 * @param {number} planPrice - O preço base do plano selecionado.
                 * @param {object} planDetails - Informações detalhadas sobre o plano.
                 */
                function showMainSimulationModal(planPrice, planDetails) {
                    showAnimatedModal(mainSimulationModal); // Usa show animado
                    currentPlanDetails = planDetails;
                    currentPlanOnlyPrice = planPrice;
                    currentDeslocamentoCost = 0; // Redefine o custo de deslocamento
                    currentFinalTotalPrice = currentPlanOnlyPrice; // Redefine o preço total

                    // Redefine os campos
                    modalDestinationAddressInput.value = '';
                    ceremonyDateInput.value = '';
                    ceremonyTimeInput.value = '';
                    referenceLocationInput.value = ''; // Redefine a entrada de local de referência
                    selectedPlaceDetails = { address: '', lat: null, lng: null, googleMapsUrl: '' }; // Redefine a seleção do mapa
                    const today = new Date().toISOString().split('T')[0];
                    ceremonyDateInput.setAttribute('min', today); // Define a data mínima para a cerimônia
                    modalDeslocamentoResultsDiv.classList.add('hidden');
                    modalDeslocamentoError.classList.add('hidden');
                    
                    // Redefine as abas e mostra a primeira
                    unlockedTabs = ['deslocamento-tab'];
                    showTab('deslocamento-tab');
                }

                // Listener do botão de fechar o modal principal
                if (closeMainModalButton) {
                    closeMainModalButton.addEventListener('click', () => {
                        hideAnimatedModal(mainSimulationModal); // Usa hide animado
                    });
                }
                // Fecha o modal principal ao clicar fora
                window.addEventListener('click', (event) => {
                    if (event.target == mainSimulationModal) {
                        hideAnimatedModal(mainSimulationModal); // Usa hide animado
                    }
                });

                // --- LISTENERS DO MODAL DE SELEÇÃO DE MAPA ---
                document.getElementById('open-map-selection-btn').addEventListener('click', openMapSelectionModal);
                document.getElementById('close-map-modal-button').addEventListener('click', () => {
                    hideAnimatedModal(document.getElementById('map-selection-modal'));
                });
                document.getElementById('confirm-map-location-btn').addEventListener('click', confirmMapLocation);
                window.addEventListener('click', (event) => {
                    if (event.target == document.getElementById('map-selection-modal')) {
                        hideAnimatedModal(document.getElementById('map-selection-modal'));
                    }
                });

                // --- MODAL DE NOTIFICAÇÃO DE BOLETO ---
                const boletoNotificationModal = document.getElementById('boleto-notification-modal');
                const closeBoletoModalButton = document.getElementById('close-boleto-modal-button');
                const okBoletoModalButton = document.getElementById('ok-boleto-modal-button');
                
                // Lógica modificada para notificações de boleto
                if (closeBoletoModalButton) {
                    closeBoletoModalButton.addEventListener('click', () => {
                        hideAnimatedModal(boletoNotificationModal);
                        // Após fechar a primeira notificação, verifica o aviso de data
                        validateBoletoDueDate();  
                    });
                }
                if (okBoletoModalButton) {
                    okBoletoModalButton.addEventListener('click', () => {
                        hideAnimatedModal(boletoNotificationModal);
                        // Após reconhecer a primeira notificação, verifica o aviso de data
                        validateBoletoDueDate();
                    });
                }
                window.addEventListener('click', (event) => {
                    if (event.target == boletoNotificationModal) {
                        hideAnimatedModal(boletoNotificationModal);
                        validateBoletoDueDate();
                    }
                });

                // --- NOVO: LISTENERS DO MODAL DE AVISO DE DATA DE BOLETO ---
                document.getElementById('close-boleto-date-warning-modal-button').addEventListener('click', () => {
                    hideAnimatedModal(boletoDateWarningModal);
                });
                document.getElementById('ok-boleto-date-warning-modal-button').addEventListener('click', () => {
                    hideAnimatedModal(boletoDateWarningModal);
                });
                window.addEventListener('click', (event) => {
                    if (event.target == boletoDateWarningModal) {
                        hideAnimatedModal(boletoDateWarningModal);
                    }
                });

                // --- LÓGICA DE PAGAMENTO ---
                paymentMethodRadios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        selectedPaymentMethod = radio.value;
                        selectedInstallments = 1; // Redefine as parcelas na mudança de método
                        updateInstallmentOptions();
                        updatePaymentDetailsDisplay();
                        // Mostra apenas a primeira notificação de boleto aqui.
                        // O aviso de data será acionado depois que este for fechado.
                        if (selectedPaymentMethod === 'boleto') {
                            showAnimatedModal(boletoNotificationModal);
                        } else {
                            hideAnimatedModal(boletoNotificationModal); // Garante que esteja oculto se não for boleto
                            hideAnimatedModal(boletoDateWarningModal); // Garante que o aviso de data também esteja oculto
                        }
                    });
                });

                installmentsSelect.addEventListener('change', (e) => {
                    selectedInstallments = parseInt(e.target.value);
                    updatePaymentDetailsDisplay();
                });
                
                boletoDueDateSelect.addEventListener('change', (e) => {
                    selectedBoletoDueDate = parseInt(e.target.value);
                    updatePaymentDetailsDisplay();
                });

                /**
                 * Atualiza as opções de parcelamento suspensas com base no método de pagamento selecionado.
                 */
                function updateInstallmentOptions() {
                    installmentsSelect.innerHTML = '';
                    let maxInstallments = 1;
                    if (selectedPaymentMethod === 'boleto') maxInstallments = 5;
                    else if (selectedPaymentMethod === 'cartao') maxInstallments = 12;

                    for (let i = 1; i <= maxInstallments; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = `${i}x`;
                        installmentsSelect.appendChild(option);
                    }
                    installmentsSelect.value = selectedInstallments;
                }

                /**
                 * Atualiza a exibição dos detalhes de pagamento no modal com base nas opções selecionadas.
                 */
                function updatePaymentDetailsDisplay() {
                    let calculatedTotalForPayment = currentFinalTotalPrice;
                    let finalInstallmentValue = 0;

                    boletoDueDateOptionsDiv.style.display = (selectedPaymentMethod === 'boleto') ? 'block' : 'none';
                    installmentOptionsDiv.style.display = (selectedPaymentMethod === 'boleto' || selectedPaymentMethod === 'cartao') ? 'block' : 'none';
                    feesSuffixSpan.style.display = 'none';

                    if (selectedPaymentMethod === 'boleto') {
                        calculatedTotalForPayment += (BOLETO_PER_INSTALLMENT_FEE * selectedInstallments);
                        feesSuffixSpan.style.display = 'inline';
                    } else if (selectedPaymentMethod === 'cartao') {
                        const percentageFee = CREDIT_CARD_TOTAL_PERCENTAGES[selectedInstallments];
                        if (percentageFee) {
                            calculatedTotalForPayment = currentFinalTotalPrice / (1 - percentageFee);
                        }
                        feesSuffixSpan.style.display = 'inline';
                    }
                    
                    finalInstallmentValue = calculatedTotalForPayment / selectedInstallments;
                    
                    modalPlanPriceEl.textContent = formatCurrency(currentPlanOnlyPrice);
                    modalFreightPriceEl.textContent = formatCurrency(currentDeslocamentoCost);
                    modalTotalPriceEl.textContent = formatCurrency(currentFinalTotalPrice);
                    modalTotalPriceWithFeesEl.textContent = formatCurrency(calculatedTotalForPayment);
                    installmentValueEl.textContent = formatCurrency(finalInstallmentValue);

                    // NÃO chame validateBoletoDueDate aqui diretamente se selectedPaymentMethod for boleto
                    // Será chamado depois que a primeira notificação for fechada.
                    if (selectedPaymentMethod !== 'boleto') {
                        validateBoletoDueDate();
                    }
                }
                
                /**
                 * Valida se a data da última parcela do boleto é anterior à data da cerimônia.
                 * Exibe um modal de aviso se não for.
                 * @returns {boolean} True se a validação passar, false caso contrário.
                 */
                function validateBoletoDueDate() {
                    // Realiza a validação apenas se o método de pagamento for boleto e uma data de cerimônia for definida
                    if (selectedPaymentMethod !== 'boleto' || !ceremonyDate) {
                        modalBoletoDateError.classList.add('hidden'); // Oculta o erro inline
                        hideAnimatedModal(boletoDateWarningModal); // Oculta o modal de aviso
                        if (nextToSummaryBtn) nextToSummaryBtn.disabled = false;
                        return true;
                    }

                    const today = new Date();
                    const ceremony = new Date(ceremonyDate + 'T23:59:59'); // Fim do dia da cerimônia
                    
                    let firstPaymentDate = new Date(today.getFullYear(), today.getMonth(), selectedBoletoDueDate);
                    // Se a data do primeiro pagamento estiver no passado ou hoje, define-a para o próximo mês
                    if (firstPaymentDate <= today) {
                        firstPaymentDate.setMonth(firstPaymentDate.getMonth() + 1);
                    }

                    let lastPaymentDate = new Date(firstPaymentDate);
                    lastPaymentDate.setMonth(lastPaymentDate.getMonth() + selectedInstallments - 1);

                    if (lastPaymentDate > ceremony) {
                        // Exibe o modal de aviso elaborado
                        warningDueDateSpan.textContent = selectedBoletoDueDate;
                        const [year, month, day] = ceremonyDate.split('-');
                        warningCeremonyDateSpan.textContent = `${day}/${month}/${year}`;
                        showAnimatedModal(boletoDateWarningModal);
                        
                        modalBoletoDateError.textContent = "A data da última parcela não pode ser posterior à data da cerimônia. Por favor, ajuste as parcelas ou a data de vencimento.";
                        modalBoletoDateError.classList.remove('hidden'); // Mantém o erro inline para consistência, embora o modal seja primário
                        if (nextToSummaryBtn) nextToSummaryBtn.disabled = true;
                        return false;
                    } else {
                        modalBoletoDateError.classList.add('hidden'); // Oculta o erro inline
                        hideAnimatedModal(boletoDateWarningModal); // Oculta o aviso do modal
                        if (nextToSummaryBtn) nextToSummaryBtn.disabled = false;
                        return true;
                    }
                }

                // --- LÓGICA DO RESUMO ---
                /**
                 * Atualiza a exibição do resumo no modal com todos os detalhes selecionados.
                 */
                function updateSummaryDisplay() {
                    let calculatedTotalForSummary = currentFinalTotalPrice;
                    let finalInstallmentValueForSummary = 0;
                    let paymentMethodText = '';

                    summaryFeesSuffixSpan.style.display = 'none';
                    feesExplanationDiv.classList.add('hidden');
                    summaryBoletoDueDateDetailsDiv.classList.add('hidden');

                    if (selectedPaymentMethod === 'boleto') {
                        calculatedTotalForSummary += (BOLETO_PER_INSTALLMENT_FEE * selectedInstallments);
                        paymentMethodText = 'Boleto';
                        feesExplanationDiv.classList.remove('hidden');
                        summaryFeesSuffixSpan.style.display = 'inline';
                        summaryBoletoDueDateDetailsDiv.classList.remove('hidden');
                        summaryBoletoDueDateEl.textContent = `Todo dia ${selectedBoletoDueDate}`;
                    } else if (selectedPaymentMethod === 'cartao') {
                        const percentageFee = CREDIT_CARD_TOTAL_PERCENTAGES[selectedInstallments];
                        if (percentageFee) calculatedTotalForSummary = currentFinalTotalPrice / (1 - percentageFee);
                        paymentMethodText = 'Cartão de Crédito';
                        feesExplanationDiv.classList.remove('hidden');
                        summaryFeesSuffixSpan.style.display = 'inline';
                    } else if (selectedPaymentMethod === 'pix') {
                        paymentMethodText = 'Pix';
                    } else if (selectedPaymentMethod === 'dinheiro') {
                        paymentMethodText = 'Dinheiro (a verificar com o contratado)';
                    }

                    finalInstallmentValueForSummary = calculatedTotalForSummary / selectedInstallments;

                    summaryPlanNameEl.textContent = currentPlanDetails.name;
                    const [year, month, day] = ceremonyDate.split('-');
                    summaryEventDateEl.textContent = `${day}/${month}/${year} às ${ceremonyTime}`;
                    summaryEventAddressEl.textContent = selectedPlaceDetails.address || modalDestinationAddressInput.value; // Usa o endereço selecionado ou a entrada
                    
                    // Atualiza e mostra/oculta o local de referência no resumo
                    if (referenceLocationInput.value.trim()) {
                        summaryReferenceLocationEl.textContent = referenceLocationInput.value.trim();
                        summaryReferenceLocationDisplay.style.display = 'block';
                    } else {
                        summaryReferenceLocationEl.textContent = '';
                        summaryReferenceLocationDisplay.style.display = 'none';
                    }

                    summaryPlanPriceEl.textContent = formatCurrency(currentPlanOnlyPrice);
                    summaryDeslocamentoPriceEl.textContent = formatCurrency(currentDeslocamentoCost);
                    summaryTotalPriceEl.textContent = formatCurrency(currentFinalTotalPrice);
                    summaryTotalWithFeesEl.textContent = formatCurrency(calculatedTotalForSummary);
                    summaryPaymentMethodEl.textContent = paymentMethodText;
                    // Exibe condicionalmente "Pagamento à vista" ou "Parcelamento"
                    if (selectedPaymentMethod === 'pix' || selectedPaymentMethod === 'dinheiro') {
                        summaryInstallmentDetailsDiv.innerHTML = `Pagamento: <span class="font-bold text-gold">À vista</span>`;
                    } else {
                        summaryInstallmentDetailsDiv.innerHTML = `Parcelamento: <span class="font-bold text-gold">${selectedInstallments}x de ${formatCurrency(finalInstallmentValueForSummary)}</span>`;
                    }
                }

                // --- WHATSAPP E SIMULAÇÃO ---
                document.getElementById('confirm-simulation-btn').addEventListener('click', () => {
                    const totalAmountWithFees = parseFloat(summaryTotalWithFeesEl.textContent.replace('R$', '').replace(',', '.'));
                    // Obtém com segurança o valor da parcela, padronizando para o total se não aplicável (ex: Pix/Dinheiro)
                    const installmentValuePerInstallment = parseFloat(summaryInstallmentDetailsDiv.textContent.split('de ')[1]?.replace('R$', '').replace(',', '.') || totalAmountWithFees);
                    sendWhatsAppMessage(currentPlanDetails, selectedPaymentMethod, selectedInstallments, totalAmountWithFees, installmentValuePerInstallment);
                    hideAnimatedModal(mainSimulationModal); // Usa hide animado
                });

                /**
                 * Função global para lidar com cliques nos botões "Simular" para planos predefinidos.
                 * @param {string} planName - O nome do plano.
                 * @param {string[]} instruments - Um array de instrumentos incluídos no plano.
                 * @param {number} price - O preço do plano.
                 */
                window.handleSimular = function(planName, instruments, price) {
                    const planDetails = {
                        type: 'Plano Pronto', name: planName, instruments: instruments, price: price
                    };
                    showMainSimulationModal(price, planDetails); // Chama a função show
                };

                // Listener de evento para o botão "Simular" do plano personalizado
                if(simulateBtnCustom){
                    simulateBtnCustom.addEventListener('click', () => {
                        const customPlanPrice = calculateCustomPlanPrice();
                        const planDetails = {
                            type: 'Plano Personalizado', name: 'Plano Personalizado',
                            instruments: ['3 Vozes + Teclado/Piano', ...Array.from(selectedInstruments)],
                            price: customPlanPrice
                        };
                        showMainSimulationModal(customPlanPrice, planDetails); // Chama a função show
                    });
                }

                // --- CÁLCULO DE DESLOCAMENTO ---
                // Debounce de entrada para cálculo de endereço para evitar chamadas excessivas à API
                modalDestinationAddressInput.addEventListener('input', () => {
                    clearTimeout(debounceTimer);
                    const address = modalDestinationAddressInput.value.trim();
                    if (address.length > 3) {
                        debounceTimer = setTimeout(() => {
                            // Ao digitar, usa a string do endereço para cálculo
                            calculateDeslocamentoInModal(address);
                            // Também tenta geocodificar e armazenar lat/lng para o link do WhatsApp, mas não força a seleção do mapa
                            if (geocoder) {
                                geocoder.geocode({ 'address': address }, (results, status) => {
                                    if (status === 'OK' && results[0] && results[0].geometry && results[0].geometry.location) {
                                        selectedPlaceDetails.address = results[0].formatted_address;
                                        selectedPlaceDetails.lat = results[0].geometry.location.lat();
                                        selectedPlaceDetails.lng = results[0].geometry.location.lng();
                                        selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${selectedPlaceDetails.lng}`;
                                    } else {
                                        selectedPlaceDetails.lat = null;
                                        selectedPlaceDetails.lng = null;
                                        selectedPlaceDetails.googleMapsUrl = '';
                                    }
                                });
                            }
                        }, 500); // Atraso de 500ms
                    } else {
                        modalDeslocamentoResultsDiv.classList.add('hidden');
                        modalDeslocamentoError.classList.add('hidden');
                        currentDeslocamentoCost = 0;
                        currentFinalTotalPrice = currentPlanOnlyPrice;
                        selectedPlaceDetails = { address: '', lat: null, lng: null, googleMapsUrl: '' }; // Limpa os dados do mapa
                    }
                });
                
                // --- MEDIDAS DE SEGURANÇA PARA DIFICULTAR A INSPEÇÃO ---
                // Desabilita o menu de contexto do botão direito
                document.addEventListener('contextmenu', event => event.preventDefault());

                // Desabilita atalhos de teclado específicos para ferramentas de desenvolvedor e visualização de código-fonte
                document.addEventListener('keydown', event => {
                    // Tecla F12
                    if (event.key === 'F12') {
                        event.preventDefault();
                    }
                    // Ctrl+Shift+I, Ctrl+Shift+J (Ferramentas do Desenvolvedor)
                    // Ctrl+U (Ver Código-Fonte)
                    // Ctrl+S (Salvar Página)
                    if (event.ctrlKey && event.shiftKey && (event.key === 'I' || event.key === 'J')) {
                        event.preventDefault();
                    }
                    if (event.ctrlKey && event.key === 'U') {
                        event.preventDefault();
                    }
                    if (event.ctrlKey && event.key === 'S') {
                        event.preventDefault();
                    }
                });

            } catch (error) {
                console.error("Erro durante o carregamento do script:", error);
            }
        });
    </script>
</body>
</html>
