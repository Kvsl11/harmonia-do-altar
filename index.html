<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmonia do Altar</title>
    <link rel="icon" href="H.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #FDFBF8; /* Softer background color */
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        .text-gold {
            color: #b69260; /* Updated gold color */
        }
        .bg-gold {
            background-color: #b69260; /* Updated gold color */
        }
        .border-gold {
            border-color: #b69260; /* Updated gold color */
        }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.55)), url('https://images.pexels.com/photos/169198/pexels-photo-169198.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }
        
        /* Media Cropper for Instagram videos */
        .media-cropper {
            position: relative;
            overflow: hidden;
            padding-top: 100%;
            border-radius: 12px;
            background-color: #e0e0e0;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .media-cropper .instagram-media {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            transform: scale(1.25) translateY(-4.5%);
            border: none !important;
            box-shadow: none !important;
            margin: 0 !important;
        }
        
        /* Animations */
        .animated-item {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .animated-item.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .animated-item.delay-1 { transition-delay: 0.1s; }
        .animated-item.delay-2 { transition-delay: 0.2s; }
        .animated-item.delay-3 { transition-delay: 0.3s; }

        /* Custom checkbox style */
        .custom-checkbox:checked {
            background-color: #b69260; /* Updated gold color */
            border-color: #b69260; /* Updated gold color */
        }
        .custom-checkbox:checked + span {
            color: #b69260; /* Updated gold color */
        }
        
        /* Navlink style */
        .nav-link {
            position: relative;
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #b69260; /* Updated gold color */
            transition: width 0.3s;
        }
        .nav-link:hover {
            color: #b69260; /* Updated gold color */
        }
        .nav-link:hover::after {
            width: 100%;
        }

        section[id] {
            scroll-margin-top: 80px;
        }

        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar for Webkit browsers (Chrome, Safari) */
        ::-webkit-scrollbar {
            width: 8px; /* Make it slightly thinner */
        }

        ::-webkit-scrollbar-track {
            background: transparent; /* Changed to transparent to remove the visible track */
        }

        ::-webkit-scrollbar-thumb {
            background: #b69260; /* Updated gold color for the scrollbar thumb */
            border-radius: 10px; /* Keep rounded corners for the thumb */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a08154; /* Darker gold on hover */
        }

        /* Tab styles */
        .tab-header {
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-weight: 600;
            color: #888;
            transition: color 0.3s, border-bottom 0.3s;
        }
        .tab-button.active {
            color: #b69260; /* Updated gold color */
            border-bottom: 2px solid #b69260; /* Updated gold color */
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="text-gray-800">

    <nav id="navbar" class="fixed top-0 left-0 w-full z-50 transition-all duration-300 py-2">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="#" class="text-white text-2xl font-bold font-playfair flex items-center">
                <img src="H.png" alt="Logo Harmonia do Altar" class="h-10 mr-2 inline-block" onerror="this.onerror=null; this.src='https://placehold.co/40x40/ffffff/b69260?text=H'">armonia do Altar
            </a>
            
            <div class="hidden md:flex space-x-8">
                <a href="#sobre" class="nav-link">Sobre</a>
                <a href="#galeria" class="nav-link">Galeria</a>
                <a href="#planos" class="nav-link">Planos</a>
                <!-- Removed Deslocamento from main navigation -->
                <a href="#contato" class="nav-link">Contato</a>
            </div>

            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800 bg-opacity-95">
            <a href="#sobre" class="nav-link-mobile block py-3 px-6 text-sm text-white hover:bg-gold transition-colors">Sobre</a>
            <a href="#galeria" class="nav-link-mobile block py-3 px-6 text-sm text-white hover:bg-gold transition-colors">Galeria</a>
            <a href="#planos" class="nav-link-mobile block py-3 px-6 text-sm text-white hover:bg-gold transition-colors">Planos</a>
            <!-- Removed Deslocamento from mobile navigation -->
            <a href="#contato" class="nav-link-mobile block py-3 px-6 text-sm text-white hover:bg-gold transition-colors">Contato</a>
        </div>
    </nav>

    <header class="hero-bg text-white shadow-lg h-screen flex items-center justify-center">
        <div class="text-center">
            <h1 class="text-5xl md:text-7xl font-bold mb-2 animated-item">
                <img src="H.png" alt="Logo Harmonia do Altar" class="h-20 md:h-32 inline-block align-middle mr-4" onerror="this.onerror=null; this.src='https://placehold.co/128x128/ffffff/b69260?text=H'">armonia do Altar
            </h1>
            <p class="text-xl md:text-2xl font-light animated-item delay-1">A Trilha Sonora Perfeita para o Seu Grande Dia</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12 md:py-20">
        
        <section id="sobre" class="text-center max-w-4xl mx-auto mb-16 md:mb-24 animated-item">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">Música que Conta a Sua História</h2>
            <div class="w-20 h-1 bg-gold mx-auto mb-6"></div>
            <p class="text-gray-600 leading-relaxed text-lg">
                Para nós, cada casamento é a celebração de uma história de amor única. E toda grande história merece uma trilha sonora inesquecível. Somos o Harmonia do Altar, um grupo de músicos apaixonados por transformar cerimônias em eventos memoráveis. Nosso propósito é ir além da música: queremos tocar o coração de cada convidado e, principalmente, o de vocês, com arranjos que capturam a essência do seu amor e a solenidade do seu grande dia.
            </p>
        </section>
        
        <section id="galeria" class="mb-16 md:mb-24">
            <div class="animated-item">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Sinta a Nossa Harmonia</h2>
                <div class="w-20 h-1 bg-gold mx-auto mb-12"></div>
            </div>
            
            <div class="text-center max-w-3xl mx-auto animated-item">
                <h3 class="text-2xl font-bold text-gold mb-3">A Emoção em Cada Nota</h3>
                <p class="text-gray-600 mb-8">A música tem o poder de evocar sentimentos profundos. Imagine a entrada da noiva ao som de um violino emocionante, ou a troca de alianças embalada por um piano suave e vozes que se entrelaçam. É essa atmosfera que criamos.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8YQSOEsv0-/" data-instgrm-version="14"></blockquote>
                </div>
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8V3pPAsYSj/" data-instgrm-version="14"></blockquote>
                </div>
            </div>

            <div class="text-center max-w-3xl mx-auto mt-20 animated-item">
                <h3 class="text-2xl font-bold text-gold mb-3">Elegância e Profissionalismo</h3>
                <p class="text-gray-600 mb-8">Acreditamos que a beleza está na harmonia, não só musical, mas também visual. Nossos músicos se apresentam com a sofisticação que a sua cerimônia merece, e nossas performances são um reflexo do nosso compromisso com a excelência.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/C8VlkbksuVZ/" data-instgrm-version="14"></blockquote>
                </div>
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/CpBIkGaOdrZ/" data-instgrm-version="14"></blockquote>
                </div>
            </div>

            <div class="text-center max-w-3xl mx-auto mt-20 animated-item">
                <h3 class="text-2xl font-bold text-gold mb-3">Alegria e Versatilidade</h3>
                <p class="text-gray-600 mb-8">Seu casamento deve refletir sua personalidade. Do clássico ao popular, do sacro ao contemporâneo, nosso repertório é vasto e adaptável. Celebramos o amor em todos os ritmos, garantindo momentos de pura alegria e emoção.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8VkPNDsAit/" data-instgrm-version="14"></blockquote>
                </div>
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8YEx9mse1O/" data-instgrm-version="14"></blockquote>
                </div>
            </div>
        </section>

        <section id="planos" class="py-16 md:py-24 bg-white rounded-2xl shadow-sm">
            <div class="text-center max-w-4xl mx-auto mb-12 md:mb-16 animated-item">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">Nossas Configurações Sugeridas</h2>
                <div class="w-20 h-1 bg-gold mx-auto mb-6"></div>
                <p class="text-gray-600 leading-relaxed text-lg mb-8">
                    Nossa formação padrão inclui <strong>3 vozes e teclado</strong>, com a flexibilidade de adicionar outros instrumentos para personalizar sua sonoridade. O deslocamento tem tarifa fixa para <strong>Angélica/Ivinhema (MS) e valor por km para outras localidades (com um valor base).</strong> Taxas de processamento bancário aplicam-se a pagamentos via boleto e cartão (incluindo deslocamentos especiais), não sendo retidas pela Harmonia do Altar. <strong>Pix e dinheiro são isentos de taxas bancárias.</strong>
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 justify-center">
                
                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 hover:shadow-xl transition-all duration-300 flex flex-col animated-item">
                    <div class="p-8 flex-grow">
                        <!-- Font Awesome Music Icon -->
                        <i class="fas fa-music text-gold text-3xl mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Essência Clássica e Sublime</h3>
                        <p class="text-gray-600 mb-6 text-sm">A nossa formação padrão, com as <strong>3 vozes e o teclado</strong>. Perfeita para quem busca a elegância atemporal e a emoção pura.</p>
                        <h4 class="font-bold mb-2 text-sm">Instrumentos:</h4>
                        <ul class="text-gray-700 text-sm space-y-2">
                            <li>• 3 Vozes + Teclado/Piano</li>
                        </ul>
                    </div>
                    <div class="p-6 border-t bg-white flex justify-between items-center">
                        <div class="text-2xl font-bold">R$ 1.400</div>
                        <button onclick="handleContratar('Essência Clássica e Sublime', ['3 Vozes + Teclado/Piano'], 1400)" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300 text-sm">Contratar</button>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-2 hover:shadow-2xl transition-all duration-300 flex flex-col animated-item delay-1 border-2 border-gold relative">
                    <div class="absolute top-0 right-0 bg-gold text-white text-xs font-bold px-3 py-1 rounded-bl-lg">MAIS POPULAR</div>
                    <div class="p-8 flex-grow">
                        <i class="fas fa-guitar text-gold text-3xl mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Harmonia Delicada e Acústica</h3>
                        <p class="text-gray-600 mb-6 text-sm">A formação padrão com o acréscimo do <strong>violão</strong>. O som quente e dedilhado cria uma atmosfera romântica e acolhedora.</p>
                        <h4 class="font-bold mb-2 text-sm">Instrumentos:</h4>
                        <ul class="text-gray-700 text-sm space-y-2">
                            <li>• 3 Vozes + Teclado/Piano</li>
                            <li>• Violão</li>
                        </ul>
                    </div>
                    <div class="p-6 border-t bg-white flex justify-between items-center">
                        <div class="text-2xl font-bold">R$ 1.600</div>
                        <button onclick="handleContratar('Harmonia Delicada e Acústica', ['3 Vozes + Teclado/Piano', 'Violão'], 1600)" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300 text-sm">Contratar</button>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 hover:shadow-xl transition-all duration-300 flex flex-col animated-item delay-2">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-layer-group text-gold text-3xl mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Sofisticação e Envolvimento</h3>
                        <p class="text-gray-600 mb-6 text-sm">Além da base, o <strong>contrabaixo</strong> adiciona uma sonoridade mais encorpada e um groove sutil, trazendo profundidade e elegância.</p>
                        <h4 class="font-bold mb-2 text-sm">Instrumentos:</h4>
                        <ul class="text-gray-700 text-sm space-y-2">
                            <li>• 3 Vozes + Teclado/Piano</li>
                            <li>• Contrabaixo</li>
                        </ul>
                    </div>
                    <div class="p-6 border-t bg-white flex justify-between items-center">
                        <div class="text-2xl font-bold">R$ 1.600</div>
                        <button onclick="handleContratar('Sofisticação e Envolvimento', ['3 Vozes + Teclado/Piano', 'Contrabaixo'], 1600)" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300 text-sm">Contratar</button>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 hover:shadow-xl transition-all duration-300 flex flex-col animated-item">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-sliders-h text-gold text-3xl mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Sonoridade Completa e Marcante</h3>
                        <p class="text-gray-600 mb-6 text-sm">Com <strong>contrabaixo e violão</strong> somados à base, esta opção traz uma sonoridade grandiosa, preenchida e com uma textura rica.</p>
                        <h4 class="font-bold mb-2 text-sm">Instrumentos:</h4>
                        <ul class="text-gray-700 text-sm space-y-2">
                            <li>• 3 Vozes + Teclado/Piano</li>
                            <li>• Contrabaixo</li>
                            <li>• Violão</li>
                        </ul>
                    </div>
                    <div class="p-6 border-t bg-white flex justify-between items-center">
                        <div class="text-2xl font-bold">R$ 1.800</div>
                        <button onclick="handleContratar('Sonoridade Completa e Marcante', ['3 Vozes + Teclado/Piano', 'Violão', 'Contrabaixo'], 1800)" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300 text-sm">Contratar</button>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 hover:shadow-xl transition-all duration-300 flex flex-col animated-item delay-1">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-star text-gold text-3xl mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Versatilidade e Brilho Acústico</h3>
                        <p class="text-gray-600 mb-6 text-sm">A formação mais completa, com <strong>violão, guitarra e contrabaixo</strong>. Permite explorar diferentes estilos com arranjos modernos.</p>
                        <h4 class="font-bold mb-2 text-sm">Instrumentos:</h4>
                        <ul class="text-gray-700 text-sm space-y-2">
                            <li>• 3 Vozes + Teclado/Piano</li>
                            <li>• Violão</li>
                            <li>• Guitarra</li>
                            <li>• Contrabaixo</li>
                        </ul>
                    </div>
                    <div class="p-6 border-t bg-white flex justify-between items-center">
                        <div class="text-2xl font-bold">R$ 2.000</div>
                        <button onclick="handleContratar('Versatilidade e Brilho Acústico', ['3 Vozes + Teclado/Piano', 'Violão', 'Guitarra', 'Contrabaixo'], 2000)" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300 text-sm">Contratar</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="custom-plan-builder" class="bg-white rounded-2xl shadow-sm p-8 md:p-12 text-center mt-16 md:mt-24 animated-item">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">Crie o Seu Plano Personalizado</h2>
            <div class="w-20 h-1 bg-gold mx-auto mb-6"></div>
            <p class="max-w-3xl mx-auto text-gray-600 mb-8">
                Adicione instrumentos à nossa formação padrão para criar a sonoridade perfeita para o seu dia.
            </p>
            <div class="max-w-2xl mx-auto text-left">
                <div class="p-4 bg-gray-100 rounded-lg mb-4 flex justify-between items-center">
                    <span class="font-bold text-gray-700">Formação Padrão (3 Vozes + Teclado)</span>
                    <span class="font-bold text-gray-700">R$ 1.400,00</span>
                </div>
                <h4 class="text-lg font-bold text-gray-800 mt-6 mb-3">Instrumentos da Banda:</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4" id="band-instrument-options"></div>
                
                <h4 class="text-lg font-bold text-gray-800 mt-8 mb-2">Músicos Convidados: <span class="text-sm font-normal text-gray-600">(Um toque de brilho)</span></h4>
                <p class="text-sm text-gray-600 mb-4">Para uma sonoridade ainda mais especial, adicione o romantismo do violino ou a sofisticação do saxofone.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4" id="guest-instrument-options"></div>
            </div>

            <div class="mt-8 max-w-2xl mx-auto border-t pt-6">
                <!-- Removed price display elements from the main page -->
                <button id="contract-btn-custom" class="mt-6 w-full bg-gold text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300 transform hover:scale-105">Contratar Plano Personalizado</button>
            </div>
        </section>

    </main>

    <footer id="contato" class="bg-gray-800 text-white mt-12 md:mt-20">
        <div class="container mx-auto px-6 py-12 text-center animated-item">
            <h2 class="text-3xl font-bold mb-4">Vamos Conversar?</h2>
            <p class="max-w-3xl mx-auto mb-6 text-gray-300">
                Estamos aqui para tirar todas as dúvidas e garantir que cada nota no seu grande dia seja exatamente como vocês sonham.
            </p>
            <a href="https://wa.me/5567996884226?text=Olá!%20Vi%20o%20site%20do%20Harmonia%20do%20Altar%20e%20gostaria%20de%20um%20orçamento." target="_blank" rel="noopener noreferrer" class="bg-green-500 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-green-600 transition-colors duration-300 transform hover:scale-105 inline-block">
                <i class="fab fa-whatsapp mr-2"></i> Chamar no WhatsApp
            </a>
            <div class="flex justify-center space-x-6 mt-8">
                <a href="https://www.instagram.com/harmoniadoaltar?utm_source=qr&igsh=cXF5dGJ6cTFobmVr" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="text-gray-400 hover:text-white transition-colors duration-300">
                    <i class="fab fa-instagram text-2xl"></i>
                </a>
                <a href="https://www.facebook.com/share/1CBb9XQqiD/" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="text-gray-400 hover:text-white transition-colors duration-300">
                    <i class="fab fa-facebook text-2xl"></i>
                </a>
            </div>
        </div>
    </footer>

    <!-- Main Contract Modal (Unified with Tabs) -->
    <div id="main-contract-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="modal-content w-full max-w-2xl">
            <span class="close-button" id="close-main-modal-button">&times;</span>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Contratação do Plano</h3>

            <div class="tab-header" role="tablist">
                <button class="tab-button active" data-tab="deslocamento-tab" role="tab">Deslocamento</button>
                <button class="tab-button" data-tab="payment-method-tab" role="tab">Forma de Pagamento</button>
                <button class="tab-button" data-tab="summary-tab" role="tab">Resumo e Contratar</button>
            </div>

            <div id="deslocamento-tab" class="tab-content active">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Cálculo de Deslocamento</h4>
                <p class="text-gray-600 mb-4">Informe o endereço do local da cerimônia para calcular o custo do deslocamento. <strong>Condições especiais se aplicam para Angélica, MS e Ivinhema, MS.</strong></p>
                <label for="modal-destination-address" class="block text-gray-700 text-sm font-bold mb-2">Endereço:</label>
                <input type="text" id="modal-destination-address" placeholder="Rua, Número, Cidade, Estado" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold mb-4">
                <p id="modal-deslocamento-error" class="text-red-500 mt-2 hidden text-sm">Por favor, digite um endereço válido.</p>
                <div id="modal-deslocamento-results" class="mt-6 p-4 bg-gray-100 rounded-lg">
                    <p class="text-gray-700">Distância: <span id="modal-distance-display" class="font-bold"></span></p>
                    <p class="text-gray-700">Valor do Deslocamento: <span id="modal-calculated-deslocamento-display" class="font-bold text-gold"></span></p>
                </div>
                <div class="flex justify-end mt-6">
                    <button id="next-to-payment-method-btn" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300">Próximo</button>
                </div>
            </div>

            <div id="payment-method-tab" class="tab-content">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Forma de Pagamento</h4>
                <!-- Display elements for prices in the payment method tab -->
                <div class="mb-4 text-gray-700">
                    <p>Valor do Plano: <span id="modal-plan-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p>Valor do Deslocamento: <span id="modal-freight-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p>Valor Total (Plano + Deslocamento): <span id="modal-total-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="mt-2 text-lg font-bold">Valor Total a Pagar<span id="fees-suffix" class="text-sm font-normal text-gray-600"> (com taxas)</span>: <span id="modal-total-price-with-fees" class="font-bold text-gold">R$ 0,00</span></p>
                </div>
                <div class="mb-6">
                    <div class="space-y-2">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="payment-method" value="pix" class="form-radio h-4 w-4 text-gold" checked>
                            <span>Pix</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="payment-method" value="dinheiro" class="form-radio h-4 w-4 text-gold">
                            <span>Dinheiro (a verificar com o contratado)</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="payment-method" value="boleto" class="form-radio h-4 w-4 text-gold">
                            <span>Boleto (parcelamento em até 5x)</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="payment-method" value="cartao" class="form-radio h-4 w-4 text-gold">
                            <span>Cartão de Crédito (parcelamento em até 12x)</span>
                        </label>
                    </div>
                </div>

                <div id="installment-options" class="mb-6 hidden">
                    <label for="installments" class="block text-gray-700 text-sm font-bold mb-2">Número de Parcelas:</label>
                    <select id="installments" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                        <!-- Options will be dynamically populated by JavaScript -->
                    </select>
                    <p class="mt-2 text-gray-700">Valor por parcela: <span id="installment-value" class="font-bold text-gold">R$ 0,00</span></p>
                </div>
                <div class="flex justify-between mt-6">
                    <button class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-400 transition-colors duration-300" data-navigate-tab="deslocamento-tab">Voltar</button>
                    <button id="next-to-summary-btn" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300">Próximo</button>
                </div>
            </div>

            <div id="summary-tab" class="tab-content">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Resumo do Orçamento</h4>
                <p class="text-gray-600 mb-2">Valor do Plano: <span id="summary-plan-price" class="font-bold text-gold">R$ 0,00</span></p>
                <p class="text-gray-600 mb-4">Valor do Deslocamento: <span id="summary-deslocamento-price" class="font-bold text-gold">R$ 0,00</span></p>
                <p class="text-gray-600 mb-4">Valor Total (Plano + Deslocamento): <span id="summary-total-price" class="font-bold text-gold">R$ 0,00</span></p>
                <p class="text-gray-600 mb-4" id="summary-total-with-fees-label-container">Valor Total a Pagar<span id="summary-fees-suffix"> (com taxas)</span>: <span id="summary-total-price-with-fees" class="font-bold text-gold">R$ 0,00</span></p>
                <p class="text-gray-600 mb-4">Forma de Pagamento: <span id="summary-payment-method" class="font-bold text-gold"></span></p>
                <p class="text-gray-600 mb-4" id="summary-installment-details">Parcelamento: <span id="summary-installments" class="font-bold text-gold"></span></p>
                
                <div id="fees-explanation" class="bg-gray-100 p-4 rounded-lg text-sm text-gray-700 mt-6 hidden">
                    <p class="font-semibold mb-2">Informações sobre Taxas:</p>
                    <p>As taxas aplicadas em pagamentos via Boleto e Cartão de Crédito são referentes aos custos de processamento das operadoras financeiras e bancos. A Harmonia do Altar não retém qualquer valor sobre estas taxas, que são integralmente destinadas à viabilização do parcelamento e segurança da transação. Para pagamentos via Pix ou Dinheiro, não há incidência de taxas adicionais.</p>
                </div>

                <div class="flex justify-between mt-6">
                    <button class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-400 transition-colors duration-300" data-navigate-tab="payment-method-tab">Voltar</button>
                    <button id="confirm-contract-btn" class="bg-gold text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300 transform hover:scale-105">Confirmar Contratação</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Boleto Notification Modal -->
    <div id="boleto-notification-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="modal-content w-full max-w-md">
            <span class="close-button" id="close-boleto-modal-button">&times;</span>
            <h3 class="text-xl font-bold text-gray-800 mb-4">Atenção sobre o Pagamento via Boleto</h3>
            <p class="text-gray-700 leading-relaxed">
                Informamos que o boleto referente à sua contratação pode ser gerado e pago a qualquer momento antes da data da cerimônia. É fundamental que o pagamento seja efetuado até a data de vencimento. Boletos não pagos após o vencimento estão sujeitos a protesto em cartório, o que pode acarretar restrições de crédito. Para evitar inconvenientes, recomendamos a quitação dentro do prazo estabelecido.
            </p>
            <div class="flex justify-end mt-6">
                <button id="ok-boleto-modal-button" class="bg-gold text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-300">Entendi</button>
            </div>
        </div>
    </div>

    <script async src="//www.instagram.com/embed.js"></script>
    
    <!-- Google Maps API with Places library -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDoL-Za52C0cbwOen71nbKqDpLKgBufd0Y&libraries=geometry,places&callback=initMap"></script>

    <script>
        let mapsInitialized = false; // Flag para verificar se a API do Google Maps foi carregada
        let autocomplete; // Objeto Autocomplete do Google Places
        let currentPlanDetails = null; // Para armazenar detalhes do plano sendo contratado
        let currentFinalTotalPrice = 0; // Armazena o valor total final (plano + deslocamento, antes das taxas de pagamento)
        let currentPlanOnlyPrice = 0; // Armazena o preço do plano (sem deslocamento)
        let currentDeslocamentoCost = 0; // Armazena o custo do deslocamento

        // Variáveis globais para a forma de pagamento e parcelas
        let selectedPaymentMethod = 'pix';
        let selectedInstallments = 1;

        // Define os preços dos instrumentos globalmente para fácil acesso na mensagem do WhatsApp
        const BASE_PLAN_PRICE = 1400;
        const BOLETO_PER_INSTALLMENT_FEE = 18; // R$18 fixo POR PARCELA para boleto
        const FIXED_DESLOCAMENTO_AMOUNT = 70; // Updated: Valor fixo do deslocamento para as cidades específicas
        const PER_KM_DESLOCAMENTO_RATE = 1.80 * 2; // Updated: R$1,80 por Km para outras cidades (ida e volta)

        const INSTRUMENT_PRICES = {
            'Violão': 200,
            'Contrabaixo': 200,
            'Guitarra': 200,
            'Saxofone': 500,
            'Violino': 500,
            '3 Vozes + Teclado/Piano': BASE_PLAN_PRICE // Preço base explícito para clareza
        };

        // Taxas de juros totais para cartão de crédito, conforme a nova tabela fornecida (juros da maquininha + juros de liberação)
        const CREDIT_CARD_TOTAL_PERCENTAGES = {
            1: 0.04980, // 4.980% (maquininha)
            2: 0.04590 + 0.0531, // 4.590% (maquininha) + 5.31% (liberação)
            3: 0.05970 + 0.0531, // 5.970% (maquininha) + 5.31% (liberação)
            4: 0.07330 + 0.0531, // 7.330% (maquininha) + 5.31% (liberação)
            5: 0.08660 + 0.0531, // 8.660% (maquininha) + 5.31% (liberação)
            6: 0.09960 + 0.0531, // 9.960% (maquininha) + 5.31% (liberação)
            7: 0.11240 + 0.0531, // 11.240% (maquininha) + 5.31% (liberação)
            8: 0.12500 + 0.0531, // 12.500% (maquininha) + 5.31% (liberação)
            9: 0.13730 + 0.0531, // 13.730% (maquininha) + 5.31% (liberação)
            10: 0.14930 + 0.0531, // 14.930% (maquininha) + 5.31% (liberação)
            11: 0.16120 + 0.0531, // 16.120% (maquininha) + 5.31% (liberação)
            12: 0.17280 + 0.0531  // 17.280% (maquininha) + 5.31% (liberação)
        };


        function initMap() {
            mapsInitialized = true;
            console.log("Google Maps API carregada.");

            // Inicializa o Autocomplete para o campo de endereço do modal
            const modalDestinationAddressInput = document.getElementById('modal-destination-address');
            if (modalDestinationAddressInput) {
                new google.maps.places.Autocomplete(modalDestinationAddressInput, { types: ['address'], componentRestrictions: { country: 'br' } });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                const whatsappNumber = '5567996884226';

                // --- GARANTE QUE OS MODAIS ESTÃO OCULTOS AO CARREGAR A PÁGINA ---
                document.getElementById('main-contract-modal').style.display = 'none';
                document.getElementById('boleto-notification-modal').style.display = 'none'; // Ensure boleto modal is hidden

                // --- OBSERVER DE ANIMAÇÃO ---
                const animatedItems = document.querySelectorAll('.animated-item');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, { threshold: 0.1 });
                animatedItems.forEach(item => observer.observe(item));

                // --- BARRA DE NAVEGAÇÃO E MENU MÓVEL ---
                const navbar = document.getElementById('navbar');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');

                if (navbar && mobileMenuButton && mobileMenu) {
                    window.onscroll = () => {
                        if (window.scrollY > 50) {
                            navbar.classList.add('bg-gray-900', 'shadow-lg');
                        } else {
                            navbar.classList.remove('bg-gray-900', 'shadow-lg');
                        }
                    };
                    mobileMenuButton.addEventListener('click', () => {
                        mobileMenu.classList.toggle('hidden');
                    });
                }
                
                document.querySelectorAll('.nav-link-mobile').forEach(link => {
                    link.addEventListener('click', () => mobileMenu.classList.add('hidden'));
                });

                // --- CONSTRUTOR DE PLANO PERSONALIZADO ---
                const bandInstruments = [
                    { name: 'Violão', price: 200 },
                    { name: 'Contrabaixo', price: 200 },
                    { name: 'Guitarra', price: 200 },
                ];
                const guestInstruments = [
                    { name: 'Saxofone', price: 500 },
                    { name: 'Violino', price: 500 }
                ];

                const bandOptionsContainer = document.getElementById('band-instrument-options');
                const guestOptionsContainer = document.getElementById('guest-instrument-options');
                const contractBtnCustom = document.getElementById('contract-btn-custom');
                
                let basePlanPrice = BASE_PLAN_PRICE;
                const selectedInstruments = new Set();

                function formatCurrency(value) {
                    if (typeof value !== 'number' || isNaN(value)) {
                        return 'R$ 0,00';
                    }
                    return `R$ ${value.toFixed(2).replace('.', ',')}`;
                }

                function calculateCustomPlanPrice() {
                    let calculatedPlanPrice = BASE_PLAN_PRICE;
                    selectedInstruments.forEach(name => {
                        const instrument = [...bandInstruments, ...guestInstruments].find(i => i.name === name);
                        if (instrument) {
                            calculatedPlanPrice += instrument.price;
                        }
                    });
                    return calculatedPlanPrice;
                }

                function createCheckbox(instrument, container) {
                    const label = document.createElement('label');
                    label.className = 'flex items-center space-x-3 cursor-pointer p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition';
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.dataset.price = instrument.price;
                    checkbox.dataset.name = instrument.name;
                    checkbox.className = 'form-checkbox h-5 w-5 rounded custom-checkbox focus:ring-gold';
                    const span = document.createElement('span');
                    span.className = 'text-gray-700 transition-colors duration-200';
                    span.textContent = `${instrument.name} (+ ${formatCurrency(instrument.price)})`;
                    label.appendChild(checkbox);
                    label.appendChild(span);
                    container.appendChild(label);

                    checkbox.addEventListener('change', (e) => {
                        const name = e.target.dataset.name;
                        if (e.target.checked) {
                            selectedInstruments.add(name);
                        } else {
                            selectedInstruments.delete(name);
                        }
                    });
                }

                if(bandOptionsContainer && guestOptionsContainer){
                    bandInstruments.forEach(inst => createCheckbox(inst, bandOptionsContainer));
                    guestInstruments.forEach(inst => createCheckbox(inst, guestOptionsContainer));
                }

                // --- LÓGICA DO MODAL PRINCIPAL COM ABAS ---
                const mainContractModal = document.getElementById('main-contract-modal');
                const closeMainModalButton = document.getElementById('close-main-modal-button');
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');

                const modalDestinationAddressInput = document.getElementById('modal-destination-address');
                const modalDeslocamentoError = document.getElementById('modal-deslocamento-error');
                const modalDeslocamentoResultsDiv = document.getElementById('modal-deslocamento-results');
                const modalDistanceDisplay = document.getElementById('modal-distance-display');
                const modalCalculatedDeslocamentoDisplay = document.getElementById('modal-calculated-deslocamento-display');
                const nextToPaymentMethodBtn = document.getElementById('next-to-payment-method-btn');
                const nextToSummaryBtn = document.getElementById('next-to-summary-btn');
                const confirmContractBtn = document.getElementById('confirm-contract-btn');

                const paymentMethodRadios = document.querySelectorAll('input[name="payment-method"]');
                const installmentOptionsDiv = document.getElementById('installment-options');
                const installmentsSelect = document.getElementById('installments');
                const installmentValueEl = document.getElementById('installment-value');
                const feesSuffixSpan = document.getElementById('fees-suffix');

                const modalPlanPriceEl = document.getElementById('modal-plan-price');
                const modalFreightPriceEl = document.getElementById('modal-freight-price');
                const modalTotalPriceEl = document.getElementById('modal-total-price');
                const modalTotalPriceWithFeesEl = document.getElementById('modal-total-price-with-fees');

                const summaryPlanPriceEl = document.getElementById('summary-plan-price');
                const summaryDeslocamentoPriceEl = document.getElementById('summary-deslocamento-price');
                const summaryTotalPriceEl = document.getElementById('summary-total-price');
                const summaryTotalWithFeesLabelContainer = document.getElementById('summary-total-with-fees-label-container');
                const summaryFeesSuffixSpan = document.getElementById('summary-fees-suffix');
                const summaryTotalWithFeesEl = document.getElementById('summary-total-price-with-fees');
                const summaryPaymentMethodEl = document.getElementById('summary-payment-method');
                const summaryInstallmentDetailsDiv = document.getElementById('summary-installment-details');
                const summaryInstallmentsEl = document.getElementById('summary-installments');
                const feesExplanationDiv = document.getElementById('fees-explanation');

                let unlockedTabs = ['deslocamento-tab'];


                function showTab(tabId) {
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    tabButtons.forEach(button => {
                        button.classList.remove('active');
                    });

                    document.getElementById(tabId).classList.add('active');
                    document.getElementById(tabId).style.display = 'block';
                    document.querySelector(`.tab-button[data-tab="${tabId}"]`).classList.add('active');

                    if (tabId === 'payment-method-tab') {
                        document.querySelector('input[name="payment-method"][value="pix"]').checked = true;
                        selectedPaymentMethod = 'pix';
                        selectedInstallments = 1;
                        updateInstallmentOptions();
                        updatePaymentDetailsDisplay();
                    } else if (tabId === 'summary-tab') {
                        updateSummaryDisplay();
                    }
                }

                tabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const targetTab = e.target.dataset.tab;
                        const currentActiveTab = document.querySelector('.tab-button.active').dataset.tab;

                        if (unlockedTabs.includes(targetTab)) {
                            showTab(targetTab);
                        } else {
                            if (currentActiveTab === 'deslocamento-tab') {
                                const address = modalDestinationAddressInput.value.trim();
                                if (!address || modalDeslocamentoResultsDiv.classList.contains('hidden')) {
                                    modalDeslocamentoError.textContent = "Por favor, preencha o endereço e calcule o deslocamento para prosseguir.";
                                    modalDeslocamentoError.classList.remove('hidden');
                                    return;
                                }
                            } else if (currentActiveTab === 'payment-method-tab') {
                                // Payment method tab doesn't have a direct "invalid" state,
                                // as radio buttons are always selected.
                            }
                            if (!unlockedTabs.includes(targetTab)) {
                                unlockedTabs.push(targetTab);
                            }
                            showTab(targetTab);
                        }
                    });
                });

                if (nextToPaymentMethodBtn) {
                    nextToPaymentMethodBtn.addEventListener('click', () => {
                        const address = modalDestinationAddressInput.value.trim();
                        if (!address) {
                            modalDeslocamentoError.textContent = "Por favor, digite o endereço de destino.";
                            modalDeslocamentoError.classList.remove('hidden');
                            return;
                        }
                        calculateDeslocamentoInModal(address, () => {
                            if (!modalDeslocamentoResultsDiv.classList.contains('hidden')) {
                                if (!unlockedTabs.includes('payment-method-tab')) {
                                    unlockedTabs.push('payment-method-tab');
                                }
                                showTab('payment-method-tab');
                            } else {
                                modalDeslocamentoError.textContent = "Não foi possível calcular o deslocamento. Verifique o endereço.";
                                modalDeslocamentoError.classList.remove('hidden');
                            }
                        });
                    });
                }

                if (nextToSummaryBtn) {
                    nextToSummaryBtn.addEventListener('click', () => {
                        if (!unlockedTabs.includes('summary-tab')) {
                            unlockedTabs.push('summary-tab');
                        }
                        showTab('summary-tab');
                    });
                }

                document.querySelectorAll('[data-navigate-tab]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        showTab(e.target.dataset.navigateTab);
                    });
                });

                function showMainContractModal(planPrice, deslocamentoPrice, totalPrice, planDetails) {
                    mainContractModal.style.display = 'flex';
                    currentPlanDetails = planDetails;
                    currentPlanOnlyPrice = planPrice;
                    // Reset displacement cost to 0 initially when modal opens for a new plan
                    currentDeslocamentoCost = 0; 
                    currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost; // Initial total before user enters address

                    modalDeslocamentoError.classList.add('hidden');
                    // Ensure modalDeslocamentoResultsDiv is hidden on new modal open
                    modalDeslocamentoResultsDiv.classList.add('hidden'); 
                    modalDestinationAddressInput.value = ''; // Clear address input on new modal open

                    unlockedTabs = ['deslocamento-tab']; 

                    showTab('deslocamento-tab');
                }

                if (closeMainModalButton) {
                    closeMainModalButton.addEventListener('click', () => {
                        mainContractModal.style.display = 'none';
                    });
                }

                window.addEventListener('click', (event) => {
                    if (event.target == mainContractModal) {
                        mainContractModal.style.display = 'none';
                    }
                });

                // Boleto Notification Modal Logic
                const boletoNotificationModal = document.getElementById('boleto-notification-modal');
                const closeBoletoModalButton = document.getElementById('close-boleto-modal-button');
                const okBoletoModalButton = document.getElementById('ok-boleto-modal-button');

                if (closeBoletoModalButton) {
                    closeBoletoModalButton.addEventListener('click', () => {
                        boletoNotificationModal.style.display = 'none';
                    });
                }
                if (okBoletoModalButton) {
                    okBoletoModalButton.addEventListener('click', () => {
                        boletoNotificationModal.style.display = 'none';
                    });
                }
                window.addEventListener('click', (event) => {
                    if (event.target == boletoNotificationModal) {
                        boletoNotificationModal.style.display = 'none';
                    }
                });


                paymentMethodRadios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        selectedPaymentMethod = radio.value;
                        selectedInstallments = 1;
                        updateInstallmentOptions();
                        updatePaymentDetailsDisplay();

                        if (selectedPaymentMethod === 'boleto') {
                            boletoNotificationModal.style.display = 'flex'; // Show boleto notification
                        } else {
                            boletoNotificationModal.style.display = 'none'; // Hide if other payment method selected
                        }
                    });
                });

                if (installmentsSelect) {
                    installmentsSelect.addEventListener('change', (e) => {
                        selectedInstallments = parseInt(e.target.value);
                        updatePaymentDetailsDisplay();
                    });
                }

                function updateInstallmentOptions() {
                    installmentsSelect.innerHTML = '';
                    let maxInstallments = 1;

                    if (selectedPaymentMethod === 'boleto') {
                        maxInstallments = 5;
                    } else if (selectedPaymentMethod === 'cartao') {
                        maxInstallments = 12;
                    }

                    for (let i = 1; i <= maxInstallments; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = `${i}x`;
                        installmentsSelect.appendChild(option);
                    }
                    selectedInstallments = Math.min(selectedInstallments, maxInstallments);
                    installmentsSelect.value = selectedInstallments;
                    console.log('updateInstallmentOptions: selectedInstallments set to', selectedInstallments);
                }


                function updatePaymentDetailsDisplay() {
                    let calculatedTotalForPayment = currentFinalTotalPrice;
                    let finalInstallmentValue = 0;

                    console.log('updatePaymentDetailsDisplay called. selectedPaymentMethod:', selectedPaymentMethod);
                    console.log('Initial currentFinalTotalPrice (Plano + Deslocamento):', currentFinalTotalPrice);

                    if (selectedPaymentMethod === 'boleto') {
                        calculatedTotalForPayment += (BOLETO_PER_INSTALLMENT_FEE * selectedInstallments);
                        feesSuffixSpan.style.display = 'inline';
                        console.log('Setting display for feesSuffixSpan (Boleto):', feesSuffixSpan.style.display);
                    } else if (selectedPaymentMethod === 'cartao') {
                        const percentageFee = CREDIT_CARD_TOTAL_PERCENTAGES[selectedInstallments];
                        if (percentageFee !== undefined) {
                            // Apply the formula: total / (1 - percentage)
                            calculatedTotalForPayment = currentFinalTotalPrice / (1 - percentageFee);
                        } else {
                            console.warn("Percentage fee not found for selected installments:", selectedInstallments);
                        }
                        feesSuffixSpan.style.display = 'inline';
                        console.log('Setting display for feesSuffixSpan (Cartao):', feesSuffixSpan.style.display);
                    } else {
                        calculatedTotalForPayment = currentFinalTotalPrice;
                        feesSuffixSpan.style.display = 'none';
                        console.log('Setting display for feesSuffixSpan (Pix/Dinheiro):', feesSuffixSpan.style.display);
                    }

                    finalInstallmentValue = calculatedTotalForPayment / selectedInstallments;

                    modalPlanPriceEl.textContent = formatCurrency(currentPlanOnlyPrice);
                    modalFreightPriceEl.textContent = formatCurrency(currentDeslocamentoCost);
                    modalTotalPriceEl.textContent = formatCurrency(currentFinalTotalPrice);
                    modalTotalPriceWithFeesEl.textContent = formatCurrency(calculatedTotalForPayment);
                    console.log('Final value assigned to modalTotalPriceWithFeesEl (textContent):', formatCurrency(calculatedTotalForPayment));
                    installmentValueEl.textContent = formatCurrency(finalInstallmentValue);

                    if (selectedPaymentMethod === 'boleto' || selectedPaymentMethod === 'cartao') {
                        installmentOptionsDiv.style.display = 'block';
                    } else {
                        installmentOptionsDiv.style.display = 'none';
                    }
                }

                function updateSummaryDisplay() {
                    let calculatedTotalForSummary = currentFinalTotalPrice;
                    let finalInstallmentValueForSummary = 0;
                    let paymentMethodText = '';
                    let installmentText = '';

                    if (selectedPaymentMethod === 'boleto') {
                        calculatedTotalForSummary += (BOLETO_PER_INSTALLMENT_FEE * selectedInstallments);
                        paymentMethodText = 'Boleto';
                        feesExplanationDiv.classList.remove('hidden');
                    } else if (selectedPaymentMethod === 'cartao') {
                        const percentageFee = CREDIT_CARD_TOTAL_PERCENTAGES[selectedInstallments];
                        if (percentageFee !== undefined) {
                            calculatedTotalForSummary = currentFinalTotalPrice / (1 - percentageFee);
                        }
                        paymentMethodText = 'Cartão de Crédito';
                        feesExplanationDiv.classList.remove('hidden');
                    } else if (selectedPaymentMethod === 'pix') {
                        paymentMethodText = 'Pix';
                        feesExplanationDiv.classList.add('hidden');
                    } else if (selectedPaymentMethod === 'dinheiro') {
                        paymentMethodText = 'Dinheiro (a verificar com o contratado)';
                        feesExplanationDiv.classList.add('hidden');
                    }

                    finalInstallmentValueForSummary = calculatedTotalForSummary / selectedInstallments;

                    summaryPlanPriceEl.textContent = formatCurrency(currentPlanOnlyPrice);
                    summaryDeslocamentoPriceEl.textContent = formatCurrency(currentDeslocamentoCost);
                    summaryTotalPriceEl.textContent = formatCurrency(currentFinalTotalPrice);
                    summaryTotalWithFeesEl.textContent = formatCurrency(calculatedTotalForSummary);
                    summaryPaymentMethodEl.textContent = paymentMethodText;

                    if (selectedInstallments > 1) {
                        installmentText = `${selectedInstallments}x de ${formatCurrency(finalInstallmentValueForSummary)}`;
                        summaryInstallmentDetailsDiv.style.display = 'block';
                    } else {
                        installmentText = 'Pagamento único';
                        summaryInstallmentDetailsDiv.style.display = 'none';
                    }
                    summaryInstallmentsEl.textContent = installmentText;

                    if (selectedPaymentMethod === 'pix' || selectedPaymentMethod === 'dinheiro') {
                        summaryFeesSuffixSpan.style.display = 'none';
                    } else {
                        summaryFeesSuffixSpan.style.display = 'inline';
                    }
                }


                if (confirmContractBtn) {
                    confirmContractBtn.addEventListener('click', () => {
                        const totalAmountWithFees = parseFloat(summaryTotalWithFeesEl.textContent.replace('R$', '').replace(',', '.'));
                        const installmentValuePerInstallment = parseFloat(summaryInstallmentsEl.textContent.split('de ')[1]?.replace('R$', '').replace(',', '.') || totalAmountWithFees);
                        sendWhatsAppMessage(currentPlanDetails, selectedPaymentMethod, selectedInstallments, totalAmountWithFees, installmentValuePerInstallment);
                        mainContractModal.style.display = 'none';
                    });
                }

                function sendWhatsAppMessage(plan, paymentMethod, installments, totalAmountWithFees, installmentValuePerInstallment) {
                    const destinationAddress = modalDestinationAddressInput.value;
                    const distanceText = modalDistanceDisplay.textContent;
                    let message = `*Solicitação de Orçamento - ${plan.type}*\n\n`;
                    message += `Olá! Tenho interesse no plano *${plan.name}*.\n\n`;
                    
                    message += '*Detalhes do Plano:*\n';
                    message += `• Formação Padrão (3 Vozes + Teclado/Piano): ${formatCurrency(INSTRUMENT_PRICES['3 Vozes + Teclado/Piano'])}\n`;

                    const instrumentsForMessage = plan.instruments.filter(
                        inst => inst !== '3 Vozes + Teclado/Piano' && INSTRUMENT_PRICES[inst] !== undefined
                    );

                    instrumentsForMessage.forEach(instName => {
                        const price = INSTRUMENT_PRICES[instName];
                        message += `• ${instName}: ${formatCurrency(price)}\n`;
                    });

                    message += `\n*Resumo do Orçamento:*\n`;
                    message += `*Valor do Contrato (Plano):* ${formatCurrency(plan.price)}\n`;

                    if (currentDeslocamentoCost > 0) {
                        message += `*Valor do Deslocamento:* ${formatCurrency(currentDeslocamentoCost)} para ${destinationAddress} (Distância: ${distanceText})\n`;
                    }
                    
                    if (paymentMethod === 'pix' || paymentMethod === 'dinheiro') {
                        message += `*Valor Total a Pagar:* ${formatCurrency(totalAmountWithFees)}\n`;
                    } else {
                        message += `*Valor Total a Pagar (com taxas):* ${formatCurrency(totalAmountWithFees)}\n`;
                    }
                    
                    message += `*Forma de Pagamento Selecionada:* ${paymentMethod.toUpperCase()}\n`;
                    if (installments > 1) {
                        message += `*Parcelamento:* ${installments}x de ${formatCurrency(installmentValuePerInstallment)}\n`;
                    } else if (paymentMethod === 'dinheiro') {
                        message += `*(Pagamento em dinheiro a ser verificado com o contratado)*\n`;
                    }

                    message += '\nGostaria de verificar a disponibilidade e mais detalhes. Obrigado!';

                    const encodedMessage = encodeURIComponent(message);
                    window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, '_blank');
                }

                window.handleContratar = function(planName, instruments, price) {
                    currentPlanDetails = {
                        type: 'Plano Pronto',
                        name: planName,
                        instruments: instruments,
                        price: price
                    };

                    showMainContractModal(currentPlanDetails.price, 0, currentPlanDetails.price, currentPlanDetails);
                };

                if(contractBtnCustom){
                    contractBtnCustom.addEventListener('click', () => {
                        currentPlanDetails = {
                            type: 'Plano Personalizado',
                            name: 'Plano Personalizado',
                            instruments: ['3 Vozes + Teclado/Piano', ...Array.from(selectedInstruments)],
                            price: calculateCustomPlanPrice()
                        };

                        showMainContractModal(currentPlanDetails.price, 0, currentPlanDetails.price, currentPlanDetails);
                    });
                }

                const originAddress = "Angélica, MS, Brazil";

                function calculateDeslocamentoInModal(destination, callback = () => {}) {
                    if (!mapsInitialized) {
                        console.error("Google Maps API ainda não carregada.");
                        modalDeslocamentoError.textContent = "Erro ao carregar o serviço de mapas. Por favor, tente novamente em alguns segundos.";
                        modalDeslocamentoError.classList.remove('hidden');
                        modalDeslocamentoResultsDiv.classList.add('hidden');
                        currentDeslocamentoCost = 0;
                        currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost; // Ensure total is updated even on error
                        callback();
                        return;
                    }

                    if (!destination) {
                        modalDeslocamentoError.textContent = "Por favor, digite o endereço de destino.";
                        modalDeslocamentoError.classList.remove('hidden');
                        modalDeslocamentoResultsDiv.classList.add('hidden');
                        currentDeslocamentoCost = 0;
                        currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost; // Ensure total is updated
                        callback();
                        return;
                    }

                    const service = new google.maps.DistanceMatrixService();
                    service.getDistanceMatrix(
                        {
                            origins: [originAddress],
                            destinations: [destination],
                            travelMode: google.maps.TravelMode.DRIVING,
                            unitSystem: google.maps.UnitSystem.METRIC,
                        },
                        (response, status) => {
                            if (status === 'OK') {
                                const element = response.rows[0].elements[0];
                                if (element.status === 'OK') {
                                    const distanceInMeters = element.distance.value;
                                    const destinationFormattedAddress = response.destinationAddresses[0];
                                    const lowerCaseDestination = destinationFormattedAddress.toLowerCase();

                                    let isFixedCity = false;
                                    // Normalize destination to remove accents for robust comparison
                                    const normalizedDestination = lowerCaseDestination.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                                    
                                    // Check for "angelica" AND "ms" or "ivinhema" AND "ms" (case and accent insensitive)
                                    if ((normalizedDestination.includes('angelica') && normalizedDestination.includes('ms')) ||
                                        (normalizedDestination.includes('ivinhema') && normalizedDestination.includes('ms'))) {
                                        isFixedCity = true;
                                    }

                                    if (isFixedCity) {
                                        currentDeslocamentoCost = FIXED_DESLOCAMENTO_AMOUNT; // Fixed R$ 70 for Angélica and Ivinhema
                                        modalDistanceDisplay.textContent = `Deslocamento Fixo: ${formatCurrency(currentDeslocamentoCost)}`;
                                    } else {
                                        const distanceInKm = distanceInMeters / 1000;
                                        // For other localities, it's R$ 70 fixed + R$ 1.80 * 2 per km
                                        currentDeslocamentoCost = FIXED_DESLOCAMENTO_AMOUNT + (distanceInKm * PER_KM_DESLOCAMENTO_RATE); 
                                        modalDistanceDisplay.textContent = `${distanceInKm.toFixed(2)} km`;
                                    }

                                    // Update the currentFinalTotalPrice after calculating displacement
                                    currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost;

                                    modalCalculatedDeslocamentoDisplay.textContent = formatCurrency(currentDeslocamentoCost);
                                    
                                    // Ensure modalDeslocamentoResultsDiv is shown after successful calculation
                                    modalDeslocamentoResultsDiv.classList.remove('hidden');
                                    modalDeslocamentoError.classList.add('hidden');
                                } else {
                                    modalDeslocamentoError.textContent = "Não foi possível calcular o deslocamento para o endereço fornecido. Por favor, tente novamente.";
                                    modalDeslocamentoError.classList.remove('hidden');
                                    modalDeslocamentoResultsDiv.classList.add('hidden');
                                    currentDeslocamentoCost = 0;
                                    currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost; // Ensure total is updated
                                }
                            } else {
                                modalDeslocamentoError.textContent = "Erro ao calcular o deslocamento. Verifique o endereço e sua conexão com a internet.";
                                modalDeslocamentoError.classList.remove('hidden');
                                modalDeslocamentoResultsDiv.classList.add('hidden');
                                currentDeslocamentoCost = 0;
                                currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost; // Ensure total is updated
                            }
                            callback();
                        }
                    );
                }

                document.addEventListener('keydown', function(event) {
                    if (event.key === 'F12') {
                        event.preventDefault();
                        console.log('F12 bloqueado.');
                    }
                });

                document.addEventListener('contextmenu', function(event) {
                    event.preventDefault();
                    console.log('Botão direito do mouse bloqueado.');
                });

                let devtoolsOpen = false;
                const threshold = 160;

                const checkDevTools = () => {
                    if (window.outerWidth - window.innerWidth > threshold || window.outerHeight - window.innerHeight > threshold) {
                        if (!devtoolsOpen) {
                            console.log('DevTools abertas! Tentando fechar ou redirecionar...');
                            devtoolsOpen = true;
                        }
                    } else {
                        devtoolsOpen = false;
                    }
                };

                setInterval(checkDevTools, 1000);
                checkDevTools();

                // Call calculateDeslocamentoInModal on input change to update values dynamically
                modalDestinationAddressInput.addEventListener('input', () => {
                    const address = modalDestinationAddressInput.value.trim();
                    if (address) {
                        calculateDeslocamentoInModal(address);
                    } else {
                        // If address is empty, reset displacement display
                        modalDeslocamentoResultsDiv.classList.add('hidden');
                        modalDeslocamentoError.classList.add('hidden');
                        currentDeslocamentoCost = 0;
                        currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost;
                        updatePaymentDetailsDisplay(); // Update payment tab prices
                    }
                });

            } catch (error) {
                console.error("Erro durante o carregamento do script:", error);
            }
        });
    </script>
</body>
</html>
