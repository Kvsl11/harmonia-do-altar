<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmonia do Altar</title>
    <!-- Favicon with fallback -->
    <link rel="icon" href="H.png" type="image/png">
    <!-- Tailwind CSS CDN for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for custom typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Smooth scrolling for anchor links */
        html {
            scroll-behavior: smooth;
        }
        /* Base font for the body */
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #FDFBF8; /* Softer background color */
        }
        /* Heading font for a more elegant look */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        /* Custom gold color for branding consistency */
        .text-gold {
            color: #b69260;
        }
        .bg-gold {
            background-color: #b69260;
        }
        .border-gold {
            border-color: #b69260;
        }
        /* Hero section background with gradient overlay */
        .hero-bg {
            background-image: linear-gradient(rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.55)), url('https://images.pexels.com/photos/169198/pexels-photo-169198.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }
        
        /* Media Cropper for Instagram videos to ensure square aspect ratio */
        .media-cropper {
            position: relative;
            overflow: hidden;
            padding-top: 100%; /* Creates a square container */
            border-radius: 12px;
            background-color: #e0e0e0;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .media-cropper .instagram-media {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            /* Adjust transform values if content is cut off or not centered */
            transform: scale(1.25) translateY(-4.5%); /* Scales and slightly adjusts position to crop */
            border: none !important;
            box-shadow: none !important;
            margin: 0 !important;
        }
        
        /* Animations for elements entering the viewport */
        .animated-item {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .animated-item.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .animated-item.delay-1 { transition-delay: 0.1s; }
        .animated-item.delay-2 { transition-delay: 0.2s; }
        .animated-item.delay-3 { transition-delay: 0.3s; }

        /* Custom checkbox styling for better aesthetics */
        .custom-checkbox:checked {
            background-color: #b69260;
            border-color: #b69260;
        }
        .custom-checkbox:checked + span {
            color: #b69260;
        }
        
        /* Navigation link hover effect */
        .nav-link {
            position: relative;
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #b69260;
            transition: width 0.3s;
        }
        .nav-link:hover {
            color: #b69260;
        }
        .nav-link:hover::after {
            width: 100%;
        }

        /* Adjust scroll margin for sections to account for fixed navbar */
        section[id] {
            scroll-margin-top: 80px;
        }

        /* Modal styles - Ensure display: none by default to prevent FOUC */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 90%;
            max-width: 550px; /* Increased width for new fields */
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        /* Fade-in animation for modals */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar for Webkit browsers (Chrome, Safari) */
        ::-webkit-scrollbar {
            width: 8px; /* Make it slightly thinner */
        }

        ::-webkit-scrollbar-track {
            background: transparent; /* Changed to transparent to remove the visible track */
        }

        ::-webkit-scrollbar-thumb {
            background: #b69260; /* Updated gold color for the scrollbar thumb */
            border-radius: 10px; /* Keep rounded corners for the thumb */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a08154; /* Darker gold on hover */
        }

        /* Tab styles for modal navigation */
        .tab-header {
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif; /* Ensure consistent font for tabs */
        }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-weight: 600;
            color: #888;
            transition: color 0.3s, border-bottom 0.3s;
            font-size: 0.875rem; /* Smaller font for more tabs */
        }
        .tab-button.active {
            color: #b69260;
            border-bottom: 2px solid #b69260;
        }
        .tab-content {
            display: none; /* Hidden by default, shown by JS */
        }
        .tab-content.active {
            display: block;
        }

        /* Custom styles for enhanced design */
        .navbar-scrolled {
            background-color: rgba(26, 32, 44, 0.9); /* Darker, slightly transparent background */
            backdrop-filter: blur(8px); /* Frosted glass effect */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .plan-card {
            border: 1px solid #e0e0e0; /* Subtle border for all cards */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Softer initial shadow */
        }

        .plan-card:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); /* More pronounced shadow on hover */
            transform: translateY(-5px) scale(1.01); /* Slightly more lift and scale */
            border-color: #b69260; /* Gold border on hover */
        }

        .plan-card.popular {
            border: 2px solid #b69260; /* Gold border for popular card */
            box-shadow: 0 10px 20px rgba(182, 146, 96, 0.25); /* Gold-tinted shadow for popular */
        }

        .plan-card.popular:hover {
            box-shadow: 0 15px 30px rgba(182, 146, 96, 0.4); /* Stronger gold shadow on hover */
        }

        .btn-primary {
            background-image: linear-gradient(to right, #b69260 0%, #a08154 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(182, 146, 96, 0.3);
        }

        .btn-primary:hover {
            background-position: right center; /* Change gradient direction on hover */
            box-shadow: 0 6px 15px rgba(182, 146, 96, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #4a5568; /* Gray-800 */
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background-color: #2d3748; /* Gray-900 */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .btn-whatsapp {
            background-image: linear-gradient(to right, #25D366 0%, #1DA851 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
        }

        .btn-whatsapp:hover {
            background-position: right center;
            box-shadow: 0 6px 15px rgba(37, 211, 102, 0.5);
            transform: translateY(-2px);
        }

        /* Modal specific styles */
        .modal-content {
            background-color: #ffffff; /* White background for modal */
            border-radius: 16px; /* More rounded corners */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25); /* Stronger, more modern shadow */
            padding: 30px; /* More padding */
        }

        .modal-header {
            border-bottom: 2px solid #f0f0f0; /* Subtle separator */
            padding-bottom: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            color: #1a202c; /* gray-900 */
        }

        .modal-close-button {
            color: #718096; /* gray-500 */
            font-size: 2.25rem; /* text-4xl */
            line-height: 1;
            transition: color 0.2s ease-in-out;
        }

        .modal-close-button:hover {
            color: #4a5568; /* gray-700 */
        }

        .modal-tab-header {
            border-bottom: none; /* Remove default border */
            margin-bottom: 25px;
            background-color: #f7fafc; /* Light background for tabs */
            border-radius: 10px;
            padding: 5px;
        }

        .modal-tab-button {
            flex: 1;
            padding: 12px 15px;
            border-radius: 8px; /* Rounded tab buttons */
            font-size: 1rem; /* Base font size */
            font-weight: 600;
            color: #718096; /* gray-500 */
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .modal-tab-button.active {
            color: #ffffff; /* White text for active tab */
            background-color: #b69260; /* Gold background for active tab */
            box-shadow: 0 4px 10px rgba(182, 146, 96, 0.2);
            transform: translateY(-2px);
        }

        .modal-input-group label {
            font-size: 0.95rem;
            color: #2d3748; /* gray-800 */
            margin-bottom: 8px;
        }

        .modal-input-group input[type="text"],
        .modal-input-group input[type="date"],
        .modal-input-group input[type="time"],
        .modal-input-group select {
            border: 1px solid #cbd5e0; /* light gray border */
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 1rem;
            color: #4a5568; /* gray-700 */
            transition: all 0.2s ease-in-out;
        }

        .modal-input-group input:focus,
        .modal-input-group select:focus {
            border-color: #b69260;
            box-shadow: 0 0 0 3px rgba(182, 146, 96, 0.2);
            outline: none;
        }

        .modal-radio-label {
            padding: 12px 15px;
            border: 1px solid #e2e8f0; /* light border */
            border-radius: 8px;
            background-color: #f7fafc; /* very light gray */
            transition: all 0.2s ease-in-out;
        }

        .modal-radio-label:hover {
            background-color: #edf2f7; /* slightly darker on hover */
            border-color: #b69260;
        }

        .modal-radio-label input[type="radio"]:checked + span {
            color: #b69260;
            font-weight: 600;
        }

        .modal-summary-box {
            background-color: #f0f4f8; /* Light blue-gray for summary */
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #e2e8f0;
        }

        .modal-summary-item {
            color: #4a5568; /* Darker gray for text */
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .modal-summary-item strong {
            color: #2d3748; /* Even darker for strong text */
        }

        .modal-footer-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .modal-footer-buttons .btn-primary,
        .modal-footer-buttons .btn-secondary {
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 10px;
        }

        /* Notification Modals */
        .notification-modal-content {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
            padding: 30px;
            max-width: 450px; /* Slightly smaller for notifications */
            text-align: center;
        }

        .notification-modal-title {
            font-size: 1.75rem; /* text-2xl */
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 15px;
            display: flex; /* Make it a flex container to align icon and text */
            align-items: center; /* Vertically center items */
            justify-content: center; /* Horizontally center items */
            gap: 10px; /* Space between icon and text */
        }

        .notification-modal-title .icon {
            font-size: 2rem; /* Adjust icon size */
        }

        .notification-modal-title.info .icon {
            color: #b69260; /* Gold color for info icon */
        }

        .notification-modal-title.warning .icon {
            color: #dc2626; /* Red color for warning icon */
        }

        .notification-modal-text {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .notification-modal-button {
            padding: 12px 30px;
            font-size: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(182, 146, 96, 0.3);
            transition: all 0.3s ease;
        }
        .notification-modal-button.red {
            background-image: linear-gradient(to right, #ef4444 0%, #dc2626 100%); /* Red gradient */
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }
        .notification-modal-button.red:hover {
            background-position: right center;
            box-shadow: 0 6px 15px rgba(239, 68, 68, 0.5);
            transform: translateY(-2px);
        }

        /* Custom Plan Builder Checkbox Styling */
        .custom-plan-checkbox-label {
            display: flex;
            align-items: center;
            gap: 16px; /* Increased gap for better spacing */
            cursor: pointer;
            padding: 16px; /* Increased padding */
            background-color: #ffffff; /* White background */
            border: 1px solid #e2e8f0; /* Light border */
            border-radius: 12px; /* More rounded */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* Subtle shadow */
            transition: all 0.2s ease-in-out;
        }

        .custom-plan-checkbox-label:hover {
            background-color: #f7fafc; /* Very light gray on hover */
            border-color: #b69260; /* Gold border on hover */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Slightly more pronounced shadow */
            transform: translateY(-2px); /* Slight lift */
        }

        .custom-plan-checkbox-label input[type="checkbox"] {
            -webkit-appearance: none; /* Hide default checkbox */
            -moz-appearance: none;
            appearance: none;
            width: 24px; /* Larger checkbox */
            height: 24px;
            border: 2px solid #cbd5e0; /* Light gray border */
            border-radius: 6px; /* Rounded corners for checkbox */
            background-color: #ffffff;
            transition: all 0.2s ease-in-out;
            position: relative;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .custom-plan-checkbox-label input[type="checkbox"]:checked {
            background-color: #b69260; /* Gold background when checked */
            border-color: #b69260;
        }

        .custom-plan-checkbox-label input[type="checkbox"]:checked::after {
            content: '\2713'; /* Checkmark character */
            color: white;
            font-size: 16px; /* Size of checkmark */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
        }

        .custom-plan-checkbox-label span {
            font-size: 1.05rem; /* Slightly larger text */
            color: #2d3748; /* Darker text */
            transition: color 0.2s ease-in-out;
        }

        .custom-plan-checkbox-label input[type="checkbox"]:checked + span {
            color: #b69260; /* Gold text when checked */
            font-weight: 700; /* Bolder text when checked */
        }

        /* Plan Card Instrument List Styling */
        .plan-instrument-item {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between icon and text */
            color: #4a5568; /* Darker text for readability */
            font-size: 1rem; /* Base font size */
        }
        .plan-instrument-item i {
            color: #b69260; /* Gold color for icons */
            font-size: 1.1rem; /* Slightly larger icon */
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- Script to hide modals immediately on page load to prevent FOUC -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Select all elements with the class 'modal'
            const modals = document.querySelectorAll('.modal');
            // Iterate over each modal and define its display style as 'none'
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        });
    </script>

    <!-- Navigation Bar -->
    <nav id="navbar" class="fixed top-0 left-0 w-full z-50 transition-all duration-300 py-4">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <!-- Logo and Site Title -->
            <a href="#" class="text-white text-2xl md:text-3xl font-bold font-playfair flex items-center">
                <img src="H.png" alt="Logo Harmonia do Altar" class="h-10 md:h-12 mr-3 inline-block" onerror="this.onerror=null; this.src='https://placehold.co/48x48/ffffff/b69260?text=H'">armonia do Altar
            </a>
            
            <!-- Desktop Navigation Links -->
            <div class="hidden md:flex space-x-10">
                <a href="#sobre" class="nav-link text-lg">Sobre</a>
                <a href="#galeria" class="nav-link text-lg">Galeria</a>
                <a href="#planos" class="nav-link text-lg">Planos</a>
                <a href="#contato" class="nav-link text-lg">Contato</a>
            </div>

            <!-- Mobile Menu Button -->
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-white focus:outline-none" aria-label="Toggle mobile menu">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <!-- Mobile Navigation Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800 bg-opacity-95">
            <a href="#sobre" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Sobre</a>
            <a href="#galeria" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Galeria</a>
            <a href="#planos" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Planos</a>
            <a href="#contato" class="nav-link-mobile block py-3 px-6 text-base text-white hover:bg-gold transition-colors">Contato</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-bg text-white shadow-lg h-screen flex items-center justify-center">
        <div class="text-center px-4">
            <h1 class="text-5xl md:text-7xl font-bold mb-4 animated-item">
                <img src="H.png" alt="Logo Harmonia do Altar" class="h-24 md:h-36 inline-block align-middle mr-4" onerror="this.onerror=null; this.src='https://placehold.co/144x144/ffffff/b69260?text=H'">armonia do Altar
            </h1>
            <p class="text-xl md:text-3xl font-light animated-item delay-1 leading-snug">A Trilha Sonora Perfeita para o Seu Grande Dia</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-16 md:py-24">
        
        <!-- About Section -->
        <section id="sobre" class="text-center max-w-4xl mx-auto mb-20 md:mb-32 animated-item">
            <h2 class="text-4xl md:text-5xl font-bold mb-4">Música que Conta a Sua História</h2>
            <div class="w-24 h-1.5 bg-gold mx-auto mb-8 rounded-full"></div>
            <p class="text-gray-600 leading-relaxed text-lg md:text-xl">
                Para nós, cada casamento é a celebração de uma história de amor única. E toda grande história merece uma trilha sonora inesquecível. Somos o Harmonia do Altar, um grupo de músicos apaixonados por transformar cerimônias em eventos memoráveis. Nosso propósito é ir além da música: queremos tocar o coração de cada convidado e, principalmente, o de vocês, com arranjos que capturam a essência do seu amor e a solenidade do seu grande dia.
            </p>
        </section>
        
        <!-- Gallery Section -->
        <section id="galeria" class="mb-20 md:mb-32">
            <div class="animated-item">
                <h2 class="text-4xl md:text-5xl font-bold text-center mb-4">Sinta a Nossa Harmonia</h2>
                <div class="w-24 h-1.5 bg-gold mx-auto mb-16 rounded-full"></div>
            </div>
            
            <div class="text-center max-w-3xl mx-auto animated-item">
                <h3 class="text-3xl font-bold text-gold mb-4">A Emoção em Cada Nota</h3>
                <p class="text-gray-600 mb-10 text-lg">A música tem o poder de evocar sentimentos profundos. Imagine a entrada da noiva ao som de um violino emocionante, ou a troca de alianças embalada por um piano suave e vozes que se entrelaçam. É essa atmosfera que criamos.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-16">
                <!-- Instagram Embed 1 -->
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8YQSOEsv0-/" data-instgrm-version="14"></blockquote>
                </div>
                <!-- Instagram Embed 2 -->
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8V3pPAsYSj/" data-instgrm-version="14"></blockquote>
                </div>
            </div>

            <div class="text-center max-w-3xl mx-auto mt-24 animated-item">
                <h3 class="text-3xl font-bold text-gold mb-4">Elegância e Profissionalismo</h3>
                <p class="text-gray-600 mb-10 text-lg">Acreditamos que a beleza está na harmonia, não só musical, mas também visual. Nossos músicos se apresentam com a sofisticação que a sua cerimônia merece, e nossas performances são um reflexo do nosso compromisso com a excelência.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-16">
                <!-- Instagram Embed 3 -->
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/C8VlkbksuVZ/" data-instgrm-version="14"></blockquote>
                </div>
                <!-- Instagram Embed 4 -->
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/CpBIkGaOdrZ/" data-instgrm-version="14"></blockquote>
                </div>
            </div>

            <div class="text-center max-w-3xl mx-auto mt-24 animated-item">
                <h3 class="text-3xl font-bold text-gold mb-4">Alegria e Versatilidade</h3>
                <p class="text-gray-600 mb-10 text-lg">Seu casamento deve refletir sua personalidade. Do clássico ao popular, do sacro ao contemporâneo, nosso repertório é vasto e adaptável. Celebramos o amor em todos os ritmos, garantindo momentos de pura alegria e emoção.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <!-- Instagram Embed 5 -->
                <div class="media-cropper animated-item delay-1">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8VkPNDsAit/" data-instgrm-version="14"></blockquote>
                </div>
                <!-- Instagram Embed 6 -->
                <div class="media-cropper animated-item delay-2">
                    <blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/reel/C8YEx9mse1O/" data-instgrm-version="14"></blockquote>
                </div>
            </div>
        </section>

        <!-- Plans Section -->
        <section id="planos" class="py-20 md:py-32 bg-white rounded-3xl shadow-xl">
            <div class="text-center max-w-4xl mx-auto mb-16 md:mb-20 animated-item">
                <h2 class="text-4xl md:text-5xl font-bold mb-4">Nossas Configurações Sugeridas</h2>
                <div class="w-24 h-1.5 bg-gold mx-auto mb-8 rounded-full"></div>
                <p class="text-gray-600 leading-relaxed text-lg md:text-xl mb-8">
                    Nossa formação padrão inclui <strong>3 vozes e teclado</strong>, com a flexibilidade de adicionar outros instrumentos para personalizar sua sonoridade. O deslocamento tem tarifa fixa para <strong>Angélica/Ivinhema (MS) e valor por km para outras localidades (com um valor base).</strong> Taxas de processamento bancário aplicam-se a pagamentos via boleto e cartão (incluindo deslocamentos especiais), não sendo retidas pela Harmonia do Altar. <strong>Pix e dinheiro são isentos de taxas bancárias.</strong>
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 justify-center px-4">
                
                <!-- Plan Card 1: Essência Clássica e Sublime -->
                <div class="bg-gray-50 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-music text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Essência Clássica e Sublime</h3>
                        <p class="text-gray-600 mb-8 text-base">A nossa formação padrão, com as <strong>3 vozes e o teclado</strong>. Perfeita para quem busca a elegância atemporal e a emoção pura.</p>
                        <h4 class="font-bold mb-3 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Changed icon -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-white flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.400</div>
                        <button onclick="handleSimular('Essência Clássica e Sublime', ['3 Vozes + Teclado/Piano'], 1400)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>

                <!-- Plan Card 2: Harmonia Delicada e Acústica (Most Popular) -->
                <div class="bg-gray-50 rounded-2xl plan-card popular overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item delay-1 relative">
                    <div class="absolute top-0 right-0 bg-gold text-white text-sm font-bold px-4 py-1.5 rounded-bl-xl">MAIS POPULAR</div>
                    <div class="p-8 flex-grow">
                        <i class="fas fa-guitar text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Harmonia Delicada e Acústica</h3>
                        <p class="text-gray-600 mb-8 text-base">A formação padrão com o acréscimo do <strong>violão</strong>. O som quente e dedilhado cria uma atmosfera romântica e acolhedora.</p>
                        <h4 class="font-bold mb-3 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Changed icon -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-guitar"></i> <!-- Changed icon -->
                                <span>Violão</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-white flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.600</div>
                        <button onclick="handleSimular('Harmonia Delicada e Acústica', ['3 Vozes + Teclado/Piano', 'Violão'], 1600)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>
                
                <!-- Plan Card 3: Sofisticação e Envolvimento -->
                <div class="bg-gray-50 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item delay-2">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-layer-group text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Sofisticação e Envolvimento</h3>
                        <p class="text-gray-600 mb-8 text-base">Além da base, o <strong>contrabaixo</strong> adiciona uma sonoridade mais encorpada e um groove sutil, trazendo profundidade e elegância.</p>
                        <h4 class="font-bold mb-3 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Changed icon -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-volume-down"></i> <!-- Changed icon -->
                                <span>Contrabaixo</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-white flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.600</div>
                        <button onclick="handleSimular('Sofisticação e Envolvimento', ['3 Vozes + Teclado/Piano', 'Contrabaixo'], 1600)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>

                <!-- Plan Card 4: Sonoridade Completa e Marcante -->
                <div class="bg-gray-50 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-sliders-h text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Sonoridade Completa e Marcante</h3>
                        <p class="text-gray-600 mb-8 text-base">Com <strong>contrabaixo e violão</strong> somados à base, esta opção traz uma sonoridade grandiosa, preenchida e com uma textura rica.</p>
                        <h4 class="font-bold mb-3 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Changed icon -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-volume-down"></i> <!-- Changed icon -->
                                <span>Contrabaixo</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-guitar"></i> <!-- Changed icon -->
                                <span>Violão</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-white flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 1.800</div>
                        <button onclick="handleSimular('Sonoridade Completa e Marcante', ['3 Vozes + Teclado/Piano', 'Violão', 'Contrabaixo'], 1800)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>

                <!-- Plan Card 5: Versatilidade e Brilho Acústico -->
                <div class="bg-gray-50 rounded-2xl plan-card overflow-hidden transform hover:-translate-y-2 transition-all duration-300 flex flex-col animated-item delay-1">
                    <div class="p-8 flex-grow">
                        <i class="fas fa-star text-gold text-4xl mb-6"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">Versatilidade e Brilho Acústico</h3>
                        <p class="text-gray-600 mb-8 text-base">A formação mais completa, com <strong>violão, guitarra e contrabaixo</strong>. Permite explorar diferentes estilos com arranjos modernos.</p>
                        <h4 class="font-bold mb-3 text-base">Instrumentos:</h4>
                        <div class="space-y-2">
                            <div class="plan-instrument-item">
                                <i class="fas fa-microphone-alt"></i> <!-- Changed icon -->
                                <span>3 Vozes + Teclado/Piano</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-guitar"></i> <!-- Changed icon -->
                                <span>Violão</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-bolt"></i> <!-- Changed icon -->
                                <span>Guitarra</span>
                            </div>
                            <div class="plan-instrument-item">
                                <i class="fas fa-volume-down"></i> <!-- Changed icon -->
                                <span>Contrabaixo</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 bg-white flex justify-between items-center">
                        <div class="text-3xl font-bold text-gold">R$ 2.000</div>
                        <button onclick="handleSimular('Versatilidade e Brilho Acústica', ['3 Vozes + Teclado/Piano', 'Violão', 'Guitarra', 'Contrabaixo'], 2000)" class="btn-primary text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base">Simular Orçamento</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Custom Plan Builder Section -->
        <section id="custom-plan-builder" class="bg-white rounded-3xl shadow-xl p-8 md:p-12 text-center mt-20 md:mt-32 animated-item">
            <h2 class="text-4xl md:text-5xl font-bold mb-4">Crie o Seu Plano Personalizado</h2>
            <div class="w-24 h-1.5 bg-gold mx-auto mb-8 rounded-full"></div>
            <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-10">
                Adicione instrumentos à nossa formação padrão para criar a sonoridade perfeita para o seu dia.
            </p>
            <div class="max-w-2xl mx-auto text-left">
                <div class="p-5 bg-gray-100 rounded-xl mb-6 flex justify-between items-center border border-gray-200">
                    <span class="font-bold text-gray-700 text-lg">Formação Padrão (3 Vozes + Teclado)</span>
                    <span class="font-bold text-gray-700 text-lg">R$ 1.400,00</span>
                </div>
                <h4 class="text-xl font-bold text-gray-800 mt-8 mb-4">Instrumentos da Banda:</h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" id="band-instrument-options"></div>
                
                <h4 class="text-xl font-bold text-gray-800 mt-10 mb-4">Músicos Convidados: <span class="text-base font-normal text-gray-600">(Um toque de brilho)</span></h4>
                <p class="text-base text-gray-600 mb-6">Para uma sonoridade ainda mais especial, adicione o romantismo do violino ou a sofisticação do saxofone.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" id="guest-instrument-options"></div>
            </div>

            <div class="mt-10 max-w-2xl mx-auto border-t border-gray-200 pt-8">
                <button id="simulate-btn-custom" class="w-full btn-primary text-white font-bold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-lg">Simular Plano Personalizado</button>
            </div>
        </section>

    </main>

    <!-- Footer Section -->
    <footer id="contato" class="bg-gray-900 text-white mt-20 md:mt-32 py-16">
        <div class="container mx-auto px-6 py-12 text-center animated-item">
            <h2 class="text-4xl font-bold mb-6">Vamos Conversar?</h2>
            <p class="max-w-3xl mx-auto mb-8 text-gray-300 text-lg">
                Estamos aqui para tirar todas as dúvidas e garantir que cada nota no seu grande dia seja exatamente como vocês sonham.
            </p>
            <!-- WhatsApp Contact Button -->
            <a href="https://wa.me/5567996884226?text=Olá!%20Vi%20o%20site%20do%20Harmonia%20do%20Altar%20e%20gostaria%20de%20um%20orçamento." target="_blank" rel="noopener noreferrer" class="btn-whatsapp text-white font-bold py-4 px-10 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 inline-block text-lg">
                <i class="fab fa-whatsapp mr-3"></i> Chamar no WhatsApp
            </a>
            <!-- Social Media Links -->
            <div class="flex justify-center space-x-8 mt-10">
                <a href="https://www.instagram.com/harmoniadoaltar?utm_source=qr&igsh=cXF5dGJ6cTFobmVr" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="text-gray-400 hover:text-white transition-colors duration-300 transform hover:scale-110">
                    <i class="fab fa-instagram text-3xl"></i>
                </a>
                <a href="https://www.facebook.com/share/1CBb9XQqiD/" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="text-gray-400 hover:text-white transition-colors duration-300 transform hover:scale-110">
                    <i class="fab fa-facebook text-3xl"></i>
                </a>
            </div>
        </div>
    </footer>

    <!-- Main Simulation Modal (Unified with Tabs) -->
    <div id="main-simulation-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="modal-content w-full max-w-2xl">
            <div class="modal-header">
                <h3 class="modal-title">Simulação de Orçamento</h3>
                <span class="close-button modal-close-button" id="close-main-modal-button" aria-label="Close modal">&times;</span>
            </div>

            <!-- Tab Navigation for the Modal -->
            <div class="tab-header modal-tab-header" role="tablist">
                <button class="tab-button modal-tab-button active" data-tab="deslocamento-tab" role="tab" aria-controls="deslocamento-tab-content">Deslocamento</button>
                <button class="tab-button modal-tab-button" data-tab="event-details-tab" role="tab" aria-controls="event-details-tab-content">Detalhes do Evento</button>
                <button class="tab-button modal-tab-button" data-tab="payment-method-tab" role="tab" aria-controls="payment-method-tab-content">Pagamento</button>
                <button class="tab-button modal-tab-button" data-tab="summary-tab" role="tab" aria-controls="summary-tab-content">Resumo</button>
            </div>

            <!-- TAB 1: DESLOCAMENTO -->
            <div id="deslocamento-tab" class="tab-content active" role="tabpanel" aria-labelledby="deslocamento-tab">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Cálculo de Deslocamento</h4>
                <p class="text-gray-600 mb-6">Informe o endereço do local da cerimônia para calcular o custo do deslocamento. <strong>Condições especiais se aplicam para Angélica, MS e Ivinhema, MS.</strong></p>
                <div class="modal-input-group mb-4">
                    <label for="modal-destination-address" class="block text-gray-700 text-sm font-bold mb-2">Endereço Completo (Rua, Número, Cidade, Estado):</label>
                    <div class="flex space-x-2">
                        <input type="text" id="modal-destination-address" placeholder="Ex: Av. Brasil, 123, Ivinhema, MS" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                        <button type="button" id="open-map-selection-btn" class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 text-sm flex-shrink-0">
                            <i class="fas fa-map-marker-alt mr-1"></i> Abrir Mapa
                        </button>
                    </div>
                    <p id="modal-deslocamento-error" class="text-red-500 mt-2 hidden text-sm">Por favor, digite um endereço válido.</p>
                </div>
                <div id="modal-deslocamento-results" class="mt-6 p-4 bg-gray-100 rounded-lg hidden">
                    <p class="text-gray-700">Distância: <span id="modal-distance-display" class="font-bold"></span></p>
                    <p class="text-gray-700">Valor do Deslocamento: <span id="modal-calculated-deslocamento-display" class="font-bold text-gold"></span></p>
                </div>
                <div class="modal-footer-buttons">
                    <button id="next-to-event-details-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Próximo</button>
                </div>
            </div>

            <!-- TAB 2: DETALHES DO EVENTO -->
            <div id="event-details-tab" class="tab-content" role="tabpanel" aria-labelledby="event-details-tab">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Detalhes da Cerimônia</h4>
                <p class="text-gray-600 mb-6">Por favor, preencha a data e o horário da sua cerimônia.</p>
                
                <div class="modal-input-group mb-4">
                    <label for="ceremony-date" class="block text-gray-700 text-sm font-bold mb-2">Data da Cerimônia:</label>
                    <input type="date" id="ceremony-date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                </div>
                
                <div class="modal-input-group mb-4">
                    <label for="ceremony-time" class="block text-gray-700 text-sm font-bold mb-2">Horário da Cerimônia:</label>
                    <input type="time" id="ceremony-time" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                </div>

                <!-- New field for Reference Location -->
                <div class="modal-input-group mb-4">
                    <label for="reference-location" class="block text-gray-700 text-sm font-bold mb-2">Local de Referência (Opcional):</label>
                    <input type="text" id="reference-location" placeholder="Ex: Próximo à praça central" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                </div>

                <div class="mt-4 p-3 bg-gray-100 rounded-lg">
                    <p class="text-sm text-gray-700"><strong>Endereço Confirmado:</strong> <span id="confirmed-address-display"></span></p>
                </div>
                <p id="modal-event-details-error" class="text-red-500 mt-2 hidden text-sm">Por favor, preencha a data e o horário.</p>

                <div class="modal-footer-buttons">
                    <button class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300" data-navigate-tab="deslocamento-tab">Voltar</button>
                    <button id="next-to-payment-method-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Próximo</button>
                </div>
            </div>

            <!-- TAB 3: FORMA DE PAGAMENTO -->
            <div id="payment-method-tab" class="tab-content" role="tabpanel" aria-labelledby="payment-method-tab">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Forma de Pagamento</h4>
                <div class="mb-4 text-gray-700">
                    <p>Valor do Plano: <span id="modal-plan-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p>Valor do Deslocamento: <span id="modal-freight-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p>Valor Total (Plano + Deslocamento): <span id="modal-total-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="mt-2 text-lg font-bold">Valor Total a Pagar<span id="fees-suffix" class="text-sm font-normal text-gray-600"> (com taxas)</span>: <span id="modal-total-price-with-fees" class="font-bold text-gold">R$ 0,00</span></p>
                </div>
                <div class="mb-6 space-y-3">
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="pix" class="form-radio h-5 w-5 text-gold" checked>
                        <span>Pix</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="dinheiro" class="form-radio h-5 w-5 text-gold">
                        <span>Dinheiro (a verificar com o contratado)</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="boleto" class="form-radio h-5 w-5 text-gold">
                        <span>Boleto (parcelamento em até 5x)</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer modal-radio-label">
                        <input type="radio" name="payment-method" value="cartao" class="form-radio h-5 w-5 text-gold">
                        <span>Cartão de Crédito (parcelamento em até 12x)</span>
                    </label>
                </div>

                <div id="installment-options" class="mb-6 hidden modal-input-group">
                    <label for="installments" class="block text-gray-700 text-sm font-bold mb-2">Número de Parcelas:</label>
                    <select id="installments" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold"></select>
                    <p class="mt-2 text-gray-700">Valor por parcela: <span id="installment-value" class="font-bold text-gold">R$ 0,00</span></p>
                </div>

                <div id="boleto-due-date-options" class="mb-6 hidden modal-input-group">
                    <label for="boleto-due-date" class="block text-gray-700 text-sm font-bold mb-2">Melhor dia para vencimento do boleto:</label>
                    <select id="boleto-due-date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-gold">
                        <option value="5">Dia 5</option>
                        <option value="10">Dia 10</option>
                        <option value="15">Dia 15</option>
                        <option value="20">Dia 20</option>
                        <option value="25">Dia 25</option>
                    </select>
                    <!-- This inline error message will now be hidden and replaced by a modal -->
                    <p id="modal-boleto-date-error" class="text-red-500 mt-2 hidden text-sm">A data da última parcela não pode ser posterior à data da cerimônia. Por favor, ajuste as parcelas ou a data de vencimento.</p>
                </div>

                <div class="modal-footer-buttons">
                    <button class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300" data-navigate-tab="event-details-tab">Voltar</button>
                    <button id="next-to-summary-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Próximo</button>
                </div>
            </div>

            <!-- TAB 4: RESUMO E SIMULAR -->
            <div id="summary-tab" class="tab-content" role="tabpanel" aria-labelledby="summary-tab">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Resumo do Orçamento</h4>
                <div class="modal-summary-box space-y-3">
                    <p class="modal-summary-item"><strong>Plano:</strong> <span id="summary-plan-name" class="font-bold text-gray-800"></span></p>
                    <p class="modal-summary-item"><strong>Data do Evento:</strong> <span id="summary-event-date" class="font-bold text-gray-800"></span></p>
                    <p class="modal-summary-item"><strong>Endereço:</strong> <span id="summary-event-address" class="font-bold text-gray-800"></span></p>
                    <p class="modal-summary-item" id="summary-reference-location-display"><strong>Local de Referência:</strong> <span id="summary-reference-location" class="font-bold text-gray-800"></span></p>
                    <hr class="my-3 border-gray-300">
                    <p class="modal-summary-item">Valor do Plano: <span id="summary-plan-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item">Valor do Deslocamento: <span id="summary-deslocamento-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item">Valor Total (Plano + Deslocamento): <span id="summary-total-price" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item" id="summary-total-with-fees-label-container">Valor Total a Pagar<span id="summary-fees-suffix"> (com taxas)</span>: <span id="summary-total-price-with-fees" class="font-bold text-gold">R$ 0,00</span></p>
                    <p class="modal-summary-item">Forma de Pagamento: <span id="summary-payment-method" class="font-bold text-gold"></span></p>
                    <p class="modal-summary-item" id="summary-installment-details">Parcelamento: <span id="summary-installments" class="font-bold text-gold"></span></p>
                    <p class="modal-summary-item hidden" id="summary-boleto-due-date-details">Vencimento do Boleto: <span id="summary-boleto-due-date" class="font-bold text-gold"></span></p>
                </div>
                
                <div id="fees-explanation" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg text-sm mt-6 hidden">
                    <p class="font-semibold mb-2">Informações sobre Taxas:</p>
                    <p>As taxas aplicadas em pagamentos via Boleto e Cartão de Crédito são referentes aos custos de processamento das operadoras financeiras e bancos. A Harmonia do Altar não retém qualquer valor sobre estas taxas, que são integralmente destinadas à viabilização do parcelamento e segurança da transação. Para pagamentos via Pix ou Dinheiro, não há incidência de taxas adicionais.</p>
                </div>

                <div class="modal-footer-buttons">
                    <button class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300" data-navigate-tab="payment-method-tab">Voltar</button>
                    <button id="confirm-simulation-btn" class="btn-primary text-white font-bold py-3 px-8 rounded-lg shadow-md hover:shadow-xl transition-all duration-300">Confirmar Simulação</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Selection Modal -->
    <div id="map-selection-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="notification-modal-content w-full h-3/4 flex flex-col">
            <span class="close-button modal-close-button" id="close-map-modal-button" aria-label="Close map modal">&times;</span>
            <h3 class="notification-modal-title">Selecione a Localização no Mapa</h3>
            <div id="map-canvas" class="flex-grow rounded-lg mb-4" style="height: 400px; width: 100%;"></div>
            <button id="confirm-map-location-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 mt-4 notification-modal-button">Confirmar Localização</button>
        </div>
    </div>

    <!-- Boleto Notification Modal -->
    <div id="boleto-notification-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="notification-modal-content w-full">
            <span class="close-button modal-close-button" id="close-boleto-modal-button" aria-label="Close notification">&times;</span>
            <h3 class="notification-modal-title info">
                <i class="fas fa-info-circle icon"></i> Atenção Importante: Pagamento via Boleto!
            </h3>
            <p class="notification-modal-text">
                Para sua comodidade, o boleto da sua simulação pode ser gerado e quitado a qualquer momento antes da data da cerimônia. Lembre-se: o pagamento pontual é essencial! Boletos não pagos após o vencimento podem estar sujeitos a protesto em cartório, o que pode gerar restrições de crédito. Para garantir a tranquilidade do seu grande dia, recomendamos a quitação dentro do prazo estabelecido. Contamos com você para essa harmonia financeira!
            </p>
            <div class="flex justify-end mt-6">
                <button id="ok-boleto-modal-button" class="btn-primary text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 notification-modal-button">Entendi</button>
            </div>
        </div>
    </div>

    <!-- New: Boleto Date Validation Notification Modal -->
    <div id="boleto-date-warning-modal" class="modal fixed inset-0 flex items-center justify-center">
        <div class="notification-modal-content w-full">
            <span class="close-button modal-close-button" id="close-boleto-date-warning-modal-button" aria-label="Close warning">&times;</span>
            <h3 class="notification-modal-title warning">
                <i class="fas fa-exclamation-triangle icon"></i> Alerta Importante: Ajuste a Data do Boleto!
            </h3>
            <p class="notification-modal-text">
                Identificamos que a data da última parcela do boleto que você selecionou (dia <span id="warning-due-date"></span>) ultrapassa a data da sua cerimônia (<span id="warning-ceremony-date"></span>). Para que tudo corra perfeitamente e sem imprevistos, é fundamental que todas as parcelas sejam quitadas antes do seu grande dia. Por favor, ajuste o número de parcelas ou o dia de vencimento do boleto. Estamos aqui para ajudar a encontrar a melhor solução!
            </p>
            <div class="flex justify-end mt-6">
                <button id="ok-boleto-date-warning-modal-button" class="btn-primary red text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 notification-modal-button">Entendi</button>
            </div>
        </div>
    </div>

    <!-- Instagram Embed Script -->
    <script async src="//www.instagram.com/embed.js"></script>
    
    <!-- Google Maps API with Places library for autocomplete and distance matrix -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDoL-Za52C0cbwOen71nbKqDpLKgBufd0Y&libraries=geometry,places&callback=initMap"></script>

    <script>
        // --- GLOBAL VARIABLES & CONSTANTS ---
        let mapsInitialized = false; // Flag to check if Google Maps API is loaded
        let autocomplete; // Google Places Autocomplete instance
        let currentPlanDetails = null; // Stores details of the selected plan
        let currentFinalTotalPrice = 0; // Total price including plan and displacement
        let currentPlanOnlyPrice = 0; // Price of the selected plan only
        let currentDeslocamentoCost = 0; // Cost of displacement
        let selectedPaymentMethod = 'pix'; // Default payment method
        let selectedInstallments = 1; // Default number of installments
        let ceremonyDate = null; // Date of the ceremony
        let ceremonyTime = null; // Time of the ceremony
        let selectedBoletoDueDate = 5; // Default day for boleto due date
        let debounceTimer; // Timer for input debouncing
        const whatsappNumber = '5567996884226'; // WhatsApp number for contact

        // Google Maps related variables
        let selectedPlaceDetails = {
            address: '',
            lat: null,
            lng: null,
            googleMapsUrl: ''
        };
        let map = null; // Google Map instance
        let marker = null; // Google Map marker instance
        let geocoder = null; // Google Maps Geocoder instance

        // DOM Element variables declared globally (assigned in DOMContentLoaded)
        let modalDestinationAddressInput;
        let modalDeslocamentoError;
        let modalDeslocamentoResultsDiv;
        let modalDistanceDisplay;
        let modalCalculatedDeslocamentoDisplay;
        let referenceLocationInput;
        let nextToSummaryBtn;
        let boletoDateWarningModal;
        let warningDueDateSpan;
        let warningCeremonyDateSpan;

        // Element Getters for main modal
        let ceremonyDateInput;
        let ceremonyTimeInput;
        let confirmedAddressDisplay;
        let modalEventDetailsError;
        let paymentMethodRadios;
        let installmentOptionsDiv;
        let installmentsSelect;
        let installmentValueEl;
        let boletoDueDateOptionsDiv;
        let boletoDueDateSelect;
        let modalBoletoDateError;
        let feesSuffixSpan;
        let modalPlanPriceEl;
        let modalFreightPriceEl;
        let modalTotalPriceEl;
        let modalTotalPriceWithFeesEl;

        // Element Getters for summary tab
        let summaryPlanNameEl;
        let summaryEventDateEl;
        let summaryEventAddressEl;
        let summaryReferenceLocationDisplay;
        let summaryReferenceLocationEl;
        let summaryPlanPriceEl;
        let summaryDeslocamentoPriceEl;
        let summaryTotalPriceEl;
        let summaryTotalWithFeesEl;
        let summaryPaymentMethodEl;
        let summaryInstallmentDetailsDiv;
        let summaryInstallmentsEl;
        let summaryBoletoDueDateDetailsDiv;
        let summaryBoletoDueDateEl;
        let feesExplanationDiv;
        let summaryFeesSuffixSpan;

        // Pricing constants
        const BASE_PLAN_PRICE = 1400;
        const BOLETO_PER_INSTALLMENT_FEE = 18;
        const FIXED_DESLOCAMENTO_AMOUNT = 70;
        const PER_KM_DESLOCAMENTO_RATE = 1.80 * 2; // R$1.80 per km, multiplied by 2 for round trip
        const originAddress = "Angélica, MS, Brazil"; // Origin for distance calculation

        // Instrument prices for custom plan builder
        const INSTRUMENT_PRICES = {
            'Violão': 200, 'Contrabaixo': 200, 'Guitarra': 200,
            'Saxofone': 500, 'Violino': 500, '3 Vozes + Teclado/Piano': BASE_PLAN_PRICE
        };
        // Credit card fee percentages based on number of installments
        const CREDIT_CARD_TOTAL_PERCENTAGES = {
            1: 0.04980, 2: 0.04590 + 0.0531, 3: 0.05970 + 0.0531, 4: 0.07330 + 0.0531,
            5: 0.08660 + 0.0531, 6: 0.09960 + 0.0531, 7: 0.11240 + 0.0531, 8: 0.12500 + 0.0531,
            9: 0.13730 + 0.1531, 10: 0.14930 + 0.0531, 11: 0.16120 + 0.0531, 12: 0.17280 + 0.0531
        };

        // --- GLOBAL FUNCTIONS ---

        /**
         * Formats a number as Brazilian currency (R$).
         * @param {number} value - The number to format.
         * @returns {string} The formatted currency string.
         */
        function formatCurrency(value) {
            if (typeof value !== 'number' || isNaN(value)) return 'R$ 0,00';
            return `R$ ${value.toFixed(2).replace('.', ',')}`;
        }

        /**
         * Calculates the displacement cost based on destination.
         * Can accept either a formatted address string or latitude/longitude coordinates.
         * @param {string|number} destinationOrLat - The destination address string or latitude.
         * @param {number|null} [destinationLng=null] - The longitude, if latitude is provided.
         * @param {function} [callback] - Optional callback function to execute after calculation.
         */
        function calculateDeslocamentoInModal(destinationOrLat, destinationLng = null, callback) {
            if (!mapsInitialized) {
                console.error("Google Maps API ainda não carregada.");
                if(modalDeslocamentoError) {
                    modalDeslocamentoError.textContent = "Erro ao carregar o serviço de mapas. Tente novamente.";
                    modalDeslocamentoError.classList.remove('hidden');
                }
                currentDeslocamentoCost = 0;
                currentFinalTotalPrice = currentPlanOnlyPrice;
                if (callback) callback();
                return;
            }

            const service = new google.maps.DistanceMatrixService();
            let destinationsArray;

            if (destinationLng !== null) { // If lat/lng are provided
                destinationsArray = [new google.maps.LatLng(destinationOrLat, destinationLng)];
            } else { // If address string is provided
                destinationsArray = [destinationOrLat];
            }

            service.getDistanceMatrix({
                origins: [originAddress],
                destinations: destinationsArray,
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
            }, (response, status) => {
                if (status === 'OK' && response.rows[0].elements[0].status === 'OK') {
                    const element = response.rows[0].elements[0];
                    const distanceInMeters = element.distance.value;
                    const destinationFormattedAddress = response.destinationAddresses[0];
                    const normalizedDestination = destinationFormattedAddress.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                    
                    let isFixedCity = (normalizedDestination.includes('angelica') && normalizedDestination.includes('ms')) || (normalizedDestination.includes('ivinhema') && normalizedDestination.includes('ms'));

                    if (isFixedCity) {
                        currentDeslocamentoCost = FIXED_DESLOCAMENTO_AMOUNT;
                        modalDistanceDisplay.textContent = `Taxa Fixa`;
                    } else {
                        const distanceInKm = distanceInMeters / 1000;
                        currentDeslocamentoCost = FIXED_DESLOCAMENTO_AMOUNT + (distanceInKm * PER_KM_DESLOCAMENTO_RATE);
                        modalDistanceDisplay.textContent = `${distanceInKm.toFixed(2)} km`;
                    }
                    currentFinalTotalPrice = currentPlanOnlyPrice + currentDeslocamentoCost;
                    modalCalculatedDeslocamentoDisplay.textContent = formatCurrency(currentDeslocamentoCost);
                    modalDeslocamentoResultsDiv.classList.remove('hidden');
                    modalDeslocamentoError.classList.add('hidden');
                } else {
                    modalDeslocamentoError.textContent = "Não foi possível calcular o deslocamento para o endereço fornecido.";
                    modalDeslocamentoError.classList.remove('hidden');
                    modalDeslocamentoResultsDiv.classList.add('hidden');
                    currentDeslocamentoCost = 0;
                    currentFinalTotalPrice = currentPlanOnlyPrice;
                }
                if (callback) callback();
            });
        }

        /**
         * Initializes the Google Maps API and Places Autocomplete.
         * This function is called as a callback by the Google Maps script.
         */
        function initMap() {
            mapsInitialized = true;
            console.log("Google Maps API carregada.");
            geocoder = new google.maps.Geocoder(); // Initialize geocoder for reverse geocoding
            const input = document.getElementById('modal-destination-address');
            if (input) {
                autocomplete = new google.maps.places.Autocomplete(input, { types: ['address'], componentRestrictions: { country: 'br' } });
                autocomplete.addListener('place_changed', () => {
                    const place = autocomplete.getPlace();
                    if (place.formatted_address && place.geometry && place.geometry.location) {
                        selectedPlaceDetails.address = place.formatted_address;
                        selectedPlaceDetails.lat = place.geometry.location.lat();
                        selectedPlaceDetails.lng = place.geometry.location.lng();
                        selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${selectedPlaceDetails.lng}`;
                        calculateDeslocamentoInModal(selectedPlaceDetails.lat, selectedPlaceDetails.lng); // Pass lat/lng for precise calculation
                    } else {
                        // If autocomplete doesn't provide full details, clear selectedPlaceDetails and use raw input
                        selectedPlaceDetails.address = input.value;
                        selectedPlaceDetails.lat = null;
                        selectedPlaceDetails.lng = null;
                        selectedPlaceDetails.googleMapsUrl = '';
                        calculateDeslocamentoInModal(input.value); // Fallback to address string
                    }
                });
            }
        }

        /**
         * Opens the map selection modal and initializes/updates the map.
         */
        function openMapSelectionModal() {
            const mapSelectionModal = document.getElementById('map-selection-modal');
            mapSelectionModal.style.display = 'flex';

            if (!map) {
                // Initialize map only once when the modal is opened for the first time
                const mapCanvas = document.getElementById('map-canvas');
                map = new google.maps.Map(mapCanvas, {
                    center: { lat: -14.235, lng: -51.925 }, // Center of Brazil
                    zoom: 4,
                    fullscreenControl: false,  
                    mapTypeControl: true, // Enable map type control
                    mapTypeControlOptions: {
                        style: google.maps.MapTypeControlStyle.DROPDOWN_MENU, // Or HORIZONTAL_BAR
                        position: google.maps.ControlPosition.TOP_RIGHT, // Position the control
                    },
                    streetViewControl: false,  
                    zoomControl: true,  
                });

                marker = new google.maps.Marker({
                    map: map,
                    draggable: true,
                    animation: google.maps.Animation.DROP,
                });

                // Listen for map clicks to place the marker
                map.addListener('click', (e) => {
                    placeMarkerAndMapanTo(e.latLng, map);
                });

                // Listen for marker drag end to update location
                marker.addListener('dragend', () => {
                    placeMarkerAndMapanTo(marker.getPosition(), map);
                });
            }

            // Attempt to set initial map center based on current address input or previous selection
            const currentAddress = modalDestinationAddressInput.value.trim();
            if (currentAddress && geocoder) {
                geocoder.geocode({ 'address': currentAddress }, (results, status) => {
                    if (status === 'OK' && results[0] && results[0].geometry && results[0].geometry.location) {
                        map.setCenter(results[0].geometry.location);
                        map.setZoom(15); // Zoom in on the specific address
                        placeMarkerAndMapanTo(results[0].geometry.location, map);
                    } else {
                        // Fallback to default center if geocoding fails or no address
                        map.setCenter({ lat: -14.235, lng: -51.925 });
                        map.setZoom(4);
                        marker.setMap(null); // Hide marker if no specific address to center on
                    }
                });
            } else if (selectedPlaceDetails.lat && selectedPlaceDetails.lng) {
                // If a location was previously selected from map, center on it
                map.setCenter({ lat: selectedPlaceDetails.lat, lng: selectedPlaceDetails.lng });
                map.setZoom(15);
                placeMarkerAndMapanTo(new google.maps.LatLng(selectedPlaceDetails.lat, selectedPlaceDetails.lng), map);
            } else {
                // Default center if no address or previous selection
                map.setCenter({ lat: -14.235, lng: -51.925 });
                map.setZoom(4);
                marker.setMap(null); // Hide marker initially
            }

            // This ensures the map resizes correctly if the modal was hidden
            google.maps.event.trigger(map, 'resize');
        }

        /**
         * Places a marker on the map and pans to its location, then reverse geocodes the address.
         * @param {google.maps.LatLng} latLng - The latitude and longitude to place the marker.
         * @param {google.maps.Map} mapInstance - The map instance.
         */
        function placeMarkerAndMapanTo(latLng, mapInstance) {
            marker.setPosition(latLng);
            marker.setMap(mapInstance); // Ensure marker is visible
            mapInstance.panTo(latLng);

            // Reverse geocode to get the human-readable address
            geocoder.geocode({ 'location': latLng }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    selectedPlaceDetails.address = results[0].formatted_address;
                    selectedPlaceDetails.lat = latLng.lat();
                    selectedPlaceDetails.lng = latLng.lng();
                    selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${selectedPlaceDetails.lng}`;
                } else {
                    selectedPlaceDetails.address = `Coordenadas: ${latLng.lat().toFixed(4)}, ${latLng.lng().toFixed(4)}`;
                    selectedPlaceDetails.lat = latLng.lat();
                    selectedPlaceDetails.lng = latLng.lng();
                    selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${selectedPlaceDetails.lng}`;
                    console.warn('No address found for selected coordinates, using lat/lng.');
                }
            });
        }

        /**
         * Confirms the location selected on the map and updates the main modal's address input.
         */
        function confirmMapLocation() {
            if (selectedPlaceDetails.lat !== null && selectedPlaceDetails.lng !== null) {
                modalDestinationAddressInput.value = selectedPlaceDetails.address;
                // Trigger the distance calculation based on the precise lat/lng from map
                calculateDeslocamentoInModal(selectedPlaceDetails.lat, selectedPlaceDetails.lng);
            }
            document.getElementById('map-selection-modal').style.display = 'none';
        }

        /**
         * Sends the formatted WhatsApp message with plan details and location.
         * @param {object} plan - Details of the selected plan.
         * @param {string} paymentMethod - Selected payment method.
         * @param {number} installments - Number of installments.
         * @param {number} totalAmountWithFees - Total amount including fees.
         * @param {number} installmentValue - Value per installment.
         */
        function sendWhatsAppMessage(plan, paymentMethod, installments, totalAmountWithFees, installmentValue) {
            // Prefer the address and URL from map selection if available, otherwise fallback to input field
            const destinationAddress = selectedPlaceDetails.address || modalDestinationAddressInput.value;
            const googleMapsLink = selectedPlaceDetails.googleMapsUrl;
            const distanceText = modalDistanceDisplay.textContent;
            const referenceLocationText = referenceLocationInput.value.trim(); // Get reference location text
            
            let message = `*Solicitação de Orçamento - ${plan.type}*\n\n`;
            message += `Olá! Tenho interesse no plano *${plan.name}*.\n\n`;
            message += `*Detalhes do Evento:*\n`;
            const [year, month, day] = ceremonyDate.split('-');
            message += `• *Data:* ${day}/${month}/${year}\n`;
            message += `• *Horário:* ${ceremonyTime}\n`;
            message += `• *Endereço:* ${destinationAddress}\n`;
            if (referenceLocationText) { // Add reference location if available
                message += `• *Local de Referência:* ${referenceLocationText}\n`;
            }
            if (googleMapsLink) {
                message += `• *Localização no Mapa:* ${googleMapsLink}\n\n`; // Add the map link
            } else {
                message += `\n`; // Add a newline even if no map link
            }
            
            message += '*Detalhes do Plano:*\n';
            plan.instruments.forEach(instName => {
                const price = INSTRUMENT_PRICES[instName];
                message += `• ${instName}: ${formatCurrency(price)}\n`;
            });

            message += `\n*Resumo do Orçamento:*\n`;
            message += `• *Valor do Contrato (Plano):* ${formatCurrency(plan.price)}\n`;
            if (currentDeslocamentoCost > 0) {
                message += `• *Valor do Deslocamento:* ${formatCurrency(currentDeslocamentoCost)} (Distância: ${distanceText})\n`;
            }
            if (paymentMethod === 'pix' || paymentMethod === 'dinheiro') {
                message += `• *Valor Total a Pagar:* ${formatCurrency(totalAmountWithFees)}\n`;
                message += `• *Pagamento:* À vista\n`; // Changed for Pix/Dinheiro
            } else {
                message += `• *Valor Total a Pagar (com taxas):* ${formatCurrency(totalAmountWithFees)}\n`;
                message += `• *Parcelamento:* ${installments}x de ${formatCurrency(installmentValue)}\n`; // Retained for Boleto/Cartão
            }
            
            message += `• *Forma de Pagamento:* ${paymentMethod.charAt(0).toUpperCase() + paymentMethod.slice(1)}\n`;
            if (paymentMethod === 'boleto') {
                message += `• *Vencimento do Boleto:* Todo dia ${selectedBoletoDueDate}\n`;
            }
            if (paymentMethod === 'dinheiro') {
                message += `*(Pagamento a ser verificado com o contratado)*\n`;
            }

            message += '\nGostaria de verificar a disponibilidade e mais detalhes. Obrigado!';
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, '_blank');
        }

        // --- SCRIPT EXECUTION ---
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // Assign global DOM elements
                modalDestinationAddressInput = document.getElementById('modal-destination-address');
                modalDeslocamentoError = document.getElementById('modal-deslocamento-error');
                modalDeslocamentoResultsDiv = document.getElementById('modal-deslocamento-results');
                modalDistanceDisplay = document.getElementById('modal-distance-display');
                modalCalculatedDeslocamentoDisplay = document.getElementById('modal-calculated-deslocamento-display');
                referenceLocationInput = document.getElementById('reference-location');
                nextToSummaryBtn = document.getElementById('next-to-summary-btn');
                boletoDateWarningModal = document.getElementById('boleto-date-warning-modal');
                warningDueDateSpan = document.getElementById('warning-due-date');
                warningCeremonyDateSpan = document.getElementById('warning-ceremony-date');

                // Element Getters for main modal
                ceremonyDateInput = document.getElementById('ceremony-date');
                ceremonyTimeInput = document.getElementById('ceremony-time');
                confirmedAddressDisplay = document.getElementById('confirmed-address-display');
                modalEventDetailsError = document.getElementById('modal-event-details-error');
                paymentMethodRadios = document.querySelectorAll('input[name="payment-method"]');
                installmentOptionsDiv = document.getElementById('installment-options');
                installmentsSelect = document.getElementById('installments');
                installmentValueEl = document.getElementById('installment-value');
                boletoDueDateOptionsDiv = document.getElementById('boleto-due-date-options');
                boletoDueDateSelect = document.getElementById('boleto-due-date');
                modalBoletoDateError = document.getElementById('modal-boleto-date-error');
                feesSuffixSpan = document.getElementById('fees-suffix');
                modalPlanPriceEl = document.getElementById('modal-plan-price');
                modalFreightPriceEl = document.getElementById('modal-freight-price');
                modalTotalPriceEl = document.getElementById('modal-total-price');
                modalTotalPriceWithFeesEl = document.getElementById('modal-total-price-with-fees');

                // Element Getters for summary tab
                summaryPlanNameEl = document.getElementById('summary-plan-name');
                summaryEventDateEl = document.getElementById('summary-event-date');
                summaryEventAddressEl = document.getElementById('summary-event-address');
                summaryReferenceLocationDisplay = document.getElementById('summary-reference-location-display');
                summaryReferenceLocationEl = document.getElementById('summary-reference-location');
                summaryPlanPriceEl = document.getElementById('summary-plan-price');
                summaryDeslocamentoPriceEl = document.getElementById('summary-deslocamento-price');
                summaryTotalPriceEl = document.getElementById('summary-total-price');
                summaryTotalWithFeesEl = document.getElementById('summary-total-price-with-fees');
                summaryPaymentMethodEl = document.getElementById('summary-payment-method');
                summaryInstallmentDetailsDiv = document.getElementById('summary-installment-details');
                summaryInstallmentsEl = document.getElementById('summary-installments');
                summaryBoletoDueDateDetailsDiv = document.getElementById('summary-boleto-due-date-details');
                summaryBoletoDueDateEl = document.getElementById('summary-boleto-due-date');
                feesExplanationDiv = document.getElementById('fees-explanation');
                summaryFeesSuffixSpan = document.getElementById('summary-fees-suffix');


                // --- MODAL AND ANIMATION SETUP ---
                // The 'hidden' attribute is now handled by CSS display: none.
                // JavaScript will now only toggle style.display.

                const animatedItems = document.querySelectorAll('.animated-item');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) entry.target.classList.add('visible');
                    });
                }, { threshold: 0.1 });
                animatedItems.forEach(item => observer.observe(item));

                // --- NAVBAR & MOBILE MENU ---
                const navbar = document.getElementById('navbar');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                if (navbar && mobileMenuButton && mobileMenu) {
                    // Add/remove 'navbar-scrolled' class based on scroll position
                    window.onscroll = () => {
                        if (window.scrollY > 50) {
                            navbar.classList.add('navbar-scrolled');
                        } else {
                            navbar.classList.remove('navbar-scrolled');
                        }
                    };
                    mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
                    document.querySelectorAll('.nav-link-mobile').forEach(link => {
                        link.addEventListener('click', () => mobileMenu.classList.add('hidden'));
                    });
                }
                
                // --- CUSTOM PLAN BUILDER ---
                const bandInstruments = [
                    { name: 'Violão', price: 200 }, { name: 'Contrabaixo', price: 200 }, { name: 'Guitarra', price: 200 },
                ];
                const guestInstruments = [
                    { name: 'Saxofone', price: 500 }, { name: 'Violino', price: 500 }
                ];
                const bandOptionsContainer = document.getElementById('band-instrument-options');
                const guestOptionsContainer = document.getElementById('guest-instrument-options');
                const simulateBtnCustom = document.getElementById('simulate-btn-custom'); // Changed ID
                const selectedInstruments = new Set();

                /**
                 * Calculates the total price for the custom plan based on selected instruments.
                 * @returns {number} The calculated price.
                 */
                function calculateCustomPlanPrice() {
                    let price = BASE_PLAN_PRICE;
                    selectedInstruments.forEach(name => {
                        const instrument = [...bandInstruments, ...guestInstruments].find(i => i.name === name);
                        if (instrument) price += instrument.price;
                    });
                    return price;
                }

                /**
                 * Creates a checkbox element for an instrument and appends it to the container.
                 * @param {object} instrument - The instrument object with name and price.
                 * @param {HTMLElement} container - The DOM element to append the checkbox to.
                 */
                function createCheckbox(instrument, container) {
                    const label = document.createElement('label');
                    label.className = 'custom-plan-checkbox-label'; /* Apply new custom class */
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.dataset.name = instrument.name;
                    checkbox.className = 'form-checkbox h-5 w-5 rounded custom-checkbox focus:ring-gold';
                    const span = document.createElement('span');
                    span.className = 'text-gray-700 transition-colors duration-200';
                    span.textContent = `${instrument.name} (+ ${formatCurrency(instrument.price)})`;
                    label.appendChild(checkbox);
                    label.appendChild(span);
                    container.appendChild(label);
                    checkbox.addEventListener('change', (e) => {
                        e.target.checked ? selectedInstruments.add(e.target.dataset.name) : selectedInstruments.delete(e.target.dataset.name);
                    });
                }

                if(bandOptionsContainer && guestOptionsContainer){
                    bandInstruments.forEach(inst => createCheckbox(inst, bandOptionsContainer));
                    guestInstruments.forEach(inst => createCheckbox(inst, guestOptionsContainer));
                }

                // --- MAIN MODAL LOGIC ---
                const mainSimulationModal = document.getElementById('main-simulation-modal'); // Changed ID
                const closeMainModalButton = document.getElementById('close-main-modal-button');
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');
                let unlockedTabs = ['deslocamento-tab']; // Initially, only the first tab is unlocked

                /**
                 * Shows a specific tab within the main simulation modal.
                 * @param {string} tabId - The ID of the tab to show.
                 */
                function showTab(tabId) {
                    tabContents.forEach(content => content.style.display = 'none');
                    tabButtons.forEach(button => button.classList.remove('active'));
                    document.getElementById(tabId).style.display = 'block';
                    document.querySelector(`.tab-button[data-tab="${tabId}"]`).classList.add('active');
                    
                    if (tabId === 'event-details-tab') {
                        confirmedAddressDisplay.textContent = modalDestinationAddressInput.value || 'Endereço não informado.';
                    } else if (tabId === 'payment-method-tab') {
                        updatePaymentDetailsDisplay();
                    } else if (tabId === 'summary-tab') {
                        updateSummaryDisplay();
                    }
                }

                /**
                 * Navigates to a specific tab, unlocking it if necessary.
                 * @param {string} targetTab - The ID of the tab to navigate to.
                 */
                function navigateToTab(targetTab) {
                    if (!unlockedTabs.includes(targetTab)) {
                        unlockedTabs.push(targetTab);
                    }
                    showTab(targetTab);
                }

                // Event listeners for tab buttons
                tabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const targetTab = e.target.dataset.tab;
                        if (unlockedTabs.includes(targetTab)) {
                            showTab(targetTab);
                        }
                    });
                });
                
                // Event listeners for "Voltar" buttons
                document.querySelectorAll('[data-navigate-tab]').forEach(button => {
                    button.addEventListener('click', (e) => showTab(e.target.dataset.navigateTab));
                });

                // Navigation to Event Details tab
                document.getElementById('next-to-event-details-btn').addEventListener('click', () => {
                    const address = modalDestinationAddressInput.value.trim();
                    if (!address || modalDeslocamentoResultsDiv.classList.contains('hidden')) {
                        modalDeslocamentoError.textContent = "Por favor, digite um endereço válido e aguarde o cálculo, ou selecione no mapa.";
                        modalDeslocamentoError.classList.remove('hidden');
                        return;
                    }
                    navigateToTab('event-details-tab');
                });

                // Navigation to Payment Method tab
                document.getElementById('next-to-payment-method-btn').addEventListener('click', () => {
                    ceremonyDate = ceremonyDateInput.value;
                    ceremonyTime = ceremonyTimeInput.value;
                    if (!ceremonyDate || !ceremonyTime) {
                        modalEventDetailsError.textContent = "Por favor, preencha a data e o horário da cerimônia.";
                        modalEventDetailsError.classList.remove('hidden');
                        return;
                    }
                    modalEventDetailsError.classList.add('hidden');
                    navigateToTab('payment-method-tab');
                });

                // Navigation to Summary tab
                document.getElementById('next-to-summary-btn').addEventListener('click', () => {
                    if (validateBoletoDueDate()) { // Validate boleto date before proceeding
                        navigateToTab('summary-tab');
                    }
                });

                // --- MODAL OPEN/CLOSE ---
                /**
                 * Displays the main simulation modal with initial plan details.
                 * @param {number} planPrice - The base price of the selected plan.
                 * @param {object} planDetails - Detailed information about the plan.
                 */
                function showMainSimulationModal(planPrice, planDetails) { // Changed function name
                    mainSimulationModal.style.display = 'flex'; // Changed ID
                    currentPlanDetails = planDetails;
                    currentPlanOnlyPrice = planPrice;
                    currentDeslocamentoCost = 0; // Reset displacement cost
                    currentFinalTotalPrice = currentPlanOnlyPrice; // Reset total price

                    // Reset fields
                    modalDestinationAddressInput.value = '';
                    ceremonyDateInput.value = '';
                    ceremonyTimeInput.value = '';
                    referenceLocationInput.value = ''; // Reset reference location input
                    selectedPlaceDetails = { address: '', lat: null, lng: null, googleMapsUrl: '' }; // Reset map selection
                    const today = new Date().toISOString().split('T')[0];
                    ceremonyDateInput.setAttribute('min', today); // Set minimum date for ceremony
                    modalDeslocamentoResultsDiv.classList.add('hidden');
                    modalDeslocamentoError.classList.add('hidden');
                    
                    // Reset tabs and show the first one
                    unlockedTabs = ['deslocamento-tab'];
                    showTab('deslocamento-tab');
                }

                // Close main modal button listener
                if (closeMainModalButton) {
                    closeMainModalButton.addEventListener('click', () => {
                        mainSimulationModal.style.display = 'none'; // Changed ID
                    });
                }
                // Close main modal when clicking outside
                window.addEventListener('click', (event) => {
                    if (event.target == mainSimulationModal) { // Changed ID
                        mainSimulationModal.style.display = 'none'; // Changed ID
                    }
                });

                // --- MAP SELECTION MODAL LISTENERS ---
                document.getElementById('open-map-selection-btn').addEventListener('click', openMapSelectionModal);
                document.getElementById('close-map-modal-button').addEventListener('click', () => {
                    document.getElementById('map-selection-modal').style.display = 'none';
                });
                document.getElementById('confirm-map-location-btn').addEventListener('click', confirmMapLocation);
                window.addEventListener('click', (event) => {
                    if (event.target == document.getElementById('map-selection-modal')) {
                        document.getElementById('map-selection-modal').style.display = 'none';
                    }
                });

                // --- BOLETO NOTIFICATION MODAL ---
                const boletoNotificationModal = document.getElementById('boleto-notification-modal');
                const closeBoletoModalButton = document.getElementById('close-boleto-modal-button');
                const okBoletoModalButton = document.getElementById('ok-boleto-modal-button');
                
                // Modified logic for boleto notifications
                if (closeBoletoModalButton) {
                    closeBoletoModalButton.addEventListener('click', () => {
                        boletoNotificationModal.style.display = 'none';
                        // After closing the first notification, check for date warning
                        validateBoletoDueDate();  
                    });
                }
                if (okBoletoModalButton) {
                    okBoletoModalButton.addEventListener('click', () => {
                        boletoNotificationModal.style.display = 'none';
                        // After acknowledging the first notification, check for date warning
                        validateBoletoDueDate();
                    });
                }
                window.addEventListener('click', (event) => {
                    if (event.target == boletoNotificationModal) {
                        boletoNotificationModal.style.display = 'none';
                        // After clicking outside the first notification, check for date warning
                        validateBoletoDueDate();
                    }
                });

                // --- NEW: BOLETO DATE WARNING MODAL LISTENERS ---
                document.getElementById('close-boleto-date-warning-modal-button').addEventListener('click', () => {
                    boletoDateWarningModal.style.display = 'none';
                });
                document.getElementById('ok-boleto-date-warning-modal-button').addEventListener('click', () => {
                    boletoDateWarningModal.style.display = 'none';
                });
                window.addEventListener('click', (event) => {
                    if (event.target == boletoDateWarningModal) {
                        boletoDateWarningModal.style.display = 'none';
                    }
                });

                // --- PAYMENT LOGIC ---
                paymentMethodRadios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        selectedPaymentMethod = radio.value;
                        selectedInstallments = 1; // Reset installments on method change
                        updateInstallmentOptions();
                        updatePaymentDetailsDisplay();
                        // Only show the first boleto notification here.
                        // The date warning will be triggered after this one is closed.
                        if (selectedPaymentMethod === 'boleto') {
                            boletoNotificationModal.style.display = 'flex';
                        } else {
                            boletoNotificationModal.style.display = 'none'; // Ensure it's hidden if not boleto
                            boletoDateWarningModal.style.display = 'none'; // Ensure date warning is also hidden
                        }
                    });
                });

                installmentsSelect.addEventListener('change', (e) => {
                    selectedInstallments = parseInt(e.target.value);
                    updatePaymentDetailsDisplay();
                });
                
                boletoDueDateSelect.addEventListener('change', (e) => {
                    selectedBoletoDueDate = parseInt(e.target.value);
                    updatePaymentDetailsDisplay();
                });

                /**
                 * Updates the installment options dropdown based on the selected payment method.
                 */
                function updateInstallmentOptions() {
                    installmentsSelect.innerHTML = '';
                    let maxInstallments = 1;
                    if (selectedPaymentMethod === 'boleto') maxInstallments = 5;
                    else if (selectedPaymentMethod === 'cartao') maxInstallments = 12;

                    for (let i = 1; i <= maxInstallments; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = `${i}x`;
                        installmentsSelect.appendChild(option);
                    }
                    installmentsSelect.value = selectedInstallments;
                }

                /**
                 * Updates the payment details display in the modal based on selected options.
                 */
                function updatePaymentDetailsDisplay() {
                    let calculatedTotalForPayment = currentFinalTotalPrice;
                    let finalInstallmentValue = 0;

                    boletoDueDateOptionsDiv.style.display = (selectedPaymentMethod === 'boleto') ? 'block' : 'none';
                    installmentOptionsDiv.style.display = (selectedPaymentMethod === 'boleto' || selectedPaymentMethod === 'cartao') ? 'block' : 'none';
                    feesSuffixSpan.style.display = 'none';

                    if (selectedPaymentMethod === 'boleto') {
                        calculatedTotalForPayment += (BOLETO_PER_INSTALLMENT_FEE * selectedInstallments);
                        feesSuffixSpan.style.display = 'inline';
                    } else if (selectedPaymentMethod === 'cartao') {
                        const percentageFee = CREDIT_CARD_TOTAL_PERCENTAGES[selectedInstallments];
                        if (percentageFee) {
                            calculatedTotalForPayment = currentFinalTotalPrice / (1 - percentageFee);
                        }
                        feesSuffixSpan.style.display = 'inline';
                    }
                    
                    finalInstallmentValue = calculatedTotalForPayment / selectedInstallments;
                    
                    modalPlanPriceEl.textContent = formatCurrency(currentPlanOnlyPrice);
                    modalFreightPriceEl.textContent = formatCurrency(currentDeslocamentoCost);
                    modalTotalPriceEl.textContent = formatCurrency(currentFinalTotalPrice);
                    modalTotalPriceWithFeesEl.textContent = formatCurrency(calculatedTotalForPayment);
                    installmentValueEl.textContent = formatCurrency(finalInstallmentValue);

                    // Do NOT call validateBoletoDueDate here directly if selectedPaymentMethod is boleto
                    // It will be called after the first notification is closed.
                    if (selectedPaymentMethod !== 'boleto') {
                        validateBoletoDueDate();
                    }
                }
                
                /**
                 * Validates if the last boleto installment date is before the ceremony date.
                 * Displays a warning modal if not.
                 * @returns {boolean} True if validation passes, false otherwise.
                 */
                function validateBoletoDueDate() {
                    // Only perform validation if the payment method is boleto and a ceremony date is set
                    if (selectedPaymentMethod !== 'boleto' || !ceremonyDate) {
                        modalBoletoDateError.classList.add('hidden'); // Hide inline error
                        boletoDateWarningModal.style.display = 'none'; // Hide warning modal
                        if (nextToSummaryBtn) nextToSummaryBtn.disabled = false;
                        return true;
                    }

                    const today = new Date();
                    const ceremony = new Date(ceremonyDate + 'T23:59:59'); // End of ceremony day
                    
                    let firstPaymentDate = new Date(today.getFullYear(), today.getMonth(), selectedBoletoDueDate);
                    // If the first payment date is in the past or today, set it to next month
                    if (firstPaymentDate <= today) {
                        firstPaymentDate.setMonth(firstPaymentDate.getMonth() + 1);
                    }

                    let lastPaymentDate = new Date(firstPaymentDate);
                    lastPaymentDate.setMonth(lastPaymentDate.getMonth() + selectedInstallments - 1);

                    if (lastPaymentDate > ceremony) {
                        // Display the elaborate warning modal
                        warningDueDateSpan.textContent = selectedBoletoDueDate;
                        const [year, month, day] = ceremonyDate.split('-');
                        warningCeremonyDateSpan.textContent = `${day}/${month}/${year}`;
                        boletoDateWarningModal.style.display = 'flex';
                        
                        modalBoletoDateError.classList.remove('hidden'); // Keep inline error for consistency, though modal is primary
                        if (nextToSummaryBtn) nextToSummaryBtn.disabled = true;
                        return false;
                    } else {
                        modalBoletoDateError.classList.add('hidden'); // Hide inline error
                        boletoDateWarningModal.style.display = 'none'; // Hide modal warning
                        if (nextToSummaryBtn) nextToSummaryBtn.disabled = false;
                        return true;
                    }
                }

                // --- SUMMARY LOGIC ---
                /**
                 * Updates the summary display in the modal with all selected details.
                 */
                function updateSummaryDisplay() {
                    let calculatedTotalForSummary = currentFinalTotalPrice;
                    let finalInstallmentValueForSummary = 0;
                    let paymentMethodText = '';

                    summaryFeesSuffixSpan.style.display = 'none';
                    feesExplanationDiv.classList.add('hidden');
                    summaryBoletoDueDateDetailsDiv.classList.add('hidden');

                    if (selectedPaymentMethod === 'boleto') {
                        calculatedTotalForSummary += (BOLETO_PER_INSTALLMENT_FEE * selectedInstallments);
                        paymentMethodText = 'Boleto';
                        feesExplanationDiv.classList.remove('hidden');
                        summaryFeesSuffixSpan.style.display = 'inline';
                        summaryBoletoDueDateDetailsDiv.classList.remove('hidden');
                        summaryBoletoDueDateEl.textContent = `Todo dia ${selectedBoletoDueDate}`;
                    } else if (selectedPaymentMethod === 'cartao') {
                        const percentageFee = CREDIT_CARD_TOTAL_PERCENTAGES[selectedInstallments];
                        if (percentageFee) calculatedTotalForSummary = currentFinalTotalPrice / (1 - percentageFee);
                        paymentMethodText = 'Cartão de Crédito';
                        feesExplanationDiv.classList.remove('hidden');
                        summaryFeesSuffixSpan.style.display = 'inline';
                    } else if (selectedPaymentMethod === 'pix') {
                        paymentMethodText = 'Pix';
                    } else if (selectedPaymentMethod === 'dinheiro') {
                        paymentMethodText = 'Dinheiro (a verificar com o contratado)';
                    }

                    finalInstallmentValueForSummary = calculatedTotalForSummary / selectedInstallments;

                    summaryPlanNameEl.textContent = currentPlanDetails.name;
                    const [year, month, day] = ceremonyDate.split('-');
                    summaryEventDateEl.textContent = `${day}/${month}/${year} às ${ceremonyTime}`;
                    summaryEventAddressEl.textContent = selectedPlaceDetails.address || modalDestinationAddressInput.value; // Use selected address or input
                    
                    // Update and show/hide reference location in summary
                    if (referenceLocationInput.value.trim()) {
                        summaryReferenceLocationEl.textContent = referenceLocationInput.value.trim();
                        summaryReferenceLocationDisplay.style.display = 'block';
                    } else {
                        summaryReferenceLocationEl.textContent = '';
                        summaryReferenceLocationDisplay.style.display = 'none';
                    }

                    summaryPlanPriceEl.textContent = formatCurrency(currentPlanOnlyPrice);
                    summaryDeslocamentoPriceEl.textContent = formatCurrency(currentDeslocamentoCost);
                    summaryTotalPriceEl.textContent = formatCurrency(currentFinalTotalPrice);
                    summaryTotalWithFeesEl.textContent = formatCurrency(calculatedTotalForSummary);
                    summaryPaymentMethodEl.textContent = paymentMethodText;
                    // Conditionally display "Pagamento à vista" or "Parcelamento"
                    if (selectedPaymentMethod === 'pix' || selectedPaymentMethod === 'dinheiro') {
                        summaryInstallmentDetailsDiv.innerHTML = `Pagamento: <span class="font-bold text-gold">À vista</span>`;
                    } else {
                        summaryInstallmentDetailsDiv.innerHTML = `Parcelamento: <span class="font-bold text-gold">${selectedInstallments}x de ${formatCurrency(finalInstallmentValueForSummary)}</span>`;
                    }
                }

                // --- WHATSAPP & SIMULATION ---
                document.getElementById('confirm-simulation-btn').addEventListener('click', () => { // Changed ID
                    const totalAmountWithFees = parseFloat(summaryTotalWithFeesEl.textContent.replace('R$', '').replace(',', '.'));
                    // Safely get installment value, defaulting to total if not applicable (e.g., Pix/Dinheiro)
                    const installmentValuePerInstallment = parseFloat(summaryInstallmentDetailsDiv.textContent.split('de ')[1]?.replace('R$', '').replace(',', '.') || totalAmountWithFees);
                    sendWhatsAppMessage(currentPlanDetails, selectedPaymentMethod, selectedInstallments, totalAmountWithFees, installmentValuePerInstallment);
                    mainSimulationModal.style.display = 'none'; // Changed ID
                });

                /**
                 * Global function to handle "Simular" button clicks for predefined plans.
                 * @param {string} planName - The name of the plan.
                 * @param {string[]} instruments - An array of instruments included in the plan.
                 * @param {number} price - The price of the plan.
                 */
                window.handleSimular = function(planName, instruments, price) { // Changed function name
                    const planDetails = {
                        type: 'Plano Pronto', name: planName, instruments: instruments, price: price
                    };
                    showMainSimulationModal(price, planDetails); // Changed function call
                };

                // Event listener for the custom plan "Simular" button
                if(simulateBtnCustom){ // Changed ID
                    simulateBtnCustom.addEventListener('click', () => { // Changed ID
                        const customPlanPrice = calculateCustomPlanPrice();
                        const planDetails = {
                            type: 'Plano Personalizado', name: 'Plano Personalizado',
                            instruments: ['3 Vozes + Teclado/Piano', ...Array.from(selectedInstruments)],
                            price: customPlanPrice
                        };
                        showMainSimulationModal(customPlanPrice, planDetails); // Changed function call
                    });
                }

                // --- DESLOCAMENTO CALCULATION ---
                // Debounce input for address calculation to prevent excessive API calls
                modalDestinationAddressInput.addEventListener('input', () => {
                    clearTimeout(debounceTimer);
                    const address = modalDestinationAddressInput.value.trim();
                    if (address.length > 3) {
                        debounceTimer = setTimeout(() => {
                            // When typing, use the address string for calculation
                            calculateDeslocamentoInModal(address);
                            // Also try to geocode and store lat/lng for WhatsApp link, but don't force map selection
                            if (geocoder) {
                                geocoder.geocode({ 'address': address }, (results, status) => {
                                    if (status === 'OK' && results[0] && results[0].geometry && results[0].geometry.location) {
                                        selectedPlaceDetails.address = results[0].formatted_address;
                                        selectedPlaceDetails.lat = results[0].geometry.location.lat();
                                        selectedPlaceDetails.lng = results[0].geometry.location.lng();
                                        selectedPlaceDetails.googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${selectedPlaceDetails.lat},${selectedPlaceDetails.lng}`;
                                    } else {
                                        selectedPlaceDetails.lat = null;
                                        selectedPlaceDetails.lng = null;
                                        selectedPlaceDetails.googleMapsUrl = '';
                                    }
                                });
                            }
                        }, 500); // 500ms delay
                    } else {
                        modalDeslocamentoResultsDiv.classList.add('hidden');
                        modalDeslocamentoError.classList.add('hidden');
                        currentDeslocamentoCost = 0;
                        currentFinalTotalPrice = currentPlanOnlyPrice;
                        selectedPlaceDetails = { address: '', lat: null, lng: null, googleMapsUrl: '' }; // Clear map data
                    }
                });
                
                // --- SECURITY MEASURES TO DETER INSPECTION ---
                // Disable right-click context menu
                document.addEventListener('contextmenu', event => event.preventDefault());

                // Disable specific keyboard shortcuts for developer tools and source view
                document.addEventListener('keydown', event => {
                    // F12 key
                    if (event.key === 'F12') {
                        event.preventDefault();
                    }
                    // Ctrl+Shift+I, Ctrl+Shift+J (Developer Tools)
                    // Ctrl+U (View Source)
                    // Ctrl+S (Save Page)
                    if (event.ctrlKey && event.shiftKey && (event.key === 'I' || event.key === 'J')) {
                        event.preventDefault();
                    }
                    if (event.ctrlKey && event.key === 'U') {
                        event.preventDefault();
                    }
                    if (event.ctrlKey && event.key === 'S') {
                        event.preventDefault();
                    }
                });

            } catch (error) {
                console.error("Erro durante o carregamento do script:", error);
            }
        });
    </script>
</body>
</html>
